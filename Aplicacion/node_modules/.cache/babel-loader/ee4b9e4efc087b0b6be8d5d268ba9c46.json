{"ast":null,"code":"\"use strict\";\n\nvar __extends = this && this.__extends || function () {\n  var _extendStatics = function extendStatics(d, b) {\n    _extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) {\n        if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n      }\n    };\n\n    return _extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n\n    _extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __read = this && this.__read || function (o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o),\n      r,\n      ar = [],\n      e;\n\n  try {\n    while ((n === void 0 || n-- > 0) && !(r = i.next()).done) {\n      ar.push(r.value);\n    }\n  } catch (error) {\n    e = {\n      error: error\n    };\n  } finally {\n    try {\n      if (r && !r.done && (m = i[\"return\"])) m.call(i);\n    } finally {\n      if (e) throw e.error;\n    }\n  }\n\n  return ar;\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.MathML = void 0;\n\nvar InputJax_js_1 = require(\"../core/InputJax.js\");\n\nvar Options_js_1 = require(\"../util/Options.js\");\n\nvar FunctionList_js_1 = require(\"../util/FunctionList.js\");\n\nvar FindMathML_js_1 = require(\"./mathml/FindMathML.js\");\n\nvar MathMLCompile_js_1 = require(\"./mathml/MathMLCompile.js\");\n\nvar MathML = function (_super) {\n  __extends(MathML, _super);\n\n  function MathML(options) {\n    if (options === void 0) {\n      options = {};\n    }\n\n    var _this = this;\n\n    var _a = __read((0, Options_js_1.separateOptions)(options, FindMathML_js_1.FindMathML.OPTIONS, MathMLCompile_js_1.MathMLCompile.OPTIONS), 3),\n        mml = _a[0],\n        find = _a[1],\n        compile = _a[2];\n\n    _this = _super.call(this, mml) || this;\n    _this.findMathML = _this.options['FindMathML'] || new FindMathML_js_1.FindMathML(find);\n    _this.mathml = _this.options['MathMLCompile'] || new MathMLCompile_js_1.MathMLCompile(compile);\n    _this.mmlFilters = new FunctionList_js_1.FunctionList();\n    return _this;\n  }\n\n  MathML.prototype.setAdaptor = function (adaptor) {\n    _super.prototype.setAdaptor.call(this, adaptor);\n\n    this.findMathML.adaptor = adaptor;\n    this.mathml.adaptor = adaptor;\n  };\n\n  MathML.prototype.setMmlFactory = function (mmlFactory) {\n    _super.prototype.setMmlFactory.call(this, mmlFactory);\n\n    this.mathml.setMmlFactory(mmlFactory);\n  };\n\n  Object.defineProperty(MathML.prototype, \"processStrings\", {\n    get: function get() {\n      return false;\n    },\n    enumerable: false,\n    configurable: true\n  });\n\n  MathML.prototype.compile = function (math, document) {\n    var mml = math.start.node;\n\n    if (!mml || !math.end.node || this.options['forceReparse'] || this.adaptor.kind(mml) === '#text') {\n      var mathml = this.executeFilters(this.preFilters, math, document, (math.math || '<math></math>').trim());\n      var doc = this.checkForErrors(this.adaptor.parse(mathml, 'text/' + this.options['parseAs']));\n      var body = this.adaptor.body(doc);\n\n      if (this.adaptor.childNodes(body).length !== 1) {\n        this.error('MathML must consist of a single element');\n      }\n\n      mml = this.adaptor.remove(this.adaptor.firstChild(body));\n\n      if (this.adaptor.kind(mml).replace(/^[a-z]+:/, '') !== 'math') {\n        this.error('MathML must be formed by a <math> element, not <' + this.adaptor.kind(mml) + '>');\n      }\n    }\n\n    mml = this.executeFilters(this.mmlFilters, math, document, mml);\n    return this.executeFilters(this.postFilters, math, document, this.mathml.compile(mml));\n  };\n\n  MathML.prototype.checkForErrors = function (doc) {\n    var err = this.adaptor.tags(this.adaptor.body(doc), 'parsererror')[0];\n\n    if (err) {\n      if (this.adaptor.textContent(err) === '') {\n        this.error('Error processing MathML');\n      }\n\n      this.options['parseError'].call(this, err);\n    }\n\n    return doc;\n  };\n\n  MathML.prototype.error = function (message) {\n    throw new Error(message);\n  };\n\n  MathML.prototype.findMath = function (node) {\n    return this.findMathML.findMath(node);\n  };\n\n  MathML.NAME = 'MathML';\n  MathML.OPTIONS = (0, Options_js_1.defaultOptions)({\n    parseAs: 'html',\n    forceReparse: false,\n    FindMathML: null,\n    MathMLCompile: null,\n    parseError: function parseError(node) {\n      this.error(this.adaptor.textContent(node).replace(/\\n.*/g, ''));\n    }\n  }, InputJax_js_1.AbstractInputJax.OPTIONS);\n  return MathML;\n}(InputJax_js_1.AbstractInputJax);\n\nexports.MathML = MathML;","map":{"version":3,"mappings":"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","names":["__extends","options","FindMathML_js_1","OPTIONS","MathMLCompile_js_1","mml","find","compile","_super","_this","findMathML","mathml","mmlFilters","FunctionList_js_1","MathML","adaptor","setAdaptor","call","mmlFactory","setMmlFactory","Object","math","document","start","node","end","kind","executeFilters","preFilters","trim","doc","checkForErrors","parse","body","childNodes","length","error","remove","firstChild","replace","postFilters","err","tags","textContent","message","Error","findMath","parseAs","forceReparse","FindMathML","MathMLCompile","parseError","InputJax_js_1","exports"],"sourceRoot":"","sources":["../../ts/input/mathml.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}