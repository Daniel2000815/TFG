{"ast":null,"code":"\"use strict\";\n\nvar __read = this && this.__read || function (o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o),\n      r,\n      ar = [],\n      e;\n\n  try {\n    while ((n === void 0 || n-- > 0) && !(r = i.next()).done) {\n      ar.push(r.value);\n    }\n  } catch (error) {\n    e = {\n      error: error\n    };\n  } finally {\n    try {\n      if (r && !r.done && (m = i[\"return\"])) m.call(i);\n    } finally {\n      if (e) throw e.error;\n    }\n  }\n\n  return ar;\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.HTMLDomStrings = void 0;\n\nvar Options_js_1 = require(\"../../util/Options.js\");\n\nvar HTMLDomStrings = function () {\n  function HTMLDomStrings(options) {\n    if (options === void 0) {\n      options = null;\n    }\n\n    var CLASS = this.constructor;\n    this.options = (0, Options_js_1.userOptions)((0, Options_js_1.defaultOptions)({}, CLASS.OPTIONS), options);\n    this.init();\n    this.getPatterns();\n  }\n\n  HTMLDomStrings.prototype.init = function () {\n    this.strings = [];\n    this.string = '';\n    this.snodes = [];\n    this.nodes = [];\n    this.stack = [];\n  };\n\n  HTMLDomStrings.prototype.getPatterns = function () {\n    var skip = (0, Options_js_1.makeArray)(this.options['skipHtmlTags']);\n    var ignore = (0, Options_js_1.makeArray)(this.options['ignoreHtmlClass']);\n    var process = (0, Options_js_1.makeArray)(this.options['processHtmlClass']);\n    this.skipHtmlTags = new RegExp('^(?:' + skip.join('|') + ')$', 'i');\n    this.ignoreHtmlClass = new RegExp('(?:^| )(?:' + ignore.join('|') + ')(?: |$)');\n    this.processHtmlClass = new RegExp('(?:^| )(?:' + process + ')(?: |$)');\n  };\n\n  HTMLDomStrings.prototype.pushString = function () {\n    if (this.string.match(/\\S/)) {\n      this.strings.push(this.string);\n      this.nodes.push(this.snodes);\n    }\n\n    this.string = '';\n    this.snodes = [];\n  };\n\n  HTMLDomStrings.prototype.extendString = function (node, text) {\n    this.snodes.push([node, text.length]);\n    this.string += text;\n  };\n\n  HTMLDomStrings.prototype.handleText = function (node, ignore) {\n    if (!ignore) {\n      this.extendString(node, this.adaptor.value(node));\n    }\n\n    return this.adaptor.next(node);\n  };\n\n  HTMLDomStrings.prototype.handleTag = function (node, ignore) {\n    if (!ignore) {\n      var text = this.options['includeHtmlTags'][this.adaptor.kind(node)];\n      this.extendString(node, text);\n    }\n\n    return this.adaptor.next(node);\n  };\n\n  HTMLDomStrings.prototype.handleContainer = function (node, ignore) {\n    this.pushString();\n    var cname = this.adaptor.getAttribute(node, 'class') || '';\n    var tname = this.adaptor.kind(node) || '';\n    var process = this.processHtmlClass.exec(cname);\n    var next = node;\n\n    if (this.adaptor.firstChild(node) && !this.adaptor.getAttribute(node, 'data-MJX') && (process || !this.skipHtmlTags.exec(tname))) {\n      if (this.adaptor.next(node)) {\n        this.stack.push([this.adaptor.next(node), ignore]);\n      }\n\n      next = this.adaptor.firstChild(node);\n      ignore = (ignore || this.ignoreHtmlClass.exec(cname)) && !process;\n    } else {\n      next = this.adaptor.next(node);\n    }\n\n    return [next, ignore];\n  };\n\n  HTMLDomStrings.prototype.handleOther = function (node, _ignore) {\n    this.pushString();\n    return this.adaptor.next(node);\n  };\n\n  HTMLDomStrings.prototype.find = function (node) {\n    var _a, _b;\n\n    this.init();\n    var stop = this.adaptor.next(node);\n    var ignore = false;\n    var include = this.options['includeHtmlTags'];\n\n    while (node && node !== stop) {\n      var kind = this.adaptor.kind(node);\n\n      if (kind === '#text') {\n        node = this.handleText(node, ignore);\n      } else if (include.hasOwnProperty(kind)) {\n        node = this.handleTag(node, ignore);\n      } else if (kind) {\n        _a = __read(this.handleContainer(node, ignore), 2), node = _a[0], ignore = _a[1];\n      } else {\n        node = this.handleOther(node, ignore);\n      }\n\n      if (!node && this.stack.length) {\n        this.pushString();\n        _b = __read(this.stack.pop(), 2), node = _b[0], ignore = _b[1];\n      }\n    }\n\n    this.pushString();\n    var result = [this.strings, this.nodes];\n    this.init();\n    return result;\n  };\n\n  HTMLDomStrings.OPTIONS = {\n    skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code', 'annotation', 'annotation-xml'],\n    includeHtmlTags: {\n      br: '\\n',\n      wbr: '',\n      '#comment': ''\n    },\n    ignoreHtmlClass: 'mathjax_ignore',\n    processHtmlClass: 'mathjax_process'\n  };\n  return HTMLDomStrings;\n}();\n\nexports.HTMLDomStrings = HTMLDomStrings;","map":{"version":3,"mappings":"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","names":["options","CLASS","constructor","OPTIONS","init","getPatterns","HTMLDomStrings","strings","string","snodes","nodes","stack","skip","ignore","process","skipHtmlTags","RegExp","join","ignoreHtmlClass","processHtmlClass","match","push","node","text","length","extendString","adaptor","value","next","kind","pushString","cname","getAttribute","tname","exec","firstChild","_ignore","stop","include","handleText","hasOwnProperty","handleTag","_a","handleContainer","handleOther","_b","pop","result","includeHtmlTags","br","wbr","exports"],"sourceRoot":"","sources":["../../../ts/handlers/html/HTMLDomStrings.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}