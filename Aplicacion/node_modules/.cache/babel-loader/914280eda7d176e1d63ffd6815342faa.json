{"ast":null,"code":"import _asyncToGenerator from \"C:\\\\Users\\\\daniz\\\\TFG\\\\Aplicacion\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";\nimport _createForOfIteratorHelper from \"C:\\\\Users\\\\daniz\\\\TFG\\\\Aplicacion\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createForOfIteratorHelper\";\nimport _objectSpread from \"C:\\\\Users\\\\daniz\\\\TFG\\\\Aplicacion\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread2\";\nimport _toConsumableArray from \"C:\\\\Users\\\\daniz\\\\TFG\\\\Aplicacion\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/toConsumableArray\";\nimport _slicedToArray from \"C:\\\\Users\\\\daniz\\\\TFG\\\\Aplicacion\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"C:\\\\Users\\\\daniz\\\\TFG\\\\Aplicacion\\\\src\\\\GraphPage\\\\Graph.js\";\n\nfunction _regeneratorRuntime() { \"use strict\"; /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */ _regeneratorRuntime = function _regeneratorRuntime() { return exports; }; var exports = {}, Op = Object.prototype, hasOwn = Op.hasOwnProperty, $Symbol = \"function\" == typeof Symbol ? Symbol : {}, iteratorSymbol = $Symbol.iterator || \"@@iterator\", asyncIteratorSymbol = $Symbol.asyncIterator || \"@@asyncIterator\", toStringTagSymbol = $Symbol.toStringTag || \"@@toStringTag\"; function define(obj, key, value) { return Object.defineProperty(obj, key, { value: value, enumerable: !0, configurable: !0, writable: !0 }), obj[key]; } try { define({}, \"\"); } catch (err) { define = function define(obj, key, value) { return obj[key] = value; }; } function wrap(innerFn, outerFn, self, tryLocsList) { var protoGenerator = outerFn && outerFn.prototype instanceof Generator ? outerFn : Generator, generator = Object.create(protoGenerator.prototype), context = new Context(tryLocsList || []); return generator._invoke = function (innerFn, self, context) { var state = \"suspendedStart\"; return function (method, arg) { if (\"executing\" === state) throw new Error(\"Generator is already running\"); if (\"completed\" === state) { if (\"throw\" === method) throw arg; return doneResult(); } for (context.method = method, context.arg = arg;;) { var delegate = context.delegate; if (delegate) { var delegateResult = maybeInvokeDelegate(delegate, context); if (delegateResult) { if (delegateResult === ContinueSentinel) continue; return delegateResult; } } if (\"next\" === context.method) context.sent = context._sent = context.arg;else if (\"throw\" === context.method) { if (\"suspendedStart\" === state) throw state = \"completed\", context.arg; context.dispatchException(context.arg); } else \"return\" === context.method && context.abrupt(\"return\", context.arg); state = \"executing\"; var record = tryCatch(innerFn, self, context); if (\"normal\" === record.type) { if (state = context.done ? \"completed\" : \"suspendedYield\", record.arg === ContinueSentinel) continue; return { value: record.arg, done: context.done }; } \"throw\" === record.type && (state = \"completed\", context.method = \"throw\", context.arg = record.arg); } }; }(innerFn, self, context), generator; } function tryCatch(fn, obj, arg) { try { return { type: \"normal\", arg: fn.call(obj, arg) }; } catch (err) { return { type: \"throw\", arg: err }; } } exports.wrap = wrap; var ContinueSentinel = {}; function Generator() {} function GeneratorFunction() {} function GeneratorFunctionPrototype() {} var IteratorPrototype = {}; define(IteratorPrototype, iteratorSymbol, function () { return this; }); var getProto = Object.getPrototypeOf, NativeIteratorPrototype = getProto && getProto(getProto(values([]))); NativeIteratorPrototype && NativeIteratorPrototype !== Op && hasOwn.call(NativeIteratorPrototype, iteratorSymbol) && (IteratorPrototype = NativeIteratorPrototype); var Gp = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(IteratorPrototype); function defineIteratorMethods(prototype) { [\"next\", \"throw\", \"return\"].forEach(function (method) { define(prototype, method, function (arg) { return this._invoke(method, arg); }); }); } function AsyncIterator(generator, PromiseImpl) { function invoke(method, arg, resolve, reject) { var record = tryCatch(generator[method], generator, arg); if (\"throw\" !== record.type) { var result = record.arg, value = result.value; return value && \"object\" == typeof value && hasOwn.call(value, \"__await\") ? PromiseImpl.resolve(value.__await).then(function (value) { invoke(\"next\", value, resolve, reject); }, function (err) { invoke(\"throw\", err, resolve, reject); }) : PromiseImpl.resolve(value).then(function (unwrapped) { result.value = unwrapped, resolve(result); }, function (error) { return invoke(\"throw\", error, resolve, reject); }); } reject(record.arg); } var previousPromise; this._invoke = function (method, arg) { function callInvokeWithMethodAndArg() { return new PromiseImpl(function (resolve, reject) { invoke(method, arg, resolve, reject); }); } return previousPromise = previousPromise ? previousPromise.then(callInvokeWithMethodAndArg, callInvokeWithMethodAndArg) : callInvokeWithMethodAndArg(); }; } function maybeInvokeDelegate(delegate, context) { var method = delegate.iterator[context.method]; if (undefined === method) { if (context.delegate = null, \"throw\" === context.method) { if (delegate.iterator.return && (context.method = \"return\", context.arg = undefined, maybeInvokeDelegate(delegate, context), \"throw\" === context.method)) return ContinueSentinel; context.method = \"throw\", context.arg = new TypeError(\"The iterator does not provide a 'throw' method\"); } return ContinueSentinel; } var record = tryCatch(method, delegate.iterator, context.arg); if (\"throw\" === record.type) return context.method = \"throw\", context.arg = record.arg, context.delegate = null, ContinueSentinel; var info = record.arg; return info ? info.done ? (context[delegate.resultName] = info.value, context.next = delegate.nextLoc, \"return\" !== context.method && (context.method = \"next\", context.arg = undefined), context.delegate = null, ContinueSentinel) : info : (context.method = \"throw\", context.arg = new TypeError(\"iterator result is not an object\"), context.delegate = null, ContinueSentinel); } function pushTryEntry(locs) { var entry = { tryLoc: locs[0] }; 1 in locs && (entry.catchLoc = locs[1]), 2 in locs && (entry.finallyLoc = locs[2], entry.afterLoc = locs[3]), this.tryEntries.push(entry); } function resetTryEntry(entry) { var record = entry.completion || {}; record.type = \"normal\", delete record.arg, entry.completion = record; } function Context(tryLocsList) { this.tryEntries = [{ tryLoc: \"root\" }], tryLocsList.forEach(pushTryEntry, this), this.reset(!0); } function values(iterable) { if (iterable) { var iteratorMethod = iterable[iteratorSymbol]; if (iteratorMethod) return iteratorMethod.call(iterable); if (\"function\" == typeof iterable.next) return iterable; if (!isNaN(iterable.length)) { var i = -1, next = function next() { for (; ++i < iterable.length;) { if (hasOwn.call(iterable, i)) return next.value = iterable[i], next.done = !1, next; } return next.value = undefined, next.done = !0, next; }; return next.next = next; } } return { next: doneResult }; } function doneResult() { return { value: undefined, done: !0 }; } return GeneratorFunction.prototype = GeneratorFunctionPrototype, define(Gp, \"constructor\", GeneratorFunctionPrototype), define(GeneratorFunctionPrototype, \"constructor\", GeneratorFunction), GeneratorFunction.displayName = define(GeneratorFunctionPrototype, toStringTagSymbol, \"GeneratorFunction\"), exports.isGeneratorFunction = function (genFun) { var ctor = \"function\" == typeof genFun && genFun.constructor; return !!ctor && (ctor === GeneratorFunction || \"GeneratorFunction\" === (ctor.displayName || ctor.name)); }, exports.mark = function (genFun) { return Object.setPrototypeOf ? Object.setPrototypeOf(genFun, GeneratorFunctionPrototype) : (genFun.__proto__ = GeneratorFunctionPrototype, define(genFun, toStringTagSymbol, \"GeneratorFunction\")), genFun.prototype = Object.create(Gp), genFun; }, exports.awrap = function (arg) { return { __await: arg }; }, defineIteratorMethods(AsyncIterator.prototype), define(AsyncIterator.prototype, asyncIteratorSymbol, function () { return this; }), exports.AsyncIterator = AsyncIterator, exports.async = function (innerFn, outerFn, self, tryLocsList, PromiseImpl) { void 0 === PromiseImpl && (PromiseImpl = Promise); var iter = new AsyncIterator(wrap(innerFn, outerFn, self, tryLocsList), PromiseImpl); return exports.isGeneratorFunction(outerFn) ? iter : iter.next().then(function (result) { return result.done ? result.value : iter.next(); }); }, defineIteratorMethods(Gp), define(Gp, toStringTagSymbol, \"Generator\"), define(Gp, iteratorSymbol, function () { return this; }), define(Gp, \"toString\", function () { return \"[object Generator]\"; }), exports.keys = function (object) { var keys = []; for (var key in object) { keys.push(key); } return keys.reverse(), function next() { for (; keys.length;) { var key = keys.pop(); if (key in object) return next.value = key, next.done = !1, next; } return next.done = !0, next; }; }, exports.values = values, Context.prototype = { constructor: Context, reset: function reset(skipTempReset) { if (this.prev = 0, this.next = 0, this.sent = this._sent = undefined, this.done = !1, this.delegate = null, this.method = \"next\", this.arg = undefined, this.tryEntries.forEach(resetTryEntry), !skipTempReset) for (var name in this) { \"t\" === name.charAt(0) && hasOwn.call(this, name) && !isNaN(+name.slice(1)) && (this[name] = undefined); } }, stop: function stop() { this.done = !0; var rootRecord = this.tryEntries[0].completion; if (\"throw\" === rootRecord.type) throw rootRecord.arg; return this.rval; }, dispatchException: function dispatchException(exception) { if (this.done) throw exception; var context = this; function handle(loc, caught) { return record.type = \"throw\", record.arg = exception, context.next = loc, caught && (context.method = \"next\", context.arg = undefined), !!caught; } for (var i = this.tryEntries.length - 1; i >= 0; --i) { var entry = this.tryEntries[i], record = entry.completion; if (\"root\" === entry.tryLoc) return handle(\"end\"); if (entry.tryLoc <= this.prev) { var hasCatch = hasOwn.call(entry, \"catchLoc\"), hasFinally = hasOwn.call(entry, \"finallyLoc\"); if (hasCatch && hasFinally) { if (this.prev < entry.catchLoc) return handle(entry.catchLoc, !0); if (this.prev < entry.finallyLoc) return handle(entry.finallyLoc); } else if (hasCatch) { if (this.prev < entry.catchLoc) return handle(entry.catchLoc, !0); } else { if (!hasFinally) throw new Error(\"try statement without catch or finally\"); if (this.prev < entry.finallyLoc) return handle(entry.finallyLoc); } } } }, abrupt: function abrupt(type, arg) { for (var i = this.tryEntries.length - 1; i >= 0; --i) { var entry = this.tryEntries[i]; if (entry.tryLoc <= this.prev && hasOwn.call(entry, \"finallyLoc\") && this.prev < entry.finallyLoc) { var finallyEntry = entry; break; } } finallyEntry && (\"break\" === type || \"continue\" === type) && finallyEntry.tryLoc <= arg && arg <= finallyEntry.finallyLoc && (finallyEntry = null); var record = finallyEntry ? finallyEntry.completion : {}; return record.type = type, record.arg = arg, finallyEntry ? (this.method = \"next\", this.next = finallyEntry.finallyLoc, ContinueSentinel) : this.complete(record); }, complete: function complete(record, afterLoc) { if (\"throw\" === record.type) throw record.arg; return \"break\" === record.type || \"continue\" === record.type ? this.next = record.arg : \"return\" === record.type ? (this.rval = this.arg = record.arg, this.method = \"return\", this.next = \"end\") : \"normal\" === record.type && afterLoc && (this.next = afterLoc), ContinueSentinel; }, finish: function finish(finallyLoc) { for (var i = this.tryEntries.length - 1; i >= 0; --i) { var entry = this.tryEntries[i]; if (entry.finallyLoc === finallyLoc) return this.complete(entry.completion, entry.afterLoc), resetTryEntry(entry), ContinueSentinel; } }, catch: function _catch(tryLoc) { for (var i = this.tryEntries.length - 1; i >= 0; --i) { var entry = this.tryEntries[i]; if (entry.tryLoc === tryLoc) { var record = entry.completion; if (\"throw\" === record.type) { var thrown = record.arg; resetTryEntry(entry); } return thrown; } } throw new Error(\"illegal catch attempt\"); }, delegateYield: function delegateYield(iterable, resultName, nextLoc) { return this.delegate = { iterator: values(iterable), resultName: resultName, nextLoc: nextLoc }, \"next\" === this.method && (this.arg = undefined), ContinueSentinel; } }, exports; }\n\nimport React, { useState } from 'react';\nimport { useEffect, useRef } from 'react';\nimport ReactFlow, { addEdge, Background, useNodesState, useEdgesState, MarkerType, project, useReactFlow } from 'react-flow-renderer';\nimport PrimitiveNode from '../CustomNodes/PrimitiveNode.js';\nimport BooleanNode from '../CustomNodes/BooleanNode.js';\nimport DeformNode from '../CustomNodes/DeformNode.js';\nimport TransformNode from '../CustomNodes/TransformNode.js';\nimport ButtonEdge from '../CustomNodes/ButtonEdge';\nimport CustomControls from '../CustomComponents/CustomControls.js';\nimport '../styles.css';\nimport { GraphProvider } from './GraphContext.js';\nimport CustomContextMenu from '../CustomComponents/CustomContextMenu.js';\nimport useLocalStorage from '../storageHook.js';\nimport { ContextMenu, MenuItem, ContextMenuTrigger } from 'react-contextmenu';\nvar flowKey = 'savedGraph';\nvar graphNodeTypes = {\n  primitiveNode: PrimitiveNode,\n  booleanNode: BooleanNode,\n  deformNode: DeformNode,\n  transformNode: TransformNode\n};\nvar edgeTypes = {\n  buttonEdge: ButtonEdge\n};\nvar initialNodes = [{\n  id: 'prim-0',\n  type: 'primitiveNode',\n  position: {\n    x: -50,\n    y: -350\n  },\n  dragHandle: ' .nodeHeader',\n  data: {\n    default: 'Cube',\n    inputs: {},\n    sdf: '',\n    children: []\n  }\n}, {\n  id: 'prim-1',\n  type: 'primitiveNode',\n  dragHandle: '.nodeHeader',\n  position: {\n    x: -50,\n    y: 125\n  },\n  data: {\n    inputs: {},\n    sdf: '',\n    children: []\n  }\n}, {\n  id: 'prim-2',\n  type: 'primitiveNode',\n  position: {\n    x: -50,\n    y: 600\n  },\n  dragHandle: '.nodeHeader',\n  data: {\n    inputs: {},\n    sdf: '',\n    children: []\n  }\n}, {\n  id: 'deform-0',\n  type: 'deformNode',\n  dragHandle: '.nodeHeader',\n  position: {\n    x: 200,\n    y: -125\n  },\n  data: {\n    inputs: {},\n    sdf: '',\n    children: []\n  }\n}, {\n  id: 'transform-0',\n  type: 'transformNode',\n  dragHandle: '.nodeHeader',\n  position: {\n    x: 450,\n    y: 150\n  },\n  data: {\n    inputs: {},\n    sdf: '',\n    children: []\n  }\n}, {\n  id: 'bool-2',\n  type: 'booleanNode',\n  dragHandle: '.nodeHeader',\n  position: {\n    x: 200,\n    y: 375\n  },\n  data: {\n    inputs: {},\n    sdf: '',\n    children: []\n  }\n}];\n\nvar onInit = function onInit(reactFlowInstance) {\n  return console.log('flow loaded:', reactFlowInstance);\n};\n\nexport default function Graph() {\n  var _useNodesState = useNodesState(initialNodes),\n      _useNodesState2 = _slicedToArray(_useNodesState, 3),\n      nodes = _useNodesState2[0],\n      setNodes = _useNodesState2[1],\n      onNodesChange = _useNodesState2[2];\n\n  var _useEdgesState = useEdgesState([]),\n      _useEdgesState2 = _slicedToArray(_useEdgesState, 3),\n      edges = _useEdgesState2[0],\n      setEdges = _useEdgesState2[1],\n      onEdgesChange = _useEdgesState2[2];\n\n  var _useState = useState(null),\n      _useState2 = _slicedToArray(_useState, 2),\n      rfInstance = _useState2[0],\n      setRfInstance = _useState2[1];\n\n  var _React$useState = React.useState(3),\n      _React$useState2 = _slicedToArray(_React$useState, 2),\n      id = _React$useState2[0],\n      setId = _React$useState2[1];\n\n  var _useState3 = useState([0, 0]),\n      _useState4 = _slicedToArray(_useState3, 2),\n      mouseCoor = _useState4[0],\n      setMouseCoor = _useState4[1];\n\n  var _useLocalStorage = useLocalStorage(\"user_implicits\", {}),\n      _useLocalStorage2 = _slicedToArray(_useLocalStorage, 2),\n      storage = _useLocalStorage2[0],\n      setStorage = _useLocalStorage2[1];\n\n  var reactFlowRef = useRef(null);\n\n  var updateNodeSdf = function updateNodeSdf(id, newSdf, parent) {\n    console.log('ACTUALIZADONDO SDF DE ' + id);\n\n    var nodesCopy = _toConsumableArray(nodes);\n\n    var parent = nodesCopy.find(function (node) {\n      return node.id === id;\n    });\n    parent.data = _objectSpread(_objectSpread({}, parent.data), {}, {\n      sdf: newSdf\n    });\n\n    var _iterator = _createForOfIteratorHelper(parent.data.children),\n        _step;\n\n    try {\n      for (_iterator.s(); !(_step = _iterator.n()).done;) {\n        var child = _step.value;\n\n        var _iterator2 = _createForOfIteratorHelper(nodesCopy),\n            _step2;\n\n        try {\n          for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {\n            var node = _step2.value;\n\n            if (node.id === child) {\n              var newInputs = node.data.inputs;\n              newInputs[\"\".concat(id)] = newSdf;\n              node.data = _objectSpread(_objectSpread({}, node.data), {}, {\n                inputs: newInputs\n              });\n            }\n          }\n        } catch (err) {\n          _iterator2.e(err);\n        } finally {\n          _iterator2.f();\n        }\n      }\n    } catch (err) {\n      _iterator.e(err);\n    } finally {\n      _iterator.f();\n    }\n\n    setNodes(nodesCopy);\n  };\n\n  var removeChild = function removeChild(parent, child) {\n    setNodes(function (nds) {\n      return nds.map(function (node) {\n        if (node.id === parent) {\n          console.log(\"ELIMINANDO HIJO \".concat(child, \" DE \").concat(parent));\n          var newChildren = node.data.children;\n          newChildren = newChildren.filter(function (c) {\n            return c.id != child;\n          });\n          node.data = _objectSpread(_objectSpread({}, node.data), {}, {\n            children: newChildren\n          });\n        }\n\n        if (node.id === child) {\n          console.log(\"ACTUALIZANDO \".concat(child));\n          var newInputs = node.data.inputs;\n          newInputs[\"\".concat(parent)] = '';\n          node.data = _objectSpread(_objectSpread({}, node.data), {}, {\n            inputs: newInputs\n          });\n        }\n\n        onNodesChange([node]);\n        return node;\n      });\n    });\n  };\n\n  var removeEdge = function removeEdge(edgeId) {\n    console.log('WDGES: ');\n    console.log(edges);\n    var edge = edges.find(function (e) {\n      return e.id === edgeId;\n    });\n    var newEdges = edges.filter(function (edge) {\n      console.log(edge.source);\n      return edge.id != edgeId;\n    });\n    setEdges(newEdges);\n    removeChild(edge.source, edge.target);\n  };\n\n  var sharedFunctions = {\n    updateNodeSdf: updateNodeSdf,\n    removeEdge: removeEdge\n  };\n\n  var onConnect = function onConnect(params) {\n    var sourceNode = nodes.find(function (n) {\n      return n.id === params.source;\n    }); // CREAMOS EDGE\n\n    setEdges(function (eds) {\n      return addEdge(_objectSpread(_objectSpread({}, params), {}, {\n        type: 'buttonEdge',\n        animated: true,\n        markerEnd: {\n          type: MarkerType.Arrow,\n          color: '#000'\n        }\n      }), eds);\n    }); // AÑADIMOS HIJO AL PADRE\n\n    var newChildren = sourceNode.data.children;\n    newChildren.push(params.target);\n    setNodes(function (nds) {\n      return nds.map(function (node) {\n        if (node.id === params.source) {\n          console.log(\"A\\xD1ADIENDO HIJO \".concat(params.target, \" A \").concat(params.source)); // var newChildren = node.data.children;\n          // console.log(typeof newChildren);\n          // console.log(newChildren);\n          // newChildren.push(params.target);\n\n          console.log(newChildren);\n          node.data = _objectSpread(_objectSpread({}, node.data), {}, {\n            children: newChildren\n          });\n        }\n\n        if (node.id === params.target) {\n          console.log(\"INICIALIZANDO \".concat(params.source));\n          var newInputs = node.data.inputs;\n          newInputs[\"\".concat(params.source)] = sourceNode.data.sdf;\n          node.data = _objectSpread(_objectSpread({}, node.data), {}, {\n            inputs: newInputs\n          });\n        }\n\n        onNodesChange([node]);\n        return node;\n      });\n    }); // INICIAMOS HIJO\n  }; // useEffect(() => {\n  //   console.log('NODOS ACTUALIZADOS');\n  //   console.log(nodes);\n  // }, [nodes]);\n\n\n  useEffect(function () {\n    console.log('NUEVO EDGE:');\n    console.log(edges);\n  }, [edges]);\n\n  var onSave = function onSave() {\n    if (rfInstance) {\n      var flow = rfInstance.toObject();\n      console.log('FLOW SAVED:');\n      console.log(flow);\n      localStorage.setItem(flowKey, JSON.stringify(flow));\n    }\n  };\n\n  var onLoad = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n      var flow, _flow$viewport, _flow$viewport$x, x, _flow$viewport$y, y, _flow$viewport$zoom, zoom;\n\n      return _regeneratorRuntime().wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              flow = JSON.parse(localStorage.getItem(flowKey));\n\n              if (flow) {\n                console.log('FLOW LOADED:');\n                console.log(flow);\n                _flow$viewport = flow.viewport, _flow$viewport$x = _flow$viewport.x, x = _flow$viewport$x === void 0 ? 0 : _flow$viewport$x, _flow$viewport$y = _flow$viewport.y, y = _flow$viewport$y === void 0 ? 0 : _flow$viewport$y, _flow$viewport$zoom = _flow$viewport.zoom, zoom = _flow$viewport$zoom === void 0 ? 1 : _flow$viewport$zoom;\n                setNodes(flow.nodes || []);\n                setEdges(flow.edges || []);\n              }\n\n            case 2:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function onLoad() {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  var newNode = function newNode(nodeType) {\n    var xPos = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n    var yPos = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n    console.log('CREANDO ' + nodeType);\n    setId(id + 1);\n    var nodeId = \"node-\".concat(id);\n    return {\n      id: nodeId,\n      type: nodeType,\n      dragHandle: '.nodeHeader',\n      position: {\n        x: xPos,\n        y: yPos\n      },\n      data: {\n        inputs: {},\n        sdf: '',\n        children: []\n      }\n    };\n  };\n\n  var createAddNodeMousePos = function createAddNodeMousePos(nodeType) {\n    var _rfInstance$project = rfInstance.project({\n      x: mouseCoor[0],\n      y: mouseCoor[1]\n    }),\n        x = _rfInstance$project.x,\n        y = _rfInstance$project.y;\n\n    var node = newNode(nodeType, x, y);\n    nodes.push(node);\n    onNodesChange([node]);\n  };\n\n  var handleKey = function handleKey(e) {\n    var node = null;\n\n    var _rfInstance$project2 = rfInstance.project({\n      x: mouseCoor[0],\n      y: mouseCoor[1]\n    }),\n        x = _rfInstance$project2.x,\n        y = _rfInstance$project2.y;\n\n    if (e.key.toLowerCase() === 'p') node = newNode('primitiveNode', x, y);else if (e.key.toLowerCase() === 'b') node = newNode('booleanNode', x, y);else if (e.key.toLowerCase() === 'd') node = newNode('deformNode', x, y);else if (e.key.toLowerCase() === 't') node = newNode('transformNode', x, y);\n\n    if (node) {\n      nodes.push(node);\n      onNodesChange([node]); // Para actualizar\n    }\n  };\n\n  var handleMouse = function handleMouse(e) {\n    var bounds = reactFlowRef.current.getBoundingClientRect();\n    setMouseCoor([e.clientX - bounds.left, e.clientY - bounds.top]);\n  };\n\n  return /*#__PURE__*/React.createElement(React.Fragment, null, JSON.stringify(storage), /*#__PURE__*/React.createElement(ContextMenuTrigger, {\n    id: \"contextmenu\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 299,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    style: {\n      height: '100vh'\n    },\n    tabIndex: \"0\",\n    onKeyDown: handleKey,\n    onMouseMove: handleMouse,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 300,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(GraphProvider, {\n    value: sharedFunctions,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 301,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(ReactFlow, {\n    ref: reactFlowRef,\n    nodes: nodes,\n    edges: edges,\n    onNodesChange: onNodesChange,\n    onEdgesChange: onEdgesChange,\n    onConnect: onConnect // onDisconnect={onDisconnect}\n    ,\n    nodeTypes: graphNodeTypes,\n    edgeTypes: edgeTypes,\n    onInit: setRfInstance // onEdgeClick={(ev, edge) =>\n    //   setEdges(edges.filter((e) => e.id != edge.id))\n    // }\n    ,\n    snapToGrid: false,\n    fitView: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 302,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(Background, {\n    variant: \"lines\",\n    color: \"#aaa\",\n    gap: 10,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 320,\n      columnNumber: 15\n    }\n  }), /*#__PURE__*/React.createElement(CustomControls, {\n    save: onSave,\n    load: onLoad,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 321,\n      columnNumber: 15\n    }\n  }))))), /*#__PURE__*/React.createElement(CustomContextMenu, {\n    newNode: createAddNodeMousePos,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 326,\n      columnNumber: 7\n    }\n  }));\n}","map":{"version":3,"names":["React","useState","useEffect","useRef","ReactFlow","addEdge","Background","useNodesState","useEdgesState","MarkerType","project","useReactFlow","PrimitiveNode","BooleanNode","DeformNode","TransformNode","ButtonEdge","CustomControls","GraphProvider","CustomContextMenu","useLocalStorage","ContextMenu","MenuItem","ContextMenuTrigger","flowKey","graphNodeTypes","primitiveNode","booleanNode","deformNode","transformNode","edgeTypes","buttonEdge","initialNodes","id","type","position","x","y","dragHandle","data","default","inputs","sdf","children","onInit","reactFlowInstance","console","log","Graph","nodes","setNodes","onNodesChange","edges","setEdges","onEdgesChange","rfInstance","setRfInstance","setId","mouseCoor","setMouseCoor","storage","setStorage","reactFlowRef","updateNodeSdf","newSdf","parent","nodesCopy","find","node","child","newInputs","removeChild","nds","map","newChildren","filter","c","removeEdge","edgeId","edge","e","newEdges","source","target","sharedFunctions","onConnect","params","sourceNode","n","eds","animated","markerEnd","Arrow","color","push","onSave","flow","toObject","localStorage","setItem","JSON","stringify","onLoad","parse","getItem","viewport","zoom","newNode","nodeType","xPos","yPos","nodeId","createAddNodeMousePos","handleKey","key","toLowerCase","handleMouse","bounds","current","getBoundingClientRect","clientX","left","clientY","top","height"],"sources":["C:/Users/daniz/TFG/Aplicacion/src/GraphPage/Graph.js"],"sourcesContent":["import React, { useState } from 'react';\r\nimport { useEffect, useRef } from 'react';\r\nimport ReactFlow, {\r\n  addEdge,\r\n  Background,\r\n  useNodesState,\r\n  useEdgesState,\r\n  MarkerType,\r\n  project,\r\n  useReactFlow\r\n} from 'react-flow-renderer';\r\nimport PrimitiveNode from '../CustomNodes/PrimitiveNode.js';\r\nimport BooleanNode from '../CustomNodes/BooleanNode.js';\r\nimport DeformNode from '../CustomNodes/DeformNode.js';\r\nimport TransformNode from '../CustomNodes/TransformNode.js';\r\n\r\nimport ButtonEdge from '../CustomNodes/ButtonEdge';\r\nimport CustomControls from '../CustomComponents/CustomControls.js';\r\nimport '../styles.css';\r\nimport { GraphProvider } from './GraphContext.js';\r\nimport CustomContextMenu from '../CustomComponents/CustomContextMenu.js';\r\nimport useLocalStorage from '../storageHook.js';\r\n\r\nimport { ContextMenu, MenuItem, ContextMenuTrigger } from 'react-contextmenu';\r\n\r\n\r\nconst flowKey = 'savedGraph';\r\nconst graphNodeTypes = { primitiveNode: PrimitiveNode, booleanNode: BooleanNode, deformNode: DeformNode, transformNode: TransformNode };\r\nconst edgeTypes = { buttonEdge: ButtonEdge };\r\n\r\nconst initialNodes = [\r\n  {\r\n    id: 'prim-0',\r\n    type: 'primitiveNode',\r\n    position: { x: -50, y: -350 },\r\n    dragHandle: ' .nodeHeader',\r\n    data: { default: 'Cube', inputs: {}, sdf: '', children: [] },\r\n  },\r\n  {\r\n    id: 'prim-1',\r\n    type: 'primitiveNode',\r\n    dragHandle: '.nodeHeader',\r\n    position: { x: -50, y: 125 },\r\n    data: { inputs: {}, sdf: '', children: [] },\r\n  },\r\n  {\r\n    id: 'prim-2',\r\n    type: 'primitiveNode',\r\n    position: { x: -50, y: 600 },\r\n    dragHandle: '.nodeHeader',\r\n    data: { inputs: {}, sdf: '', children: [] },\r\n  },\r\n  {\r\n    id: 'deform-0',\r\n    type: 'deformNode',\r\n    dragHandle: '.nodeHeader',\r\n    position: { x: 200, y: -125 },\r\n    data: { inputs: {}, sdf: '', children: [] },\r\n  },\r\n  {\r\n    id: 'transform-0',\r\n    type: 'transformNode',\r\n    dragHandle: '.nodeHeader',\r\n    position: { x: 450, y: 150 },\r\n    data: { inputs: {}, sdf: '', children: [] },\r\n  },\r\n  {\r\n    id: 'bool-2',\r\n    type: 'booleanNode',\r\n    dragHandle: '.nodeHeader',\r\n    position: { x: 200, y: 375 },\r\n    data: { inputs: {}, sdf: '', children: [] },\r\n  },\r\n];\r\n\r\nconst onInit = (reactFlowInstance) =>\r\n  console.log('flow loaded:', reactFlowInstance);\r\n\r\nexport default function Graph() {\r\n  const [nodes, setNodes, onNodesChange] = useNodesState(initialNodes);\r\n  const [edges, setEdges, onEdgesChange] = useEdgesState([]);\r\n  const [rfInstance, setRfInstance] = useState(null);\r\n  const [id, setId] = React.useState(3);\r\n  const [mouseCoor, setMouseCoor] = useState([0, 0]);\r\n  const [storage, setStorage] = useLocalStorage(\"user_implicits\", {});\r\n  const reactFlowRef = useRef(null);\r\n\r\n  const updateNodeSdf = (id, newSdf, parent) => {\r\n    console.log('ACTUALIZADONDO SDF DE ' + id);\r\n    var nodesCopy = [...nodes];\r\n    var parent = nodesCopy.find((node) => node.id === id);\r\n    parent.data = {\r\n      ...parent.data,\r\n      sdf: newSdf,\r\n    };\r\n\r\n    for (var child of parent.data.children) {\r\n      for (var node of nodesCopy) {\r\n        if (node.id === child) {\r\n          var newInputs = node.data.inputs;\r\n          newInputs[`${id}`] = newSdf;\r\n\r\n          node.data = {\r\n            ...node.data,\r\n            inputs: newInputs,\r\n          };\r\n        }\r\n      }\r\n    }\r\n\r\n    setNodes(nodesCopy);\r\n  };\r\n\r\n  const removeChild = (parent, child) => {\r\n    setNodes((nds) =>\r\n      nds.map((node) => {\r\n        if (node.id === parent) {\r\n          console.log(`ELIMINANDO HIJO ${child} DE ${parent}`);\r\n\r\n          var newChildren = node.data.children;\r\n          newChildren = newChildren.filter(function (c) {\r\n            return c.id != child;\r\n          });\r\n\r\n          node.data = {\r\n            ...node.data,\r\n            children: newChildren,\r\n          };\r\n        }\r\n        if (node.id === child) {\r\n          console.log(`ACTUALIZANDO ${child}`);\r\n          var newInputs = node.data.inputs;\r\n          newInputs[`${parent}`] = '';\r\n          node.data = {\r\n            ...node.data,\r\n            inputs: newInputs,\r\n          };\r\n        }\r\n\r\n        onNodesChange([node]);\r\n        return node;\r\n      })\r\n    );\r\n  };\r\n\r\n  const removeEdge = (edgeId) => {\r\n    console.log('WDGES: ');\r\n    console.log(edges);\r\n    const edge = edges.find((e) => e.id === edgeId);\r\n\r\n    var newEdges = edges.filter((edge) => {\r\n      console.log(edge.source);\r\n      return edge.id != edgeId;\r\n    });\r\n\r\n    setEdges(newEdges);\r\n    removeChild(edge.source, edge.target);\r\n  };\r\n\r\n  const sharedFunctions = {\r\n    updateNodeSdf,\r\n    removeEdge,\r\n  };\r\n\r\n  const onConnect = (params) => {\r\n    const sourceNode = nodes.find((n) => n.id === params.source);\r\n\r\n    // CREAMOS EDGE\r\n    setEdges((eds) =>\r\n      addEdge(\r\n        {\r\n          ...params,\r\n          type: 'buttonEdge',\r\n          animated: true,\r\n          markerEnd: { type: MarkerType.Arrow, color: '#000' },\r\n        },\r\n        eds\r\n      )\r\n    );\r\n\r\n    // AÑADIMOS HIJO AL PADRE\r\n    var newChildren = sourceNode.data.children;\r\n    newChildren.push(params.target);\r\n\r\n    setNodes((nds) =>\r\n      nds.map((node) => {\r\n        if (node.id === params.source) {\r\n          console.log(`AÑADIENDO HIJO ${params.target} A ${params.source}`);\r\n\r\n          // var newChildren = node.data.children;\r\n          // console.log(typeof newChildren);\r\n          // console.log(newChildren);\r\n          // newChildren.push(params.target);\r\n          console.log(newChildren);\r\n          node.data = {\r\n            ...node.data,\r\n            children: newChildren,\r\n          };\r\n        }\r\n        if (node.id === params.target) {\r\n          console.log(`INICIALIZANDO ${params.source}`);\r\n          var newInputs = node.data.inputs;\r\n          newInputs[`${params.source}`] = sourceNode.data.sdf;\r\n          node.data = {\r\n            ...node.data,\r\n            inputs: newInputs,\r\n          };\r\n        }\r\n\r\n        onNodesChange([node]);\r\n        return node;\r\n      })\r\n    );\r\n\r\n    // INICIAMOS HIJO\r\n  };\r\n\r\n  // useEffect(() => {\r\n  //   console.log('NODOS ACTUALIZADOS');\r\n  //   console.log(nodes);\r\n  // }, [nodes]);\r\n\r\n  useEffect(() => {\r\n    console.log('NUEVO EDGE:');\r\n    console.log(edges);\r\n  }, [edges]);\r\n\r\n  const onSave = () => {\r\n    if (rfInstance) {\r\n      const flow = rfInstance.toObject();\r\n      console.log('FLOW SAVED:');\r\n      console.log(flow);\r\n      localStorage.setItem(flowKey, JSON.stringify(flow));\r\n    }\r\n  };\r\n\r\n  const onLoad = async () => {\r\n    const flow = JSON.parse(localStorage.getItem(flowKey));\r\n\r\n    if (flow) {\r\n      console.log('FLOW LOADED:');\r\n      console.log(flow);\r\n      const { x = 0, y = 0, zoom = 1 } = flow.viewport;\r\n      setNodes(flow.nodes || []);\r\n      setEdges(flow.edges || []);\r\n    }\r\n  };\r\n\r\n  const newNode = (nodeType, xPos = 0, yPos = 0) => {\r\n    console.log('CREANDO ' + nodeType);\r\n    setId(id + 1);\r\n    const nodeId = `node-${id}`;\r\n    return {\r\n      id: nodeId,\r\n      type: nodeType,\r\n      dragHandle: '.nodeHeader',\r\n      position: { x: xPos, y: yPos },\r\n      data: {\r\n        inputs: {},\r\n        sdf: '',\r\n        children: [],\r\n      },\r\n    };\r\n  };\r\n\r\n  const createAddNodeMousePos = (nodeType) => {\r\n    const { x, y } = rfInstance.project({ x: mouseCoor[0], y: mouseCoor[1] });\r\n    let node = newNode(nodeType, x, y);\r\n    nodes.push(node);\r\n    onNodesChange([node]);\r\n  };\r\n\r\n  const handleKey = (e) => {\r\n    let node = null;\r\n\r\n    const { x, y } = rfInstance.project({ x: mouseCoor[0], y: mouseCoor[1] });\r\n\r\n\r\n    if (e.key.toLowerCase() === 'p') node = newNode('primitiveNode', x, y);\r\n    else if (e.key.toLowerCase() === 'b') node = newNode('booleanNode', x, y);\r\n    else if (e.key.toLowerCase() === 'd') node = newNode('deformNode', x, y);\r\n    else if (e.key.toLowerCase() === 't') node = newNode('transformNode', x, y);\r\n\r\n    if (node) {\r\n      nodes.push(node);\r\n      onNodesChange([node]); // Para actualizar\r\n    }\r\n\r\n  };\r\n\r\n  const handleMouse = (e) => {\r\n    const bounds = reactFlowRef.current.getBoundingClientRect();\r\n    setMouseCoor([e.clientX - bounds.left, e.clientY - bounds.top]);\r\n  };\r\n\r\n  return (\r\n    <>\r\n    {JSON.stringify(storage)}\r\n      <ContextMenuTrigger id='contextmenu'>\r\n        <div style={{ height: '100vh' }} tabIndex='0' onKeyDown={handleKey} onMouseMove={handleMouse}>\r\n          <GraphProvider value={sharedFunctions}>\r\n            <ReactFlow\r\n              ref={reactFlowRef}\r\n              nodes={nodes}\r\n              edges={edges}\r\n              onNodesChange={onNodesChange}\r\n              onEdgesChange={onEdgesChange}\r\n              onConnect={onConnect}\r\n              // onDisconnect={onDisconnect}\r\n\r\n              nodeTypes={graphNodeTypes}\r\n              edgeTypes={edgeTypes}\r\n              onInit={setRfInstance}\r\n              // onEdgeClick={(ev, edge) =>\r\n              //   setEdges(edges.filter((e) => e.id != edge.id))\r\n              // }\r\n              snapToGrid={false}\r\n              fitView\r\n            >\r\n              <Background variant='lines' color='#aaa' gap={10} />\r\n              <CustomControls save={onSave} load={onLoad} />\r\n            </ReactFlow>\r\n          </GraphProvider>\r\n        </div>\r\n      </ContextMenuTrigger>\r\n      <CustomContextMenu newNode={createAddNodeMousePos} />\r\n    </>\r\n  );\r\n}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}