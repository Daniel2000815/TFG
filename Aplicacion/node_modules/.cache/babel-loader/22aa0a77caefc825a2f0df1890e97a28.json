{"ast":null,"code":"\"use strict\";\n\nvar __extends = this && this.__extends || function () {\n  var _extendStatics = function extendStatics(d, b) {\n    _extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) {\n        if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n      }\n    };\n\n    return _extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n\n    _extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __read = this && this.__read || function (o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o),\n      r,\n      ar = [],\n      e;\n\n  try {\n    while ((n === void 0 || n-- > 0) && !(r = i.next()).done) {\n      ar.push(r.value);\n    }\n  } catch (error) {\n    e = {\n      error: error\n    };\n  } finally {\n    try {\n      if (r && !r.done && (m = i[\"return\"])) m.call(i);\n    } finally {\n      if (e) throw e.error;\n    }\n  }\n\n  return ar;\n};\n\nvar __spreadArray = this && this.__spreadArray || function (to, from, pack) {\n  if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n    if (ar || !(i in from)) {\n      if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n      ar[i] = from[i];\n    }\n  }\n  return to.concat(ar || Array.prototype.slice.call(from));\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.CommonMfracMixin = void 0;\n\nfunction CommonMfracMixin(Base) {\n  return function (_super) {\n    __extends(class_1, _super);\n\n    function class_1() {\n      var args = [];\n\n      for (var _i = 0; _i < arguments.length; _i++) {\n        args[_i] = arguments[_i];\n      }\n\n      var _this = _super.apply(this, __spreadArray([], __read(args), false)) || this;\n\n      _this.bevel = null;\n      _this.pad = _this.node.getProperty('withDelims') ? 0 : _this.font.params.nulldelimiterspace;\n\n      if (_this.node.attributes.get('bevelled')) {\n        var H = _this.getBevelData(_this.isDisplay()).H;\n\n        var bevel = _this.bevel = _this.createMo('/');\n\n        bevel.node.attributes.set('symmetric', true);\n        bevel.canStretch(1);\n        bevel.getStretchedVariant([H], true);\n      }\n\n      return _this;\n    }\n\n    class_1.prototype.computeBBox = function (bbox, recompute) {\n      if (recompute === void 0) {\n        recompute = false;\n      }\n\n      bbox.empty();\n\n      var _a = this.node.attributes.getList('linethickness', 'bevelled'),\n          linethickness = _a.linethickness,\n          bevelled = _a.bevelled;\n\n      var display = this.isDisplay();\n      var w = null;\n\n      if (bevelled) {\n        this.getBevelledBBox(bbox, display);\n      } else {\n        var thickness = this.length2em(String(linethickness), .06);\n        w = -2 * this.pad;\n\n        if (thickness === 0) {\n          this.getAtopBBox(bbox, display);\n        } else {\n          this.getFractionBBox(bbox, display, thickness);\n          w -= .2;\n        }\n\n        w += bbox.w;\n      }\n\n      bbox.clean();\n      this.setChildPWidths(recompute, w);\n    };\n\n    class_1.prototype.getFractionBBox = function (bbox, display, t) {\n      var nbox = this.childNodes[0].getOuterBBox();\n      var dbox = this.childNodes[1].getOuterBBox();\n      var tex = this.font.params;\n      var a = tex.axis_height;\n\n      var _a = this.getTUV(display, t),\n          T = _a.T,\n          u = _a.u,\n          v = _a.v;\n\n      bbox.combine(nbox, 0, a + T + Math.max(nbox.d * nbox.rscale, u));\n      bbox.combine(dbox, 0, a - T - Math.max(dbox.h * dbox.rscale, v));\n      bbox.w += 2 * this.pad + .2;\n    };\n\n    class_1.prototype.getTUV = function (display, t) {\n      var tex = this.font.params;\n      var a = tex.axis_height;\n      var T = (display ? 3.5 : 1.5) * t;\n      return {\n        T: (display ? 3.5 : 1.5) * t,\n        u: (display ? tex.num1 : tex.num2) - a - T,\n        v: (display ? tex.denom1 : tex.denom2) + a - T\n      };\n    };\n\n    class_1.prototype.getAtopBBox = function (bbox, display) {\n      var _a = this.getUVQ(display),\n          u = _a.u,\n          v = _a.v,\n          nbox = _a.nbox,\n          dbox = _a.dbox;\n\n      bbox.combine(nbox, 0, u);\n      bbox.combine(dbox, 0, -v);\n      bbox.w += 2 * this.pad;\n    };\n\n    class_1.prototype.getUVQ = function (display) {\n      var nbox = this.childNodes[0].getOuterBBox();\n      var dbox = this.childNodes[1].getOuterBBox();\n      var tex = this.font.params;\n\n      var _a = __read(display ? [tex.num1, tex.denom1] : [tex.num3, tex.denom2], 2),\n          u = _a[0],\n          v = _a[1];\n\n      var p = (display ? 7 : 3) * tex.rule_thickness;\n      var q = u - nbox.d * nbox.scale - (dbox.h * dbox.scale - v);\n\n      if (q < p) {\n        u += (p - q) / 2;\n        v += (p - q) / 2;\n        q = p;\n      }\n\n      return {\n        u: u,\n        v: v,\n        q: q,\n        nbox: nbox,\n        dbox: dbox\n      };\n    };\n\n    class_1.prototype.getBevelledBBox = function (bbox, display) {\n      var _a = this.getBevelData(display),\n          u = _a.u,\n          v = _a.v,\n          delta = _a.delta,\n          nbox = _a.nbox,\n          dbox = _a.dbox;\n\n      var lbox = this.bevel.getOuterBBox();\n      bbox.combine(nbox, 0, u);\n      bbox.combine(lbox, bbox.w - delta / 2, 0);\n      bbox.combine(dbox, bbox.w - delta / 2, v);\n    };\n\n    class_1.prototype.getBevelData = function (display) {\n      var nbox = this.childNodes[0].getOuterBBox();\n      var dbox = this.childNodes[1].getOuterBBox();\n      var delta = display ? .4 : .15;\n      var H = Math.max(nbox.scale * (nbox.h + nbox.d), dbox.scale * (dbox.h + dbox.d)) + 2 * delta;\n      var a = this.font.params.axis_height;\n      var u = nbox.scale * (nbox.d - nbox.h) / 2 + a + delta;\n      var v = dbox.scale * (dbox.d - dbox.h) / 2 + a - delta;\n      return {\n        H: H,\n        delta: delta,\n        u: u,\n        v: v,\n        nbox: nbox,\n        dbox: dbox\n      };\n    };\n\n    class_1.prototype.canStretch = function (_direction) {\n      return false;\n    };\n\n    class_1.prototype.isDisplay = function () {\n      var _a = this.node.attributes.getList('displaystyle', 'scriptlevel'),\n          displaystyle = _a.displaystyle,\n          scriptlevel = _a.scriptlevel;\n\n      return displaystyle && scriptlevel === 0;\n    };\n\n    class_1.prototype.getWrapWidth = function (i) {\n      var attributes = this.node.attributes;\n\n      if (attributes.get('bevelled')) {\n        return this.childNodes[i].getOuterBBox().w;\n      }\n\n      var w = this.getBBox().w;\n      var thickness = this.length2em(attributes.get('linethickness'));\n      return w - (thickness ? .2 : 0) - 2 * this.pad;\n    };\n\n    class_1.prototype.getChildAlign = function (i) {\n      var attributes = this.node.attributes;\n      return attributes.get('bevelled') ? 'left' : attributes.get(['numalign', 'denomalign'][i]);\n    };\n\n    return class_1;\n  }(Base);\n}\n\nexports.CommonMfracMixin = CommonMfracMixin;","map":{"version":3,"mappings":"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","names":["CommonMfracMixin","Base","__extends","args","_this","pad","node","getProperty","font","params","nulldelimiterspace","attributes","get","getBevelData","isDisplay","H","bevel","createMo","set","canStretch","getStretchedVariant","class_1","bbox","recompute","empty","getList","linethickness","bevelled","display","w","getBevelledBBox","thickness","length2em","String","getAtopBBox","getFractionBBox","clean","setChildPWidths","t","nbox","childNodes","getOuterBBox","dbox","tex","a","axis_height","getTUV","T","u","v","combine","Math","max","d","rscale","h","num1","num2","denom1","denom2","getUVQ","num3","p","rule_thickness","q","scale","delta","lbox","_direction","displaystyle","scriptlevel","i","getBBox","exports"],"sourceRoot":"","sources":["../../../../ts/output/common/Wrappers/mfrac.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}