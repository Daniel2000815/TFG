{"ast":null,"code":"\"use strict\";\n\nvar __extends = this && this.__extends || function () {\n  var _extendStatics = function extendStatics(d, b) {\n    _extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) {\n        if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n      }\n    };\n\n    return _extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n\n    _extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.HTMLMathItem = void 0;\n\nvar MathItem_js_1 = require(\"../../core/MathItem.js\");\n\nvar HTMLMathItem = function (_super) {\n  __extends(HTMLMathItem, _super);\n\n  function HTMLMathItem(math, jax, display, start, end) {\n    if (display === void 0) {\n      display = true;\n    }\n\n    if (start === void 0) {\n      start = {\n        node: null,\n        n: 0,\n        delim: ''\n      };\n    }\n\n    if (end === void 0) {\n      end = {\n        node: null,\n        n: 0,\n        delim: ''\n      };\n    }\n\n    return _super.call(this, math, jax, display, start, end) || this;\n  }\n\n  Object.defineProperty(HTMLMathItem.prototype, \"adaptor\", {\n    get: function get() {\n      return this.inputJax.adaptor;\n    },\n    enumerable: false,\n    configurable: true\n  });\n\n  HTMLMathItem.prototype.updateDocument = function (_html) {\n    if (this.state() < MathItem_js_1.STATE.INSERTED) {\n      if (this.inputJax.processStrings) {\n        var node = this.start.node;\n\n        if (node === this.end.node) {\n          if (this.end.n && this.end.n < this.adaptor.value(this.end.node).length) {\n            this.adaptor.split(this.end.node, this.end.n);\n          }\n\n          if (this.start.n) {\n            node = this.adaptor.split(this.start.node, this.start.n);\n          }\n\n          this.adaptor.replace(this.typesetRoot, node);\n        } else {\n          if (this.start.n) {\n            node = this.adaptor.split(node, this.start.n);\n          }\n\n          while (node !== this.end.node) {\n            var next = this.adaptor.next(node);\n            this.adaptor.remove(node);\n            node = next;\n          }\n\n          this.adaptor.insert(this.typesetRoot, node);\n\n          if (this.end.n < this.adaptor.value(node).length) {\n            this.adaptor.split(node, this.end.n);\n          }\n\n          this.adaptor.remove(node);\n        }\n      } else {\n        this.adaptor.replace(this.typesetRoot, this.start.node);\n      }\n\n      this.start.node = this.end.node = this.typesetRoot;\n      this.start.n = this.end.n = 0;\n      this.state(MathItem_js_1.STATE.INSERTED);\n    }\n  };\n\n  HTMLMathItem.prototype.updateStyleSheet = function (document) {\n    document.addStyleSheet();\n  };\n\n  HTMLMathItem.prototype.removeFromDocument = function (restore) {\n    if (restore === void 0) {\n      restore = false;\n    }\n\n    if (this.state() >= MathItem_js_1.STATE.TYPESET) {\n      var adaptor = this.adaptor;\n      var node = this.start.node;\n      var math = adaptor.text('');\n\n      if (restore) {\n        var text = this.start.delim + this.math + this.end.delim;\n\n        if (this.inputJax.processStrings) {\n          math = adaptor.text(text);\n        } else {\n          var doc = adaptor.parse(text, 'text/html');\n          math = adaptor.firstChild(adaptor.body(doc));\n        }\n      }\n\n      if (adaptor.parent(node)) {\n        adaptor.replace(math, node);\n      }\n\n      this.start.node = this.end.node = math;\n      this.start.n = this.end.n = 0;\n    }\n  };\n\n  return HTMLMathItem;\n}(MathItem_js_1.AbstractMathItem);\n\nexports.HTMLMathItem = HTMLMathItem;","map":{"version":3,"mappings":"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","names":["__extends","math","jax","display","start","end","node","n","delim","_super","Object","HTMLMathItem","inputJax","adaptor","_html","state","MathItem_js_1","INSERTED","processStrings","value","length","split","replace","typesetRoot","next","remove","insert","document","addStyleSheet","restore","TYPESET","text","doc","parse","firstChild","body","parent","exports"],"sourceRoot":"","sources":["../../../ts/handlers/html/HTMLMathItem.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}