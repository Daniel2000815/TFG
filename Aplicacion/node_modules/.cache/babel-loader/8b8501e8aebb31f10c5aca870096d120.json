{"ast":null,"code":"\"use strict\";\n\nvar __extends = this && this.__extends || function () {\n  var _extendStatics = function extendStatics(d, b) {\n    _extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) {\n        if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n      }\n    };\n\n    return _extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n\n    _extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.SVGmaction = void 0;\n\nvar Wrapper_js_1 = require(\"../Wrapper.js\");\n\nvar maction_js_1 = require(\"../../common/Wrappers/maction.js\");\n\nvar maction_js_2 = require(\"../../common/Wrappers/maction.js\");\n\nvar maction_js_3 = require(\"../../../core/MmlTree/MmlNodes/maction.js\");\n\nvar SVGmaction = function (_super) {\n  __extends(SVGmaction, _super);\n\n  function SVGmaction() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  SVGmaction.prototype.toSVG = function (parent) {\n    var svg = this.standardSVGnode(parent);\n    var child = this.selected;\n\n    var _a = child.getOuterBBox(),\n        h = _a.h,\n        d = _a.d,\n        w = _a.w;\n\n    this.adaptor.append(this.element, this.svg('rect', {\n      width: this.fixed(w),\n      height: this.fixed(h + d),\n      y: this.fixed(-d),\n      fill: 'none',\n      'pointer-events': 'all'\n    }));\n    child.toSVG(svg);\n    var bbox = child.getOuterBBox();\n\n    if (child.element) {\n      child.place(bbox.L * bbox.rscale, 0);\n    }\n\n    this.action(this, this.data);\n  };\n\n  SVGmaction.prototype.setEventHandler = function (type, handler) {\n    this.element.addEventListener(type, handler);\n  };\n\n  SVGmaction.kind = maction_js_3.MmlMaction.prototype.kind;\n  SVGmaction.styles = {\n    '[jax=\"SVG\"] mjx-tool': {\n      display: 'inline-block',\n      position: 'relative',\n      width: 0,\n      height: 0\n    },\n    '[jax=\"SVG\"] mjx-tool > mjx-tip': {\n      position: 'absolute',\n      top: 0,\n      left: 0\n    },\n    'mjx-tool > mjx-tip': {\n      display: 'inline-block',\n      padding: '.2em',\n      border: '1px solid #888',\n      'font-size': '70%',\n      'background-color': '#F8F8F8',\n      color: 'black',\n      'box-shadow': '2px 2px 5px #AAAAAA'\n    },\n    'g[data-mml-node=\"maction\"][data-toggle]': {\n      cursor: 'pointer'\n    },\n    'mjx-status': {\n      display: 'block',\n      position: 'fixed',\n      left: '1em',\n      bottom: '1em',\n      'min-width': '25%',\n      padding: '.2em .4em',\n      border: '1px solid #888',\n      'font-size': '90%',\n      'background-color': '#F8F8F8',\n      color: 'black'\n    }\n  };\n  SVGmaction.actions = new Map([['toggle', [function (node, _data) {\n    node.adaptor.setAttribute(node.element, 'data-toggle', node.node.attributes.get('selection'));\n    var math = node.factory.jax.math;\n    var document = node.factory.jax.document;\n    var mml = node.node;\n    node.setEventHandler('click', function (event) {\n      if (!math.end.node) {\n        math.start.node = math.end.node = math.typesetRoot;\n        math.start.n = math.end.n = 0;\n      }\n\n      mml.nextToggleSelection();\n      math.rerender(document);\n      event.stopPropagation();\n    });\n  }, {}]], ['tooltip', [function (node, data) {\n    var tip = node.childNodes[1];\n    if (!tip) return;\n    var rect = node.firstChild();\n\n    if (tip.node.isKind('mtext')) {\n      var text = tip.node.getText();\n      node.adaptor.insert(node.svg('title', {}, [node.text(text)]), rect);\n    } else {\n      var adaptor_1 = node.adaptor;\n      var container_1 = node.jax.container;\n      var math = node.node.factory.create('math', {}, [node.childNodes[1].node]);\n      var tool_1 = node.html('mjx-tool', {}, [node.html('mjx-tip')]);\n      var hidden_1 = adaptor_1.append(rect, node.svg('foreignObject', {\n        style: {\n          display: 'none'\n        }\n      }, [tool_1]));\n      node.jax.processMath(math, adaptor_1.firstChild(tool_1));\n      node.childNodes[1].node.parent = node.node;\n      node.setEventHandler('mouseover', function (event) {\n        data.stopTimers(node, data);\n        data.hoverTimer.set(node, setTimeout(function () {\n          adaptor_1.setStyle(tool_1, 'left', '0');\n          adaptor_1.setStyle(tool_1, 'top', '0');\n          adaptor_1.append(container_1, tool_1);\n          var tbox = adaptor_1.nodeBBox(tool_1);\n          var nbox = adaptor_1.nodeBBox(node.element);\n          var dx = (nbox.right - tbox.left) / node.metrics.em + node.dx;\n          var dy = (nbox.bottom - tbox.bottom) / node.metrics.em + node.dy;\n          adaptor_1.setStyle(tool_1, 'left', node.px(dx));\n          adaptor_1.setStyle(tool_1, 'top', node.px(dy));\n        }, data.postDelay));\n        event.stopPropagation();\n      });\n      node.setEventHandler('mouseout', function (event) {\n        data.stopTimers(node, data);\n        var timer = setTimeout(function () {\n          return adaptor_1.append(hidden_1, tool_1);\n        }, data.clearDelay);\n        data.clearTimer.set(node, timer);\n        event.stopPropagation();\n      });\n    }\n  }, maction_js_2.TooltipData]], ['statusline', [function (node, data) {\n    var tip = node.childNodes[1];\n    if (!tip) return;\n\n    if (tip.node.isKind('mtext')) {\n      var adaptor_2 = node.adaptor;\n      var text_1 = tip.node.getText();\n      adaptor_2.setAttribute(node.element, 'data-statusline', text_1);\n      node.setEventHandler('mouseover', function (event) {\n        if (data.status === null) {\n          var body = adaptor_2.body(adaptor_2.document);\n          data.status = adaptor_2.append(body, node.html('mjx-status', {}, [node.text(text_1)]));\n        }\n\n        event.stopPropagation();\n      });\n      node.setEventHandler('mouseout', function (event) {\n        if (data.status) {\n          adaptor_2.remove(data.status);\n          data.status = null;\n        }\n\n        event.stopPropagation();\n      });\n    }\n  }, {\n    status: null\n  }]]]);\n  return SVGmaction;\n}((0, maction_js_1.CommonMactionMixin)(Wrapper_js_1.SVGWrapper));\n\nexports.SVGmaction = SVGmaction;","map":{"version":3,"mappings":"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","names":["__extends","SVGmaction","parent","svg","standardSVGnode","child","selected","getOuterBBox","h","d","w","adaptor","append","element","width","fixed","height","y","fill","toSVG","bbox","place","L","rscale","action","data","type","handler","addEventListener","maction_js_3","prototype","kind","display","position","top","left","padding","border","color","cursor","bottom","Map","node","_data","setAttribute","attributes","get","math","factory","jax","document","mml","setEventHandler","event","end","start","typesetRoot","n","nextToggleSelection","rerender","stopPropagation","tip","childNodes","rect","firstChild","isKind","text","getText","insert","adaptor_1","container_1","container","create","tool_1","html","hidden_1","style","processMath","stopTimers","hoverTimer","set","setTimeout","setStyle","tbox","nodeBBox","nbox","dx","right","metrics","em","dy","px","postDelay","timer","clearDelay","clearTimer","maction_js_2","adaptor_2","text_1","status","body","remove","Wrapper_js_1","exports"],"sourceRoot":"","sources":["../../../../ts/output/svg/Wrappers/maction.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}