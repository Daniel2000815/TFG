{"ast":null,"code":"\"use strict\";\n\nvar __extends = this && this.__extends || function () {\n  var _extendStatics = function extendStatics(d, b) {\n    _extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) {\n        if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n      }\n    };\n\n    return _extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n\n    _extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __read = this && this.__read || function (o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o),\n      r,\n      ar = [],\n      e;\n\n  try {\n    while ((n === void 0 || n-- > 0) && !(r = i.next()).done) {\n      ar.push(r.value);\n    }\n  } catch (error) {\n    e = {\n      error: error\n    };\n  } finally {\n    try {\n      if (r && !r.done && (m = i[\"return\"])) m.call(i);\n    } finally {\n      if (e) throw e.error;\n    }\n  }\n\n  return ar;\n};\n\nvar __values = this && this.__values || function (o) {\n  var s = typeof Symbol === \"function\" && Symbol.iterator,\n      m = s && o[s],\n      i = 0;\n  if (m) return m.call(o);\n  if (o && typeof o.length === \"number\") return {\n    next: function next() {\n      if (o && i >= o.length) o = void 0;\n      return {\n        value: o && o[i++],\n        done: !o\n      };\n    }\n  };\n  throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\n};\n\nvar __spreadArray = this && this.__spreadArray || function (to, from, pack) {\n  if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n    if (ar || !(i in from)) {\n      if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n      ar[i] = from[i];\n    }\n  }\n  return to.concat(ar || Array.prototype.slice.call(from));\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.EnvironmentMap = exports.CommandMap = exports.MacroMap = exports.DelimiterMap = exports.CharacterMap = exports.AbstractParseMap = exports.RegExpMap = exports.AbstractSymbolMap = exports.parseResult = void 0;\n\nvar Symbol_js_1 = require(\"./Symbol.js\");\n\nvar MapHandler_js_1 = require(\"./MapHandler.js\");\n\nfunction parseResult(result) {\n  return result === void 0 ? true : result;\n}\n\nexports.parseResult = parseResult;\n\nvar AbstractSymbolMap = function () {\n  function AbstractSymbolMap(_name, _parser) {\n    this._name = _name;\n    this._parser = _parser;\n    MapHandler_js_1.MapHandler.register(this);\n  }\n\n  Object.defineProperty(AbstractSymbolMap.prototype, \"name\", {\n    get: function get() {\n      return this._name;\n    },\n    enumerable: false,\n    configurable: true\n  });\n\n  AbstractSymbolMap.prototype.parserFor = function (symbol) {\n    return this.contains(symbol) ? this.parser : null;\n  };\n\n  AbstractSymbolMap.prototype.parse = function (_a) {\n    var _b = __read(_a, 2),\n        env = _b[0],\n        symbol = _b[1];\n\n    var parser = this.parserFor(symbol);\n    var mapped = this.lookup(symbol);\n    return parser && mapped ? parseResult(parser(env, mapped)) : null;\n  };\n\n  Object.defineProperty(AbstractSymbolMap.prototype, \"parser\", {\n    get: function get() {\n      return this._parser;\n    },\n    set: function set(parser) {\n      this._parser = parser;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  return AbstractSymbolMap;\n}();\n\nexports.AbstractSymbolMap = AbstractSymbolMap;\n\nvar RegExpMap = function (_super) {\n  __extends(RegExpMap, _super);\n\n  function RegExpMap(name, parser, _regExp) {\n    var _this = _super.call(this, name, parser) || this;\n\n    _this._regExp = _regExp;\n    return _this;\n  }\n\n  RegExpMap.prototype.contains = function (symbol) {\n    return this._regExp.test(symbol);\n  };\n\n  RegExpMap.prototype.lookup = function (symbol) {\n    return this.contains(symbol) ? symbol : null;\n  };\n\n  return RegExpMap;\n}(AbstractSymbolMap);\n\nexports.RegExpMap = RegExpMap;\n\nvar AbstractParseMap = function (_super) {\n  __extends(AbstractParseMap, _super);\n\n  function AbstractParseMap() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this.map = new Map();\n    return _this;\n  }\n\n  AbstractParseMap.prototype.lookup = function (symbol) {\n    return this.map.get(symbol);\n  };\n\n  AbstractParseMap.prototype.contains = function (symbol) {\n    return this.map.has(symbol);\n  };\n\n  AbstractParseMap.prototype.add = function (symbol, object) {\n    this.map.set(symbol, object);\n  };\n\n  AbstractParseMap.prototype.remove = function (symbol) {\n    this.map.delete(symbol);\n  };\n\n  return AbstractParseMap;\n}(AbstractSymbolMap);\n\nexports.AbstractParseMap = AbstractParseMap;\n\nvar CharacterMap = function (_super) {\n  __extends(CharacterMap, _super);\n\n  function CharacterMap(name, parser, json) {\n    var e_1, _a;\n\n    var _this = _super.call(this, name, parser) || this;\n\n    try {\n      for (var _b = __values(Object.keys(json)), _c = _b.next(); !_c.done; _c = _b.next()) {\n        var key = _c.value;\n        var value = json[key];\n\n        var _d = __read(typeof value === 'string' ? [value, null] : value, 2),\n            char = _d[0],\n            attrs = _d[1];\n\n        var character = new Symbol_js_1.Symbol(key, char, attrs);\n\n        _this.add(key, character);\n      }\n    } catch (e_1_1) {\n      e_1 = {\n        error: e_1_1\n      };\n    } finally {\n      try {\n        if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n      } finally {\n        if (e_1) throw e_1.error;\n      }\n    }\n\n    return _this;\n  }\n\n  return CharacterMap;\n}(AbstractParseMap);\n\nexports.CharacterMap = CharacterMap;\n\nvar DelimiterMap = function (_super) {\n  __extends(DelimiterMap, _super);\n\n  function DelimiterMap() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  DelimiterMap.prototype.parse = function (_a) {\n    var _b = __read(_a, 2),\n        env = _b[0],\n        symbol = _b[1];\n\n    return _super.prototype.parse.call(this, [env, '\\\\' + symbol]);\n  };\n\n  return DelimiterMap;\n}(CharacterMap);\n\nexports.DelimiterMap = DelimiterMap;\n\nvar MacroMap = function (_super) {\n  __extends(MacroMap, _super);\n\n  function MacroMap(name, json, functionMap) {\n    var e_2, _a;\n\n    var _this = _super.call(this, name, null) || this;\n\n    try {\n      for (var _b = __values(Object.keys(json)), _c = _b.next(); !_c.done; _c = _b.next()) {\n        var key = _c.value;\n        var value = json[key];\n\n        var _d = __read(typeof value === 'string' ? [value] : value),\n            func = _d[0],\n            attrs = _d.slice(1);\n\n        var character = new Symbol_js_1.Macro(key, functionMap[func], attrs);\n\n        _this.add(key, character);\n      }\n    } catch (e_2_1) {\n      e_2 = {\n        error: e_2_1\n      };\n    } finally {\n      try {\n        if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n      } finally {\n        if (e_2) throw e_2.error;\n      }\n    }\n\n    return _this;\n  }\n\n  MacroMap.prototype.parserFor = function (symbol) {\n    var macro = this.lookup(symbol);\n    return macro ? macro.func : null;\n  };\n\n  MacroMap.prototype.parse = function (_a) {\n    var _b = __read(_a, 2),\n        env = _b[0],\n        symbol = _b[1];\n\n    var macro = this.lookup(symbol);\n    var parser = this.parserFor(symbol);\n\n    if (!macro || !parser) {\n      return null;\n    }\n\n    return parseResult(parser.apply(void 0, __spreadArray([env, macro.symbol], __read(macro.args), false)));\n  };\n\n  return MacroMap;\n}(AbstractParseMap);\n\nexports.MacroMap = MacroMap;\n\nvar CommandMap = function (_super) {\n  __extends(CommandMap, _super);\n\n  function CommandMap() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  CommandMap.prototype.parse = function (_a) {\n    var _b = __read(_a, 2),\n        env = _b[0],\n        symbol = _b[1];\n\n    var macro = this.lookup(symbol);\n    var parser = this.parserFor(symbol);\n\n    if (!macro || !parser) {\n      return null;\n    }\n\n    var saveCommand = env.currentCS;\n    env.currentCS = '\\\\' + symbol;\n    var result = parser.apply(void 0, __spreadArray([env, '\\\\' + macro.symbol], __read(macro.args), false));\n    env.currentCS = saveCommand;\n    return parseResult(result);\n  };\n\n  return CommandMap;\n}(MacroMap);\n\nexports.CommandMap = CommandMap;\n\nvar EnvironmentMap = function (_super) {\n  __extends(EnvironmentMap, _super);\n\n  function EnvironmentMap(name, parser, json, functionMap) {\n    var _this = _super.call(this, name, json, functionMap) || this;\n\n    _this.parser = parser;\n    return _this;\n  }\n\n  EnvironmentMap.prototype.parse = function (_a) {\n    var _b = __read(_a, 2),\n        env = _b[0],\n        symbol = _b[1];\n\n    var macro = this.lookup(symbol);\n    var envParser = this.parserFor(symbol);\n\n    if (!macro || !envParser) {\n      return null;\n    }\n\n    return parseResult(this.parser(env, macro.symbol, envParser, macro.args));\n  };\n\n  return EnvironmentMap;\n}(MacroMap);\n\nexports.EnvironmentMap = EnvironmentMap;","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAyBA;;AACA;;AAkDA,SAAgBA,WAAhB,CAA4BC,MAA5B,EAA+C;EAC7C,OAAOA,MAAM,KAAK,KAAK,CAAhB,GAAoB,IAApB,GAA2BA,MAAlC;AACD;;AAFDC;;AAQA;EAQE,2BAAoBC,KAApB,EAA2CC,OAA3C,EAA+D;IAA3C;IAAuB;IACzCC,2BAAWC,QAAX,CAAoB,IAApB;EACD;;EAMDC,sBAAWC,2BAAX,EAAW,MAAX,EAAe;SAAf;MACE,OAAO,KAAKL,KAAZ;IACD,CAFc;qBAAA;;EAAA,CAAf;;EAcOK,wCAAP,UAAiBC,MAAjB,EAA+B;IAC7B,OAAO,KAAKC,QAAL,CAAcD,MAAd,IAAwB,KAAKE,MAA7B,GAAsC,IAA7C;EACD,CAFM;;EAQAH,oCAAP,UAAaI,EAAb,EAAsC;QAAzBC;QAACC,GAAG;QAAEL,MAAM;;IACvB,IAAIE,MAAM,GAAG,KAAKI,SAAL,CAAeN,MAAf,CAAb;IACA,IAAIO,MAAM,GAAG,KAAKC,MAAL,CAAYR,MAAZ,CAAb;IACA,OAAQE,MAAM,IAAIK,MAAX,GAAqBhB,WAAW,CAACW,MAAM,CAACG,GAAD,EAAME,MAAN,CAAP,CAAhC,GAA+D,IAAtE;EACD,CAJM;;EAOPT,sBAAWC,2BAAX,EAAW,QAAX,EAAiB;SAIjB;MACE,OAAO,KAAKJ,OAAZ;IACD,CANgB;SAAjB,aAAkBO,MAAlB,EAAqC;MACnC,KAAKP,OAAL,GAAeO,MAAf;IACD,CAFgB;qBAAA;;EAAA,CAAjB;EAeF;AAAC,CA5DD;;AAAsBT;;AAmEtB;EAA+BgB;;EAS7B,mBAAYC,IAAZ,EAA0BR,MAA1B,EAAuDS,OAAvD,EAAsE;IAAtE,YACEC,kBAAMF,IAAN,EAAYR,MAAZ,KAAmB,IADrB;;IAAuDW;;EAEtD;;EAMMC,+BAAP,UAAgBd,MAAhB,EAA8B;IAC5B,OAAO,KAAKW,OAAL,CAAaI,IAAb,CAAkBf,MAAlB,CAAP;EACD,CAFM;;EAQAc,6BAAP,UAAcd,MAAd,EAA4B;IAC1B,OAAO,KAAKC,QAAL,CAAcD,MAAd,IAAwBA,MAAxB,GAAiC,IAAxC;EACD,CAFM;;EAIT;AAAC,CA7BD,CAA+BD,iBAA/B;;AAAaN;;AAsCb;EAAkDgB;;EAAlD;IAAA;;IAEUI,YAAsB,IAAIG,GAAJ,EAAtB;;EAiCT;;EA5BQC,oCAAP,UAAcjB,MAAd,EAA4B;IAC1B,OAAO,KAAKkB,GAAL,CAASC,GAAT,CAAanB,MAAb,CAAP;EACD,CAFM;;EAOAiB,sCAAP,UAAgBjB,MAAhB,EAA8B;IAC5B,OAAO,KAAKkB,GAAL,CAASE,GAAT,CAAapB,MAAb,CAAP;EACD,CAFM;;EASAiB,iCAAP,UAAWjB,MAAX,EAA2BqB,MAA3B,EAAoC;IAClC,KAAKH,GAAL,CAASI,GAAT,CAAatB,MAAb,EAAqBqB,MAArB;EACD,CAFM;;EAQAJ,oCAAP,UAAcjB,MAAd,EAA4B;IAC1B,KAAKkB,GAAL,CAASK,MAAT,CAAgBvB,MAAhB;EACD,CAFM;;EAIT;AAAC,CAnCD,CAAkDD,iBAAlD;;AAAsBN;;AA4CtB;EAAkCgB;;EAQhC,sBAAYC,IAAZ,EAA0BR,MAA1B,EACYsB,IADZ,EACkE;;;IADlE,YAEEZ,kBAAMF,IAAN,EAAYR,MAAZ,KAAmB,IAFrB;;;MAGE,KAAkB,wBAAM,CAACuB,IAAP,CAAYD,IAAZ,IAAiBE,cAAnC,EAAmC,QAAnC,EAAmCA,cAAnC,EAAqC;QAAhC,IAAMC,GAAG,WAAT;QACH,IAAIC,KAAK,GAAGJ,IAAI,CAACG,GAAD,CAAhB;;QACI,gBAAiB,OAAOC,KAAP,KAAkB,QAAnB,GAA+B,CAACA,KAAD,EAAQ,IAAR,CAA/B,GAA+CA,KAA/D,EAAoE,CAApE;QAAA,IAACC,IAAI,QAAL;QAAA,IAAOC,KAAK,QAAZ;;QACJ,IAAIC,SAAS,GAAG,IAAIC,kBAAJ,CAAWL,GAAX,EAAgBE,IAAhB,EAAsBC,KAAtB,CAAhB;;QACAjB,KAAI,CAACoB,GAAL,CAASN,GAAT,EAAcI,SAAd;MACD;;;;;;;;;;;;;;EACF;;EAEH;AAAC,CAnBD,CAAkCd,gBAAlC;;AAAaxB;;AA4Bb;EAAkCgB;;EAAlC;;EASC;;EAJQyB,+BAAP,UAAa/B,EAAb,EAAsC;QAAzBC;QAACC,GAAG;QAAEL,MAAM;;IACvB,OAAOY,iBAAMuB,KAAN,CAAWC,IAAX,CAAW,IAAX,EAAY,CAAC/B,GAAD,EAAM,OAAOL,MAAb,CAAZ,CAAP;EACD,CAFM;;EAIT;AAAC,CATD,CAAkCqC,YAAlC;;AAAa5C;;AAkBb;EAA8BgB;;EAS5B,kBAAYC,IAAZ,EACYc,IADZ,EAEYc,WAFZ,EAEoD;;;IAFpD,YAGE1B,kBAAMF,IAAN,EAAY,IAAZ,KAAiB,IAHnB;;;MAIE,KAAkB,wBAAM,CAACe,IAAP,CAAYD,IAAZ,IAAiBE,cAAnC,EAAmC,QAAnC,EAAmCA,cAAnC,EAAqC;QAAhC,IAAMC,GAAG,WAAT;QACH,IAAIC,KAAK,GAAGJ,IAAI,CAACG,GAAD,CAAhB;;QACI,gBAAoB,OAAOC,KAAP,KAAkB,QAAnB,GAA+B,CAACA,KAAD,CAA/B,GAAyCA,KAA5D;QAAA,IAACW,IAAI,QAAL;QAAA,IAAUT,KAAK,cAAf;;QACJ,IAAIC,SAAS,GAAG,IAAIC,iBAAJ,CAAUL,GAAV,EAAeW,WAAW,CAACC,IAAD,CAA1B,EAA4CT,KAA5C,CAAhB;;QACAjB,KAAI,CAACoB,GAAL,CAASN,GAAT,EAAcI,SAAd;MACD;;;;;;;;;;;;;;EACF;;EAMMS,+BAAP,UAAiBxC,MAAjB,EAA+B;IAC7B,IAAIyC,KAAK,GAAG,KAAKjC,MAAL,CAAYR,MAAZ,CAAZ;IACA,OAAOyC,KAAK,GAAGA,KAAK,CAACF,IAAT,GAAgB,IAA5B;EACD,CAHM;;EASAC,2BAAP,UAAarC,EAAb,EAAsC;QAAzBC;QAACC,GAAG;QAAEL,MAAM;;IACvB,IAAIyC,KAAK,GAAG,KAAKjC,MAAL,CAAYR,MAAZ,CAAZ;IACA,IAAIE,MAAM,GAAG,KAAKI,SAAL,CAAeN,MAAf,CAAb;;IACA,IAAI,CAACyC,KAAD,IAAU,CAACvC,MAAf,EAAuB;MACrB,OAAO,IAAP;IACD;;IACD,OAAOX,WAAW,CAACW,MAAM,MAAN,CAAM,MAAN,EAAMwC,eAACrC,GAAD,EAAMoC,KAAK,CAACzC,MAAZ,GAAkB2C,OAAKF,KAAK,CAACG,IAAX,CAAlB,EAAiC,KAAjC,CAAN,CAAD,CAAlB;EACD,CAPM;;EAST;AAAC,CA3CD,CAA8B3B,gBAA9B;;AAAaxB;;AAoDb;EAAgCgB;;EAAhC;;EAkBC;;EAbQoC,6BAAP,UAAa1C,EAAb,EAAsC;QAAzBC;QAACC,GAAG;QAAEL,MAAM;;IACvB,IAAIyC,KAAK,GAAG,KAAKjC,MAAL,CAAYR,MAAZ,CAAZ;IACA,IAAIE,MAAM,GAAG,KAAKI,SAAL,CAAeN,MAAf,CAAb;;IACA,IAAI,CAACyC,KAAD,IAAU,CAACvC,MAAf,EAAuB;MACrB,OAAO,IAAP;IACD;;IACD,IAAI4C,WAAW,GAAGzC,GAAG,CAAC0C,SAAtB;IACA1C,GAAG,CAAC0C,SAAJ,GAAgB,OAAO/C,MAAvB;IACA,IAAIR,MAAM,GAAGU,MAAM,MAAN,CAAM,MAAN,EAAMwC,eAACrC,GAAD,EAAM,OAAOoC,KAAK,CAACzC,MAAnB,GAAyB2C,OAAKF,KAAK,CAACG,IAAX,CAAzB,EAAwC,KAAxC,CAAN,CAAb;IACAvC,GAAG,CAAC0C,SAAJ,GAAgBD,WAAhB;IACA,OAAOvD,WAAW,CAACC,MAAD,CAAlB;EACD,CAXM;;EAaT;AAAC,CAlBD,CAAgCgD,QAAhC;;AAAa/C;;AA6Bb;EAAoCgB;;EAUlC,wBAAYC,IAAZ,EACYR,MADZ,EAEYsB,IAFZ,EAGYc,WAHZ,EAGoD;IAHpD,YAIE1B,kBAAMF,IAAN,EAAYc,IAAZ,EAAkBc,WAAlB,KAA8B,IAJhC;;IAKEzB,KAAI,CAACX,MAAL,GAAcA,MAAd;;EACD;;EAMM8C,iCAAP,UAAa7C,EAAb,EAAsC;QAAzBC;QAACC,GAAG;QAAEL,MAAM;;IACvB,IAAIyC,KAAK,GAAG,KAAKjC,MAAL,CAAYR,MAAZ,CAAZ;IACA,IAAIiD,SAAS,GAAG,KAAK3C,SAAL,CAAeN,MAAf,CAAhB;;IACA,IAAI,CAACyC,KAAD,IAAU,CAACQ,SAAf,EAA0B;MACxB,OAAO,IAAP;IACD;;IACD,OAAO1D,WAAW,CAAC,KAAKW,MAAL,CAAYG,GAAZ,EAAiBoC,KAAK,CAACzC,MAAvB,EAA+BiD,SAA/B,EAA0CR,KAAK,CAACG,IAAhD,CAAD,CAAlB;EACD,CAPM;;EAST;AAAC,CA/BD,CAAoCJ,QAApC;;AAAa/C","names":["parseResult","result","exports","_name","_parser","MapHandler_js_1","register","Object","AbstractSymbolMap","symbol","contains","parser","_a","_b","env","parserFor","mapped","lookup","__extends","name","_regExp","_super","_this","RegExpMap","test","Map","AbstractParseMap","map","get","has","object","set","delete","json","keys","_c","key","value","char","attrs","character","Symbol_js_1","add","DelimiterMap","parse","call","CharacterMap","functionMap","func","MacroMap","macro","__spreadArray","__read","args","CommandMap","saveCommand","currentCS","EnvironmentMap","envParser"],"sourceRoot":"","sources":["../../../ts/input/tex/SymbolMap.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}