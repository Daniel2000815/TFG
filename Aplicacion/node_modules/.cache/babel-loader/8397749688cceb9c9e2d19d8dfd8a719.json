{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.newState = exports.STATE = exports.AbstractMathItem = exports.protoItem = void 0;\n\nfunction protoItem(open, math, close, n, start, end, display) {\n  if (display === void 0) {\n    display = null;\n  }\n\n  var item = {\n    open: open,\n    math: math,\n    close: close,\n    n: n,\n    start: {\n      n: start\n    },\n    end: {\n      n: end\n    },\n    display: display\n  };\n  return item;\n}\n\nexports.protoItem = protoItem;\n\nvar AbstractMathItem = function () {\n  function AbstractMathItem(math, jax, display, start, end) {\n    if (display === void 0) {\n      display = true;\n    }\n\n    if (start === void 0) {\n      start = {\n        i: 0,\n        n: 0,\n        delim: ''\n      };\n    }\n\n    if (end === void 0) {\n      end = {\n        i: 0,\n        n: 0,\n        delim: ''\n      };\n    }\n\n    this.root = null;\n    this.typesetRoot = null;\n    this.metrics = {};\n    this.inputData = {};\n    this.outputData = {};\n    this._state = exports.STATE.UNPROCESSED;\n    this.math = math;\n    this.inputJax = jax;\n    this.display = display;\n    this.start = start;\n    this.end = end;\n    this.root = null;\n    this.typesetRoot = null;\n    this.metrics = {};\n    this.inputData = {};\n    this.outputData = {};\n  }\n\n  Object.defineProperty(AbstractMathItem.prototype, \"isEscaped\", {\n    get: function get() {\n      return this.display === null;\n    },\n    enumerable: false,\n    configurable: true\n  });\n\n  AbstractMathItem.prototype.render = function (document) {\n    document.renderActions.renderMath(this, document);\n  };\n\n  AbstractMathItem.prototype.rerender = function (document, start) {\n    if (start === void 0) {\n      start = exports.STATE.RERENDER;\n    }\n\n    if (this.state() >= start) {\n      this.state(start - 1);\n    }\n\n    document.renderActions.renderMath(this, document, start);\n  };\n\n  AbstractMathItem.prototype.convert = function (document, end) {\n    if (end === void 0) {\n      end = exports.STATE.LAST;\n    }\n\n    document.renderActions.renderConvert(this, document, end);\n  };\n\n  AbstractMathItem.prototype.compile = function (document) {\n    if (this.state() < exports.STATE.COMPILED) {\n      this.root = this.inputJax.compile(this, document);\n      this.state(exports.STATE.COMPILED);\n    }\n  };\n\n  AbstractMathItem.prototype.typeset = function (document) {\n    if (this.state() < exports.STATE.TYPESET) {\n      this.typesetRoot = document.outputJax[this.isEscaped ? 'escaped' : 'typeset'](this, document);\n      this.state(exports.STATE.TYPESET);\n    }\n  };\n\n  AbstractMathItem.prototype.updateDocument = function (_document) {};\n\n  AbstractMathItem.prototype.removeFromDocument = function (_restore) {\n    if (_restore === void 0) {\n      _restore = false;\n    }\n  };\n\n  AbstractMathItem.prototype.setMetrics = function (em, ex, cwidth, lwidth, scale) {\n    this.metrics = {\n      em: em,\n      ex: ex,\n      containerWidth: cwidth,\n      lineWidth: lwidth,\n      scale: scale\n    };\n  };\n\n  AbstractMathItem.prototype.state = function (state, restore) {\n    if (state === void 0) {\n      state = null;\n    }\n\n    if (restore === void 0) {\n      restore = false;\n    }\n\n    if (state != null) {\n      if (state < exports.STATE.INSERTED && this._state >= exports.STATE.INSERTED) {\n        this.removeFromDocument(restore);\n      }\n\n      if (state < exports.STATE.TYPESET && this._state >= exports.STATE.TYPESET) {\n        this.outputData = {};\n      }\n\n      if (state < exports.STATE.COMPILED && this._state >= exports.STATE.COMPILED) {\n        this.inputData = {};\n      }\n\n      this._state = state;\n    }\n\n    return this._state;\n  };\n\n  AbstractMathItem.prototype.reset = function (restore) {\n    if (restore === void 0) {\n      restore = false;\n    }\n\n    this.state(exports.STATE.UNPROCESSED, restore);\n  };\n\n  return AbstractMathItem;\n}();\n\nexports.AbstractMathItem = AbstractMathItem;\nexports.STATE = {\n  UNPROCESSED: 0,\n  FINDMATH: 10,\n  COMPILED: 20,\n  CONVERT: 100,\n  METRICS: 110,\n  RERENDER: 125,\n  TYPESET: 150,\n  INSERTED: 200,\n  LAST: 10000\n};\n\nfunction newState(name, state) {\n  if (name in exports.STATE) {\n    throw Error('State ' + name + ' already exists');\n  }\n\n  exports.STATE[name] = state;\n}\n\nexports.newState = newState;","map":{"version":3,"mappings":"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","names":["protoItem","open","math","close","n","start","end","display","item","exports","jax","i","delim","UNPROCESSED","inputJax","root","typesetRoot","metrics","inputData","outputData","Object","AbstractMathItem","document","renderActions","renderMath","RERENDER","state","LAST","renderConvert","COMPILED","compile","TYPESET","outputJax","isEscaped","_document","_restore","em","ex","cwidth","lwidth","scale","containerWidth","lineWidth","restore","INSERTED","_state","removeFromDocument","FINDMATH","CONVERT","METRICS","newState","name","Error"],"sourceRoot":"","sources":["../../ts/core/MathItem.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}