{"ast":null,"code":"\"use strict\";\n\nvar __extends = this && this.__extends || function () {\n  var _extendStatics = function extendStatics(d, b) {\n    _extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) {\n        if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n      }\n    };\n\n    return _extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n\n    _extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __read = this && this.__read || function (o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o),\n      r,\n      ar = [],\n      e;\n\n  try {\n    while ((n === void 0 || n-- > 0) && !(r = i.next()).done) {\n      ar.push(r.value);\n    }\n  } catch (error) {\n    e = {\n      error: error\n    };\n  } finally {\n    try {\n      if (r && !r.done && (m = i[\"return\"])) m.call(i);\n    } finally {\n      if (e) throw e.error;\n    }\n  }\n\n  return ar;\n};\n\nvar __spreadArray = this && this.__spreadArray || function (to, from, pack) {\n  if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n    if (ar || !(i in from)) {\n      if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n      ar[i] = from[i];\n    }\n  }\n  return to.concat(ar || Array.prototype.slice.call(from));\n};\n\nvar __values = this && this.__values || function (o) {\n  var s = typeof Symbol === \"function\" && Symbol.iterator,\n      m = s && o[s],\n      i = 0;\n  if (m) return m.call(o);\n  if (o && typeof o.length === \"number\") return {\n    next: function next() {\n      if (o && i >= o.length) o = void 0;\n      return {\n        value: o && o[i++],\n        done: !o\n      };\n    }\n  };\n  throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\n};\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.BaseItem = exports.MmlStack = void 0;\n\nvar TexError_js_1 = __importDefault(require(\"./TexError.js\"));\n\nvar MmlStack = function () {\n  function MmlStack(_nodes) {\n    this._nodes = _nodes;\n  }\n\n  Object.defineProperty(MmlStack.prototype, \"nodes\", {\n    get: function get() {\n      return this._nodes;\n    },\n    enumerable: false,\n    configurable: true\n  });\n\n  MmlStack.prototype.Push = function () {\n    var _a;\n\n    var nodes = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      nodes[_i] = arguments[_i];\n    }\n\n    (_a = this._nodes).push.apply(_a, __spreadArray([], __read(nodes), false));\n  };\n\n  MmlStack.prototype.Pop = function () {\n    return this._nodes.pop();\n  };\n\n  Object.defineProperty(MmlStack.prototype, \"First\", {\n    get: function get() {\n      return this._nodes[this.Size() - 1];\n    },\n    set: function set(node) {\n      this._nodes[this.Size() - 1] = node;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(MmlStack.prototype, \"Last\", {\n    get: function get() {\n      return this._nodes[0];\n    },\n    set: function set(node) {\n      this._nodes[0] = node;\n    },\n    enumerable: false,\n    configurable: true\n  });\n\n  MmlStack.prototype.Peek = function (n) {\n    if (n == null) {\n      n = 1;\n    }\n\n    return this._nodes.slice(this.Size() - n);\n  };\n\n  MmlStack.prototype.Size = function () {\n    return this._nodes.length;\n  };\n\n  MmlStack.prototype.Clear = function () {\n    this._nodes = [];\n  };\n\n  MmlStack.prototype.toMml = function (inferred, forceRow) {\n    if (inferred === void 0) {\n      inferred = true;\n    }\n\n    if (this._nodes.length === 1 && !forceRow) {\n      return this.First;\n    }\n\n    return this.create('node', inferred ? 'inferredMrow' : 'mrow', this._nodes, {});\n  };\n\n  MmlStack.prototype.create = function (kind) {\n    var _a;\n\n    var rest = [];\n\n    for (var _i = 1; _i < arguments.length; _i++) {\n      rest[_i - 1] = arguments[_i];\n    }\n\n    return (_a = this.factory.configuration.nodeFactory).create.apply(_a, __spreadArray([kind], __read(rest), false));\n  };\n\n  return MmlStack;\n}();\n\nexports.MmlStack = MmlStack;\n\nvar BaseItem = function (_super) {\n  __extends(BaseItem, _super);\n\n  function BaseItem(factory) {\n    var nodes = [];\n\n    for (var _i = 1; _i < arguments.length; _i++) {\n      nodes[_i - 1] = arguments[_i];\n    }\n\n    var _this = _super.call(this, nodes) || this;\n\n    _this.factory = factory;\n    _this.global = {};\n    _this._properties = {};\n\n    if (_this.isOpen) {\n      _this._env = {};\n    }\n\n    return _this;\n  }\n\n  Object.defineProperty(BaseItem.prototype, \"kind\", {\n    get: function get() {\n      return 'base';\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(BaseItem.prototype, \"env\", {\n    get: function get() {\n      return this._env;\n    },\n    set: function set(value) {\n      this._env = value;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(BaseItem.prototype, \"copyEnv\", {\n    get: function get() {\n      return true;\n    },\n    enumerable: false,\n    configurable: true\n  });\n\n  BaseItem.prototype.getProperty = function (key) {\n    return this._properties[key];\n  };\n\n  BaseItem.prototype.setProperty = function (key, value) {\n    this._properties[key] = value;\n    return this;\n  };\n\n  Object.defineProperty(BaseItem.prototype, \"isOpen\", {\n    get: function get() {\n      return false;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(BaseItem.prototype, \"isClose\", {\n    get: function get() {\n      return false;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(BaseItem.prototype, \"isFinal\", {\n    get: function get() {\n      return false;\n    },\n    enumerable: false,\n    configurable: true\n  });\n\n  BaseItem.prototype.isKind = function (kind) {\n    return kind === this.kind;\n  };\n\n  BaseItem.prototype.checkItem = function (item) {\n    if (item.isKind('over') && this.isOpen) {\n      item.setProperty('num', this.toMml(false));\n      this.Clear();\n    }\n\n    if (item.isKind('cell') && this.isOpen) {\n      if (item.getProperty('linebreak')) {\n        return BaseItem.fail;\n      }\n\n      throw new TexError_js_1.default('Misplaced', 'Misplaced %1', item.getName());\n    }\n\n    if (item.isClose && this.getErrors(item.kind)) {\n      var _a = __read(this.getErrors(item.kind), 2),\n          id = _a[0],\n          message = _a[1];\n\n      throw new TexError_js_1.default(id, message, item.getName());\n    }\n\n    if (!item.isFinal) {\n      return BaseItem.success;\n    }\n\n    this.Push(item.First);\n    return BaseItem.fail;\n  };\n\n  BaseItem.prototype.clearEnv = function () {\n    var e_1, _a;\n\n    try {\n      for (var _b = __values(Object.keys(this.env)), _c = _b.next(); !_c.done; _c = _b.next()) {\n        var id = _c.value;\n        delete this.env[id];\n      }\n    } catch (e_1_1) {\n      e_1 = {\n        error: e_1_1\n      };\n    } finally {\n      try {\n        if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n      } finally {\n        if (e_1) throw e_1.error;\n      }\n    }\n  };\n\n  BaseItem.prototype.setProperties = function (def) {\n    Object.assign(this._properties, def);\n    return this;\n  };\n\n  BaseItem.prototype.getName = function () {\n    return this.getProperty('name');\n  };\n\n  BaseItem.prototype.toString = function () {\n    return this.kind + '[' + this.nodes.join('; ') + ']';\n  };\n\n  BaseItem.prototype.getErrors = function (kind) {\n    var CLASS = this.constructor;\n    return (CLASS.errors || {})[kind] || BaseItem.errors[kind];\n  };\n\n  BaseItem.fail = [null, false];\n  BaseItem.success = [null, true];\n  BaseItem.errors = {\n    end: ['MissingBeginExtraEnd', 'Missing \\\\begin{%1} or extra \\\\end{%1}'],\n    close: ['ExtraCloseMissingOpen', 'Extra close brace or missing open brace'],\n    right: ['MissingLeftExtraRight', 'Missing \\\\left or extra \\\\right'],\n    middle: ['ExtraMiddle', 'Extra \\\\middle']\n  };\n  return BaseItem;\n}(MmlStack);\n\nexports.BaseItem = BaseItem;","map":{"version":3,"mappings":"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","names":["_nodes","Object","MmlStack","nodes","push","apply","_a","__spreadArray","pop","Size","node","n","slice","length","inferred","forceRow","First","create","kind","rest","factory","configuration","nodeFactory","__read","exports","__extends","_super","_this","isOpen","_env","BaseItem","value","key","_properties","item","isKind","setProperty","toMml","Clear","getProperty","fail","TexError_js_1","getName","isClose","getErrors","id","message","isFinal","success","Push","keys","env","_c","def","assign","join","CLASS","constructor","errors","end","close","right","middle"],"sourceRoot":"","sources":["../../../ts/input/tex/StackItem.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}