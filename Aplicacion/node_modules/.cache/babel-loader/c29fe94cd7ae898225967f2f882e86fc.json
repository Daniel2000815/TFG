{"ast":null,"code":"\"use strict\";\n\nvar __extends = this && this.__extends || function () {\n  var _extendStatics = function extendStatics(d, b) {\n    _extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) {\n        if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n      }\n    };\n\n    return _extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n\n    _extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __read = this && this.__read || function (o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o),\n      r,\n      ar = [],\n      e;\n\n  try {\n    while ((n === void 0 || n-- > 0) && !(r = i.next()).done) {\n      ar.push(r.value);\n    }\n  } catch (error) {\n    e = {\n      error: error\n    };\n  } finally {\n    try {\n      if (r && !r.done && (m = i[\"return\"])) m.call(i);\n    } finally {\n      if (e) throw e.error;\n    }\n  }\n\n  return ar;\n};\n\nvar __spreadArray = this && this.__spreadArray || function (to, from, pack) {\n  if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n    if (ar || !(i in from)) {\n      if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n      ar[i] = from[i];\n    }\n  }\n  return to.concat(ar || Array.prototype.slice.call(from));\n};\n\nvar __values = this && this.__values || function (o) {\n  var s = typeof Symbol === \"function\" && Symbol.iterator,\n      m = s && o[s],\n      i = 0;\n  if (m) return m.call(o);\n  if (o && typeof o.length === \"number\") return {\n    next: function next() {\n      if (o && i >= o.length) o = void 0;\n      return {\n        value: o && o[i++],\n        done: !o\n      };\n    }\n  };\n  throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.CommonMmultiscriptsMixin = exports.ScriptNames = exports.NextScript = void 0;\n\nvar BBox_js_1 = require(\"../../../util/BBox.js\");\n\nexports.NextScript = {\n  base: 'subList',\n  subList: 'supList',\n  supList: 'subList',\n  psubList: 'psupList',\n  psupList: 'psubList'\n};\nexports.ScriptNames = ['sup', 'sup', 'psup', 'psub'];\n\nfunction CommonMmultiscriptsMixin(Base) {\n  return function (_super) {\n    __extends(class_1, _super);\n\n    function class_1() {\n      var args = [];\n\n      for (var _i = 0; _i < arguments.length; _i++) {\n        args[_i] = arguments[_i];\n      }\n\n      var _this = _super.apply(this, __spreadArray([], __read(args), false)) || this;\n\n      _this.scriptData = null;\n      _this.firstPrescript = 0;\n\n      _this.getScriptData();\n\n      return _this;\n    }\n\n    class_1.prototype.combinePrePost = function (pre, post) {\n      var bbox = new BBox_js_1.BBox(pre);\n      bbox.combine(post, 0, 0);\n      return bbox;\n    };\n\n    class_1.prototype.computeBBox = function (bbox, recompute) {\n      if (recompute === void 0) {\n        recompute = false;\n      }\n\n      var scriptspace = this.font.params.scriptspace;\n      var data = this.scriptData;\n      var sub = this.combinePrePost(data.sub, data.psub);\n      var sup = this.combinePrePost(data.sup, data.psup);\n\n      var _a = __read(this.getUVQ(sub, sup), 2),\n          u = _a[0],\n          v = _a[1];\n\n      bbox.empty();\n\n      if (data.numPrescripts) {\n        bbox.combine(data.psup, scriptspace, u);\n        bbox.combine(data.psub, scriptspace, v);\n      }\n\n      bbox.append(data.base);\n\n      if (data.numScripts) {\n        var w = bbox.w;\n        bbox.combine(data.sup, w, u);\n        bbox.combine(data.sub, w, v);\n        bbox.w += scriptspace;\n      }\n\n      bbox.clean();\n      this.setChildPWidths(recompute);\n    };\n\n    class_1.prototype.getScriptData = function () {\n      var data = this.scriptData = {\n        base: null,\n        sub: BBox_js_1.BBox.empty(),\n        sup: BBox_js_1.BBox.empty(),\n        psub: BBox_js_1.BBox.empty(),\n        psup: BBox_js_1.BBox.empty(),\n        numPrescripts: 0,\n        numScripts: 0\n      };\n      var lists = this.getScriptBBoxLists();\n      this.combineBBoxLists(data.sub, data.sup, lists.subList, lists.supList);\n      this.combineBBoxLists(data.psub, data.psup, lists.psubList, lists.psupList);\n      data.base = lists.base[0];\n      data.numPrescripts = lists.psubList.length;\n      data.numScripts = lists.subList.length;\n    };\n\n    class_1.prototype.getScriptBBoxLists = function () {\n      var e_1, _a;\n\n      var lists = {\n        base: [],\n        subList: [],\n        supList: [],\n        psubList: [],\n        psupList: []\n      };\n      var script = 'base';\n\n      try {\n        for (var _b = __values(this.childNodes), _c = _b.next(); !_c.done; _c = _b.next()) {\n          var child = _c.value;\n\n          if (child.node.isKind('mprescripts')) {\n            script = 'psubList';\n          } else {\n            lists[script].push(child.getOuterBBox());\n            script = exports.NextScript[script];\n          }\n        }\n      } catch (e_1_1) {\n        e_1 = {\n          error: e_1_1\n        };\n      } finally {\n        try {\n          if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n        } finally {\n          if (e_1) throw e_1.error;\n        }\n      }\n\n      this.firstPrescript = lists.subList.length + lists.supList.length + 2;\n      this.padLists(lists.subList, lists.supList);\n      this.padLists(lists.psubList, lists.psupList);\n      return lists;\n    };\n\n    class_1.prototype.padLists = function (list1, list2) {\n      if (list1.length > list2.length) {\n        list2.push(BBox_js_1.BBox.empty());\n      }\n    };\n\n    class_1.prototype.combineBBoxLists = function (bbox1, bbox2, list1, list2) {\n      for (var i = 0; i < list1.length; i++) {\n        var _a = __read(this.getScaledWHD(list1[i]), 3),\n            w1 = _a[0],\n            h1 = _a[1],\n            d1 = _a[2];\n\n        var _b = __read(this.getScaledWHD(list2[i]), 3),\n            w2 = _b[0],\n            h2 = _b[1],\n            d2 = _b[2];\n\n        var w = Math.max(w1, w2);\n        bbox1.w += w;\n        bbox2.w += w;\n        if (h1 > bbox1.h) bbox1.h = h1;\n        if (d1 > bbox1.d) bbox1.d = d1;\n        if (h2 > bbox2.h) bbox2.h = h2;\n        if (d2 > bbox2.d) bbox2.d = d2;\n      }\n    };\n\n    class_1.prototype.getScaledWHD = function (bbox) {\n      var w = bbox.w,\n          h = bbox.h,\n          d = bbox.d,\n          rscale = bbox.rscale;\n      return [w * rscale, h * rscale, d * rscale];\n    };\n\n    class_1.prototype.getUVQ = function (subbox, supbox) {\n      var _a;\n\n      if (!this.UVQ) {\n        var _b = __read([0, 0, 0], 3),\n            u = _b[0],\n            v = _b[1],\n            q = _b[2];\n\n        if (subbox.h === 0 && subbox.d === 0) {\n          u = this.getU();\n        } else if (supbox.h === 0 && supbox.d === 0) {\n          u = -this.getV();\n        } else {\n          _a = __read(_super.prototype.getUVQ.call(this, subbox, supbox), 3), u = _a[0], v = _a[1], q = _a[2];\n        }\n\n        this.UVQ = [u, v, q];\n      }\n\n      return this.UVQ;\n    };\n\n    return class_1;\n  }(Base);\n}\n\nexports.CommonMmultiscriptsMixin = CommonMmultiscriptsMixin;","map":{"version":3,"mappings":"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","names":["exports","base","subList","supList","psubList","psupList","CommonMmultiscriptsMixin","Base","__extends","args","_this","getScriptData","class_1","pre","post","bbox","BBox_js_1","combine","recompute","scriptspace","font","params","data","scriptData","sub","combinePrePost","psub","sup","psup","getUVQ","u","v","empty","numPrescripts","append","numScripts","w","clean","setChildPWidths","lists","getScriptBBoxLists","combineBBoxLists","length","script","childNodes","_c","child","node","isKind","push","getOuterBBox","firstPrescript","padLists","list1","list2","bbox1","bbox2","i","getScaledWHD","w1","h1","d1","w2","h2","d2","Math","max","h","d","rscale","subbox","supbox","UVQ","q","getU","getV","_a","_super","call"],"sourceRoot":"","sources":["../../../../ts/output/common/Wrappers/mmultiscripts.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}