{"ast":null,"code":"\"use strict\";\n\nvar __extends = this && this.__extends || function () {\n  var _extendStatics = function extendStatics(d, b) {\n    _extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) {\n        if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n      }\n    };\n\n    return _extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n\n    _extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __read = this && this.__read || function (o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o),\n      r,\n      ar = [],\n      e;\n\n  try {\n    while ((n === void 0 || n-- > 0) && !(r = i.next()).done) {\n      ar.push(r.value);\n    }\n  } catch (error) {\n    e = {\n      error: error\n    };\n  } finally {\n    try {\n      if (r && !r.done && (m = i[\"return\"])) m.call(i);\n    } finally {\n      if (e) throw e.error;\n    }\n  }\n\n  return ar;\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.FindTeX = void 0;\n\nvar FindMath_js_1 = require(\"../../core/FindMath.js\");\n\nvar string_js_1 = require(\"../../util/string.js\");\n\nvar MathItem_js_1 = require(\"../../core/MathItem.js\");\n\nvar FindTeX = function (_super) {\n  __extends(FindTeX, _super);\n\n  function FindTeX(options) {\n    var _this = _super.call(this, options) || this;\n\n    _this.getPatterns();\n\n    return _this;\n  }\n\n  FindTeX.prototype.getPatterns = function () {\n    var _this = this;\n\n    var options = this.options;\n    var starts = [],\n        parts = [],\n        subparts = [];\n    this.end = {};\n    this.env = this.sub = 0;\n    var i = 1;\n    options['inlineMath'].forEach(function (delims) {\n      return _this.addPattern(starts, delims, false);\n    });\n    options['displayMath'].forEach(function (delims) {\n      return _this.addPattern(starts, delims, true);\n    });\n\n    if (starts.length) {\n      parts.push(starts.sort(string_js_1.sortLength).join('|'));\n    }\n\n    if (options['processEnvironments']) {\n      parts.push('\\\\\\\\begin\\\\s*\\\\{([^}]*)\\\\}');\n      this.env = i;\n      i++;\n    }\n\n    if (options['processEscapes']) {\n      subparts.push('\\\\\\\\([\\\\\\\\$])');\n    }\n\n    if (options['processRefs']) {\n      subparts.push('(\\\\\\\\(?:eq)?ref\\\\s*\\\\{[^}]*\\\\})');\n    }\n\n    if (subparts.length) {\n      parts.push('(' + subparts.join('|') + ')');\n      this.sub = i;\n    }\n\n    this.start = new RegExp(parts.join('|'), 'g');\n    this.hasPatterns = parts.length > 0;\n  };\n\n  FindTeX.prototype.addPattern = function (starts, delims, display) {\n    var _a = __read(delims, 2),\n        open = _a[0],\n        close = _a[1];\n\n    starts.push((0, string_js_1.quotePattern)(open));\n    this.end[open] = [close, display, this.endPattern(close)];\n  };\n\n  FindTeX.prototype.endPattern = function (end, endp) {\n    return new RegExp((endp || (0, string_js_1.quotePattern)(end)) + '|\\\\\\\\(?:[a-zA-Z]|.)|[{}]', 'g');\n  };\n\n  FindTeX.prototype.findEnd = function (text, n, start, end) {\n    var _a = __read(end, 3),\n        close = _a[0],\n        display = _a[1],\n        pattern = _a[2];\n\n    var i = pattern.lastIndex = start.index + start[0].length;\n    var match,\n        braces = 0;\n\n    while (match = pattern.exec(text)) {\n      if ((match[1] || match[0]) === close && braces === 0) {\n        return (0, MathItem_js_1.protoItem)(start[0], text.substr(i, match.index - i), match[0], n, start.index, match.index + match[0].length, display);\n      } else if (match[0] === '{') {\n        braces++;\n      } else if (match[0] === '}' && braces) {\n        braces--;\n      }\n    }\n\n    return null;\n  };\n\n  FindTeX.prototype.findMathInString = function (math, n, text) {\n    var start, match;\n    this.start.lastIndex = 0;\n\n    while (start = this.start.exec(text)) {\n      if (start[this.env] !== undefined && this.env) {\n        var end = '\\\\\\\\end\\\\s*(\\\\{' + (0, string_js_1.quotePattern)(start[this.env]) + '\\\\})';\n        match = this.findEnd(text, n, start, ['{' + start[this.env] + '}', true, this.endPattern(null, end)]);\n\n        if (match) {\n          match.math = match.open + match.math + match.close;\n          match.open = match.close = '';\n        }\n      } else if (start[this.sub] !== undefined && this.sub) {\n        var math_1 = start[this.sub];\n        var end = start.index + start[this.sub].length;\n\n        if (math_1.length === 2) {\n          match = (0, MathItem_js_1.protoItem)('', math_1.substr(1), '', n, start.index, end);\n        } else {\n          match = (0, MathItem_js_1.protoItem)('', math_1, '', n, start.index, end, false);\n        }\n      } else {\n        match = this.findEnd(text, n, start, this.end[start[0]]);\n      }\n\n      if (match) {\n        math.push(match);\n        this.start.lastIndex = match.end.n;\n      }\n    }\n  };\n\n  FindTeX.prototype.findMath = function (strings) {\n    var math = [];\n\n    if (this.hasPatterns) {\n      for (var i = 0, m = strings.length; i < m; i++) {\n        this.findMathInString(math, i, strings[i]);\n      }\n    }\n\n    return math;\n  };\n\n  FindTeX.OPTIONS = {\n    inlineMath: [['\\\\(', '\\\\)']],\n    displayMath: [['$$', '$$'], ['\\\\[', '\\\\]']],\n    processEscapes: true,\n    processEnvironments: true,\n    processRefs: true\n  };\n  return FindTeX;\n}(FindMath_js_1.AbstractFindMath);\n\nexports.FindTeX = FindTeX;","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAuBA;;AAEA;;AACA;;AAoBA;EAAsCA;;EAmDpC,iBAAYC,OAAZ,EAA+B;IAA/B,YACEC,kBAAMD,OAAN,KAAc,IADhB;;IAEEE,KAAI,CAACC,WAAL;;;EACD;;EAMSC,gCAAV;IAAA;;IACE,IAAIJ,OAAO,GAAG,KAAKA,OAAnB;IACA,IAAIK,MAAM,GAAa,EAAvB;IAAA,IAA2BC,KAAK,GAAa,EAA7C;IAAA,IAAiDC,QAAQ,GAAa,EAAtE;IACA,KAAKC,GAAL,GAAW,EAAX;IACA,KAAKC,GAAL,GAAW,KAAKC,GAAL,GAAW,CAAtB;IACA,IAAIC,CAAC,GAAG,CAAR;IACAX,OAAO,CAAC,YAAD,CAAP,CAAsBY,OAAtB,CAA8B,UAACC,MAAD,EAAe;MAAK,YAAI,CAACC,UAAL,CAAgBT,MAAhB,EAAwBQ,MAAxB,EAAgC,KAAhC;IAAsC,CAAxF;IACAb,OAAO,CAAC,aAAD,CAAP,CAAuBY,OAAvB,CAA+B,UAACC,MAAD,EAAe;MAAK,YAAI,CAACC,UAAL,CAAgBT,MAAhB,EAAwBQ,MAAxB,EAAgC,IAAhC;IAAqC,CAAxF;;IACA,IAAIR,MAAM,CAACU,MAAX,EAAmB;MACjBT,KAAK,CAACU,IAAN,CAAWX,MAAM,CAACY,IAAP,CAAYC,sBAAZ,EAAwBC,IAAxB,CAA6B,GAA7B,CAAX;IACD;;IACD,IAAInB,OAAO,CAAC,qBAAD,CAAX,EAAoC;MAClCM,KAAK,CAACU,IAAN,CAAW,4BAAX;MACA,KAAKP,GAAL,GAAWE,CAAX;MACAA,CAAC;IACF;;IACD,IAAIX,OAAO,CAAC,gBAAD,CAAX,EAA+B;MAC7BO,QAAQ,CAACS,IAAT,CAAc,eAAd;IACD;;IACD,IAAIhB,OAAO,CAAC,aAAD,CAAX,EAA4B;MAC1BO,QAAQ,CAACS,IAAT,CAAc,iCAAd;IACD;;IACD,IAAIT,QAAQ,CAACQ,MAAb,EAAqB;MACnBT,KAAK,CAACU,IAAN,CAAW,MAAMT,QAAQ,CAACY,IAAT,CAAc,GAAd,CAAN,GAA2B,GAAtC;MACA,KAAKT,GAAL,GAAWC,CAAX;IACD;;IACD,KAAKS,KAAL,GAAa,IAAIC,MAAJ,CAAWf,KAAK,CAACa,IAAN,CAAW,GAAX,CAAX,EAA4B,GAA5B,CAAb;IACA,KAAKG,WAAL,GAAoBhB,KAAK,CAACS,MAAN,GAAe,CAAnC;EACD,CA5BS;;EAqCAX,+BAAV,UAAqBC,MAArB,EAAuCQ,MAAvC,EAAuDU,OAAvD,EAAuE;IACjE,gBAAgBV,MAAhB,EAAsB,CAAtB;IAAA,IAACW,IAAI,QAAL;IAAA,IAAOC,KAAK,QAAZ;;IACJpB,MAAM,CAACW,IAAP,CAAY,8BAAaQ,IAAb,CAAZ;IACA,KAAKhB,GAAL,CAASgB,IAAT,IAAiB,CAACC,KAAD,EAAQF,OAAR,EAAiB,KAAKG,UAAL,CAAgBD,KAAhB,CAAjB,CAAjB;EACD,CAJS;;EAaArB,+BAAV,UAAqBI,GAArB,EAAkCmB,IAAlC,EAA+C;IAC7C,OAAO,IAAIN,MAAJ,CAAW,CAACM,IAAI,IAAI,8BAAanB,GAAb,CAAT,IAA8B,0BAAzC,EAAqE,GAArE,CAAP;EACD,CAFS;;EAeAJ,4BAAV,UAAkBwB,IAAlB,EAAgCC,CAAhC,EAA2CT,KAA3C,EAAmEZ,GAAnE,EAA+E;IACzE,gBAA4BA,GAA5B,EAA+B,CAA/B;IAAA,IAACiB,KAAK,QAAN;IAAA,IAAQF,OAAO,QAAf;IAAA,IAAiBO,OAAO,QAAxB;;IACJ,IAAInB,CAAC,GAAGmB,OAAO,CAACC,SAAR,GAAoBX,KAAK,CAACY,KAAN,GAAcZ,KAAK,CAAC,CAAD,CAAL,CAASL,MAAnD;IACA,IAAIkB,KAAJ;IAAA,IAA4BC,MAAM,GAAW,CAA7C;;IACA,OAAQD,KAAK,GAAGH,OAAO,CAACK,IAAR,CAAaP,IAAb,CAAhB,EAAqC;MACnC,IAAI,CAACK,KAAK,CAAC,CAAD,CAAL,IAAYA,KAAK,CAAC,CAAD,CAAlB,MAA2BR,KAA3B,IAAoCS,MAAM,KAAK,CAAnD,EAAsD;QACpD,OAAO,6BAAgBd,KAAK,CAAC,CAAD,CAArB,EAA0BQ,IAAI,CAACQ,MAAL,CAAYzB,CAAZ,EAAesB,KAAK,CAACD,KAAN,GAAcrB,CAA7B,CAA1B,EAA2DsB,KAAK,CAAC,CAAD,CAAhE,EACgBJ,CADhB,EACmBT,KAAK,CAACY,KADzB,EACgCC,KAAK,CAACD,KAAN,GAAcC,KAAK,CAAC,CAAD,CAAL,CAASlB,MADvD,EAC+DQ,OAD/D,CAAP;MAED,CAHD,MAGO,IAAIU,KAAK,CAAC,CAAD,CAAL,KAAa,GAAjB,EAAsB;QAC3BC,MAAM;MACP,CAFM,MAEA,IAAID,KAAK,CAAC,CAAD,CAAL,KAAa,GAAb,IAAoBC,MAAxB,EAAgC;QACrCA,MAAM;MACP;IACF;;IACD,OAAO,IAAP;EACD,CAfS;;EAyBA9B,qCAAV,UAA2BiC,IAA3B,EAAoDR,CAApD,EAA+DD,IAA/D,EAA2E;IACzE,IAAIR,KAAJ,EAAWa,KAAX;IACA,KAAKb,KAAL,CAAWW,SAAX,GAAuB,CAAvB;;IACA,OAAQX,KAAK,GAAG,KAAKA,KAAL,CAAWe,IAAX,CAAgBP,IAAhB,CAAhB,EAAwC;MACtC,IAAIR,KAAK,CAAC,KAAKX,GAAN,CAAL,KAAoB6B,SAApB,IAAiC,KAAK7B,GAA1C,EAA+C;QAC7C,IAAID,GAAG,GAAG,oBAAoB,8BAAaY,KAAK,CAAC,KAAKX,GAAN,CAAlB,CAApB,GAAoD,MAA9D;QACAwB,KAAK,GAAG,KAAKM,OAAL,CAAaX,IAAb,EAAmBC,CAAnB,EAAsBT,KAAtB,EAA6B,CAAC,MAAMA,KAAK,CAAC,KAAKX,GAAN,CAAX,GAAwB,GAAzB,EAA8B,IAA9B,EAAoC,KAAKiB,UAAL,CAAgB,IAAhB,EAAsBlB,GAAtB,CAApC,CAA7B,CAAR;;QACA,IAAIyB,KAAJ,EAAW;UACTA,KAAK,CAACI,IAAN,GAAaJ,KAAK,CAACT,IAAN,GAAaS,KAAK,CAACI,IAAnB,GAA0BJ,KAAK,CAACR,KAA7C;UACAQ,KAAK,CAACT,IAAN,GAAaS,KAAK,CAACR,KAAN,GAAc,EAA3B;QACD;MACF,CAPD,MAOO,IAAIL,KAAK,CAAC,KAAKV,GAAN,CAAL,KAAoB4B,SAApB,IAAiC,KAAK5B,GAA1C,EAA+C;QACpD,IAAI8B,MAAI,GAAGpB,KAAK,CAAC,KAAKV,GAAN,CAAhB;QACA,IAAIF,GAAG,GAAGY,KAAK,CAACY,KAAN,GAAcZ,KAAK,CAAC,KAAKV,GAAN,CAAL,CAAgBK,MAAxC;;QACA,IAAIyB,MAAI,CAACzB,MAAL,KAAgB,CAApB,EAAuB;UACrBkB,KAAK,GAAG,6BAAgB,EAAhB,EAAoBO,MAAI,CAACJ,MAAL,CAAY,CAAZ,CAApB,EAAoC,EAApC,EAAwCP,CAAxC,EAA2CT,KAAK,CAACY,KAAjD,EAAwDxB,GAAxD,CAAR;QACD,CAFD,MAEO;UACLyB,KAAK,GAAG,6BAAgB,EAAhB,EAAoBO,MAApB,EAA0B,EAA1B,EAA8BX,CAA9B,EAAiCT,KAAK,CAACY,KAAvC,EAA8CxB,GAA9C,EAAmD,KAAnD,CAAR;QACD;MACF,CARM,MAQA;QACLyB,KAAK,GAAG,KAAKM,OAAL,CAAaX,IAAb,EAAmBC,CAAnB,EAAsBT,KAAtB,EAA6B,KAAKZ,GAAL,CAASY,KAAK,CAAC,CAAD,CAAd,CAA7B,CAAR;MACD;;MACD,IAAIa,KAAJ,EAAW;QACTI,IAAI,CAACrB,IAAL,CAAUiB,KAAV;QACA,KAAKb,KAAL,CAAWW,SAAX,GAAuBE,KAAK,CAACzB,GAAN,CAAUqB,CAAjC;MACD;IACF;EACF,CA3BS;;EAkCHzB,6BAAP,UAAgBqC,OAAhB,EAAiC;IAC/B,IAAIJ,IAAI,GAAsB,EAA9B;;IACA,IAAI,KAAKf,WAAT,EAAsB;MACpB,KAAK,IAAIX,CAAC,GAAG,CAAR,EAAW+B,CAAC,GAAGD,OAAO,CAAC1B,MAA5B,EAAoCJ,CAAC,GAAG+B,CAAxC,EAA2C/B,CAAC,EAA5C,EAAgD;QAC9C,KAAKgC,gBAAL,CAAsBN,IAAtB,EAA4B1B,CAA5B,EAA+B8B,OAAO,CAAC9B,CAAD,CAAtC;MACD;IACF;;IACD,OAAO0B,IAAP;EACD,CARM;;EAnLOjC,kBAAsB;IAClCwC,UAAU,EAAE,CAEV,CAAC,KAAD,EAAQ,KAAR,CAFU,CADsB;IAMlCC,WAAW,EAAE,CACX,CAAC,IAAD,EAAO,IAAP,CADW,EAEX,CAAC,KAAD,EAAQ,KAAR,CAFW,CANqB;IAWlCC,cAAc,EAAE,IAXkB;IAalCC,mBAAmB,EAAE,IAba;IAelCC,WAAW,EAAE;EAfqB,CAAtB;EA6LhB;AAAC,CAlMD,CAAsCC,8BAAtC;;AAAaC","names":["__extends","options","_super","_this","getPatterns","FindTeX","starts","parts","subparts","end","env","sub","i","forEach","delims","addPattern","length","push","sort","string_js_1","join","start","RegExp","hasPatterns","display","open","close","endPattern","endp","text","n","pattern","lastIndex","index","match","braces","exec","substr","math","undefined","findEnd","math_1","strings","m","findMathInString","inlineMath","displayMath","processEscapes","processEnvironments","processRefs","FindMath_js_1","exports"],"sourceRoot":"","sources":["../../../ts/input/tex/FindTeX.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}