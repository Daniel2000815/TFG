{"ast":null,"code":"import _slicedToArray from\"C:\\\\Users\\\\daniz\\\\TFG\\\\Aplicacion\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import React,{useContext,useState}from\"react\";import Shader from\"./Shader.js\";import{fs}from\"./fragmentShader.js\";import{useEffect}from\"react\";import Button from\"@mui/material/Button\";import KeyboardArrowDownIcon from\"@mui/icons-material/KeyboardArrowDown\";import KeyboardArrowUpIcon from\"@mui/icons-material/KeyboardArrowUp\";import FloatInput from\"./FloatInput.js\";import Dropdown from\"./Dropdown\";import GraphContext from\"./GraphContext.js\";import CustomHandle from\"./CustomHandle.js\";var Primitives={Sphere:\"Sphere\",Box:\"Box\",Torus:\"Torus\",Cylinder:\"Cylinder\"};export default function PrimitiveNode(_ref){var data=_ref.data,id=_ref.id;var _React$useState=React.useState(Primitives.Sphere),_React$useState2=_slicedToArray(_React$useState,2),primitive=_React$useState2[0],setPrimitive=_React$useState2[1];var _useState=useState(data.sdf),_useState2=_slicedToArray(_useState,2),sdf=_useState2[0],setSdf=_useState2[1];var _React$useState3=React.useState(false),_React$useState4=_slicedToArray(_React$useState3,2),showCanvas=_React$useState4[0],setShowCanvas=_React$useState4[1];var _React$useState5=React.useState([1.0,1.0,1.0]),_React$useState6=_slicedToArray(_React$useState5,2),inputs=_React$useState6[0],setInputs=_React$useState6[1];var _React$useState7=React.useState([\"Radius\",\"\",\"\"]),_React$useState8=_slicedToArray(_React$useState7,2),inputLabels=_React$useState8[0],setInputLabels=_React$useState8[1];var _React$useState9=React.useState([true,false,false]),_React$useState10=_slicedToArray(_React$useState9,2),inputsActive=_React$useState10[0],setInputsActive=_React$useState10[1];var sharedFunctions=useContext(GraphContext);var handleChange=function handleChange(newPrimitive,newSdf){if(newPrimitive==Primitives.Sphere){console.log(\"YES\");}setPrimitive(newPrimitive);setSdf(newSdf);};useEffect(function(){console.log(\"\".concat(id,\" HA RECIBIDO NUEVOS DATOS:\"));console.log(JSON.stringify(data));},[data]);useEffect(function(){console.log(\"SDF DE \".concat(id,\" MODIFICADO\"));sharedFunctions.updateNodeSdf(id,sdf);},[sdf]);useEffect(function(){console.log(\"ACTUALIZADO SDF\");if(primitive==Primitives.Sphere){setSdf(\"sphere(p, \".concat(inputs[0].toFixed(4),\")\"));prepareInputs(\"radius\");}else if(primitive==Primitives.Box){setSdf(\"box(p, vec3(\\n          \".concat(inputs[0].toFixed(4),\", \\n          \").concat(inputs[1].toFixed(4),\", \\n          \").concat(inputs[2].toFixed(4),\"\\n          )\\n        )\"));prepareInputs(\"sx\",\"sy\",\"sz\");}else if(primitive==Primitives.Torus){setSdf(\"torus(p, vec2(\\n          \".concat(inputs[0].toFixed(4),\", \\n          \").concat(inputs[1].toFixed(4),\"\\n          )\\n        )\"));prepareInputs(\"hole\",\"thickness\");}else if(primitive==Primitives.Cylinder){setSdf(\"cylinder(p, \\n          \".concat(inputs[0].toFixed(4),\", \\n          \").concat(inputs[1].toFixed(4),\"\\n        )\"));prepareInputs(\"height\",\"radius\");}},[primitive,inputs]);var prepareInputs=function prepareInputs(label1){var label2=arguments.length>1&&arguments[1]!==undefined?arguments[1]:\"\";var label3=arguments.length>2&&arguments[2]!==undefined?arguments[2]:\"\";setInputLabels([label1,label2,label3]);setInputsActive([label1,label2,label3]);};return/*#__PURE__*/React.createElement(\"div\",{className:\"custom-node\"},/*#__PURE__*/React.createElement(\"div\",{className:\"custom-node-header\"},\"Primitive\"),/*#__PURE__*/React.createElement(Dropdown,{value:primitive,onChange:setPrimitive,items:Object.values(Primitives),label:\"Primitive\"}),inputsActive[0]?/*#__PURE__*/React.createElement(FloatInput,{val:inputs[0],handleChange:function handleChange(newVal){return setInputs([newVal,inputs[1],inputs[2]]);},label:inputLabels[0]}):null,inputsActive[1]?/*#__PURE__*/React.createElement(FloatInput,{val:inputs[1],handleChange:function handleChange(newVal){return setInputs([inputs[0],newVal,inputs[2]]);},label:inputLabels[1]}):null,inputsActive[2]?/*#__PURE__*/React.createElement(FloatInput,{val:inputs[2],handleChange:function handleChange(newVal){return setInputs([inputs[0],inputs[1],newVal]);},label:inputLabels[2]}):null,/*#__PURE__*/React.createElement(\"p\",null,\"ID: \".concat(id)),/*#__PURE__*/React.createElement(\"p\",null,\"CHILDREN: \",Object.keys(data.children).map(function(key){return\"\".concat(data.children[key]);}).join(', ')),/*#__PURE__*/React.createElement(\"p\",null,\"SDF: \",sdf),/*#__PURE__*/React.createElement(CustomHandle,{type:\"source\"}),showCanvas?/*#__PURE__*/React.createElement(Shader,{shader:fs(sdf),uniforms:{color:{type:\"3fv\",value:[1.0,1.0,0.0]}},style:{margin:\"10px\"}}):null,/*#__PURE__*/React.createElement(Button,{onClick:function onClick(){return setShowCanvas(!showCanvas);},variant:\"contained\",className:\"custom-node-creater\",size:\"small\",endIcon:showCanvas?/*#__PURE__*/React.createElement(KeyboardArrowUpIcon,null):/*#__PURE__*/React.createElement(KeyboardArrowDownIcon,null)},showCanvas?\"Hide canvas\":\"Show canvas\"));}","map":{"version":3,"names":["React","useContext","useState","Shader","fs","useEffect","Button","KeyboardArrowDownIcon","KeyboardArrowUpIcon","FloatInput","Dropdown","GraphContext","CustomHandle","Primitives","Sphere","Box","Torus","Cylinder","PrimitiveNode","data","id","primitive","setPrimitive","sdf","setSdf","showCanvas","setShowCanvas","inputs","setInputs","inputLabels","setInputLabels","inputsActive","setInputsActive","sharedFunctions","handleChange","newPrimitive","newSdf","console","log","JSON","stringify","updateNodeSdf","toFixed","prepareInputs","label1","label2","label3","Object","values","newVal","keys","children","map","key","join","color","type","value","margin"],"sources":["C:/Users/daniz/TFG/Aplicacion/src/PrimitiveNode.js"],"sourcesContent":["import React, {useContext, useState} from \"react\";\r\nimport Shader from \"./Shader.js\";\r\nimport { fs } from \"./fragmentShader.js\";\r\nimport { useEffect } from \"react\";\r\nimport Button from \"@mui/material/Button\";\r\nimport KeyboardArrowDownIcon from \"@mui/icons-material/KeyboardArrowDown\";\r\nimport KeyboardArrowUpIcon from \"@mui/icons-material/KeyboardArrowUp\";\r\nimport FloatInput from \"./FloatInput.js\";\r\nimport Dropdown from \"./Dropdown\";\r\nimport GraphContext from \"./GraphContext.js\";\r\nimport CustomHandle from \"./CustomHandle.js\";\r\n\r\nconst Primitives = {\r\n  Sphere: \"Sphere\",\r\n  Box: \"Box\",\r\n  Torus: \"Torus\",\r\n  Cylinder: \"Cylinder\"\r\n};\r\n\r\nexport default function PrimitiveNode({ data, id }) {\r\n  const [primitive, setPrimitive] = React.useState(Primitives.Sphere);\r\n  const [sdf, setSdf] = useState(data.sdf);\r\n  const [showCanvas, setShowCanvas] = React.useState(false);\r\n  const [inputs, setInputs] = React.useState([1.0, 1.0, 1.0]);\r\n  const [inputLabels, setInputLabels] = React.useState([\"Radius\", \"\", \"\"]);\r\n  const [inputsActive, setInputsActive] = React.useState([true, false, false]);\r\n\r\n  const sharedFunctions = useContext(GraphContext);\r\n\r\n  const handleChange = (newPrimitive, newSdf) => {\r\n    if (newPrimitive == Primitives.Sphere) {\r\n      console.log(\"YES\");\r\n    }\r\n    setPrimitive(newPrimitive);\r\n    setSdf(newSdf);\r\n  };\r\n\r\n  useEffect(() => {\r\n    console.log(`${id} HA RECIBIDO NUEVOS DATOS:`);\r\n    console.log(JSON.stringify(data));\r\n  }, [data]);\r\n\r\n  useEffect(() => {\r\n    console.log(`SDF DE ${id} MODIFICADO`);\r\n    sharedFunctions.updateNodeSdf(id, sdf);\r\n  }, [sdf]);\r\n\r\n  useEffect(() => {\r\n    console.log(\"ACTUALIZADO SDF\");\r\n    if (primitive == Primitives.Sphere) {\r\n      setSdf(`sphere(p, ${inputs[0].toFixed(4)})`);\r\n      prepareInputs(\"radius\");\r\n    } \r\n    else if (primitive == Primitives.Box) {\r\n      setSdf(\r\n        `box(p, vec3(\r\n          ${inputs[0].toFixed(4)}, \r\n          ${inputs[1].toFixed(4)}, \r\n          ${inputs[2].toFixed(4)}\r\n          )\r\n        )`\r\n      );\r\n      prepareInputs(\"sx\", \"sy\", \"sz\");\r\n    }\r\n    else if (primitive == Primitives.Torus) {\r\n      setSdf(\r\n        `torus(p, vec2(\r\n          ${inputs[0].toFixed(4)}, \r\n          ${inputs[1].toFixed(4)}\r\n          )\r\n        )`\r\n      );\r\n      prepareInputs(\"hole\", \"thickness\");\r\n    }\r\n    else if (primitive == Primitives.Cylinder) {\r\n      setSdf(\r\n        `cylinder(p, \r\n          ${inputs[0].toFixed(4)}, \r\n          ${inputs[1].toFixed(4)}\r\n        )`\r\n      );\r\n      prepareInputs(\"height\", \"radius\");\r\n    }\r\n  }, [primitive, inputs]);\r\n\r\n  const prepareInputs = (label1, label2=\"\", label3=\"\") =>{\r\n    setInputLabels([label1, label2, label3]);\r\n    setInputsActive([label1, label2, label3]);\r\n  }\r\n\r\n  return (\r\n    <div className=\"custom-node\">\r\n      <div className=\"custom-node-header\">Primitive</div>\r\n      <Dropdown value={primitive} onChange={setPrimitive} items={Object.values(Primitives)} label=\"Primitive\"/> \r\n      {inputsActive[0] ? <FloatInput val={inputs[0]} handleChange={(newVal) => setInputs([newVal, inputs[1], inputs[2]])} label={inputLabels[0]} /> : null}\r\n      {inputsActive[1] ? <FloatInput val={inputs[1]} handleChange={(newVal) => setInputs([inputs[0], newVal, inputs[2]])} label={inputLabels[1]} /> : null}\r\n      {inputsActive[2] ? <FloatInput val={inputs[2]} handleChange={(newVal) => setInputs([inputs[0], inputs[1], newVal])} label={inputLabels[2]} /> : null}\r\n\r\n      \r\n      <p>{`ID: ${id}`}</p>\r\n      <p>CHILDREN: {Object.keys(data.children).map(key => `${data.children[key]}`).join(', ')}</p>\r\n      <p>SDF: {sdf}</p>\r\n\r\n      <CustomHandle type=\"source\"/>\r\n\r\n      {showCanvas ? (\r\n        <Shader\r\n          shader={fs(sdf)}\r\n          uniforms={{ color: { type: \"3fv\", value: [1.0, 1.0, 0.0] } }}\r\n          style={{ margin: \"10px\" }}\r\n        />\r\n      ) : null}\r\n\r\n      <Button\r\n        onClick={() => setShowCanvas(!showCanvas)}\r\n        variant=\"contained\"\r\n        className=\"custom-node-creater\"\r\n        size=\"small\"\r\n        endIcon={\r\n          showCanvas ? <KeyboardArrowUpIcon /> : <KeyboardArrowDownIcon />\r\n        }\r\n      >\r\n        {showCanvas ? \"Hide canvas\" : \"Show canvas\"}\r\n      </Button>\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}