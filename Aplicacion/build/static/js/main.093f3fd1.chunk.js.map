{"version":3,"sources":["storageHook.js","primitivesHook.js","CustomComponents/Shader.js","ShaderStuff/sdfShader.js","ShaderStuff/operators.js","ShaderStuff/defaultShader.js","CustomComponents/Dropdown.js","uniqueIdHook.js","CustomNodes/CustomHandle.js","GraphPage/GraphContext.js","CustomComponents/ToggleButton.js","CustomNodes/CustomNode.js","CustomComponents/FloatInput.js","CustomNodes/PrimitiveNode.js","CustomComponents/FloatSlider.js","CustomNodes/BooleanNode.js","CustomNodes/DeformNode.js","CustomComponents/Vector3Input.js","CustomNodes/TransformNode.js","CustomComponents/CustomControls.js","GraphPage/nodeTypes.js","CustomComponents/CustomContextMenu.js","GraphPage/Graph.js","CustomNodes/ButtonEdge.js","MaterialPage/MaterialCard.js","MaterialPage/MaterialsPage.js","CustomComponents/CustomTable.js","CustomComponents/CustomInputTable.js","SurfacePage/SurfaceDialog.js","SurfacePage/SurfacePage.js","App.js","ShaderStuff/fragmentShaderMovable.js","index.js"],"names":["defaultStorage","sphere","id","name","implicit","sdf","parsedSdf","fHeader","parameters","symbol","label","defaultVal","useLocalStorage","key","useState","item","localStorage","getItem","JSON","parse","err","console","error","window","dispatchEvent","Event","storedValue","setStoredValue","useEffect","listenStorageChange","value","setItem","stringify","addEventListener","removeEventListener","valueToStore","Function","usePrimitivesHook","primitives","setPrimitives","storage","res","log","p","ErrorFallback","resetErrorBoundary","role","message","onClick","myErrorHandler","info","Shader","props","primitivesCode","shader","uniforms","zoom","setZoom","style","timeout","wheelConfig","preventScroll","upHandler","e","downHandler","ratio","FallbackComponent","onError","onReset","fs","u_zoom","type","u_specular","u_diffuse","u_ambient","u_smoothness","Dropdown","React","open","setOpen","FormControl","sx","m","minWidth","InputLabel","Select","defaultValue","onChange","ev","target","autoWidth","size","items","map","MenuItem","lastId","prefix","CustomHandle","theme","useTheme","width","height","background","palette","primary","light","border","main","newId","marginRight","position","marginLeft","GraphContext","createContext","GraphProvider","Provider","CustomButton","styled","Button","color","contrastText","backgroundColor","accent","ToggleButton","variant","borderRadius","endIcon","CustomNode","showMore","setShowMore","isHover","setIsHover","sharedFunctions","useContext","nodeStyle","display","flexDirection","transition","boxShadow","dark","headerStyle","textAlign","fontWeight","fontSize","letterSpacing","justifyContent","footerStyle","updateNodeSdf","handleKeyDown","toLowerCase","document","tabIndex","className","title","currOption","onMouseEnter","onMouseLeave","dropdownOptions","onChangeOption","body","margin","Array","nInputs","i","top","onConnect","params","FloatInput","TextField","val","handleChange","parseFloat","placeholder","paddingLeft","InputProps","startAdornment","InputAdornment","labelColor","padding","borderTopLeftRadius","shape","borderBottomLeftRadius","createTheme","CustomSlider","Slider","opacity","FloatSlider","valueLabelDisplay","min","range","max","step","BooleanOperations","Union","Difference","Intersection","DeformOperations","Bend","Twist","Header","Paper","typography","body2","TextFieldWrapper","Field","Vector3Input","x","setX","y","setY","z","setZ","Box","flexGrow","container","spacing","columns","xs","sm","md","TransformOperations","Translate","Scale","Rotate","CustomControls","save","load","NodeTypes","Primitive","Boolean","Transform","Deform","CustomContextMenu","icons","Object","keys","index","newNode","values","Typography","align","toUpperCase","graphNodeTypes","primitiveNode","data","primitive","setPrimitive","setSdf","inputs","setInputs","inputLabels","setInputLabels","k","length","idx","toFixed","join","ThemeProvider","input","newVal","newInputs","handleInputChange","booleanNode","operation","setOperation","smooth","setK","newSdf","Math","deformNode","replace","v","transformNode","transformVal","setTransformVal","s","edgeTypes","buttonEdge","sourceX","sourceY","targetX","targetY","sourcePosition","targetPosition","edgePath","getBezierPath","getEdgeCenter","edgeCenterX","edgeCenterY","d","foreignObjectSize","requiredExtensions","removeEdge","initialNodes","dragHandle","default","children","memo","useNodesState","nodes","setNodes","onNodesChange","useEdgesState","edges","setEdges","onEdgesChange","rfInstance","setRfInstance","setId","mouseCoor","setMouseCoor","reactFlowRef","useRef","nodesCopy","parent","find","node","child","edgeId","edge","newEdges","filter","source","nds","newChildren","c","onLoad","flow","nodeType","xPos","yPos","nodeId","onKeyDown","project","push","onMouseMove","bounds","current","getBoundingClientRect","clientX","left","clientY","ref","sourceNode","n","eds","addEdge","animated","markerEnd","MarkerType","Arrow","nodeTypes","onInit","snapToGrid","fitView","gap","toObject","MaterialCard","Card","elevation","CardContent","component","mb","CardActions","MaterialsPage","direction","alignItems","StyledTableCell","TableCell","tableCellClasses","head","common","white","StyledTableRow","TableRow","action","hover","descendingComparator","a","b","orderBy","EnhancedTableHead","onSelectAllClick","order","numSelected","rowCount","onRequestSort","TableHead","Checkbox","indeterminate","checked","inputProps","headCell","numeric","disablePadding","sortDirection","TableSortLabel","active","property","event","EnhancedTableToolbar","Toolbar","pl","pr","bgcolor","alpha","activatedOpacity","flex","Tooltip","IconButton","handleDelete","handleCreateRow","CustomTable","page","setPage","rowsPerPage","setRowsPerPage","selected","setSelected","setOrder","setOrderBy","overflow","selectedList","TableContainer","maxHeight","Table","stickyHeader","aria-label","newSelected","rows","TableBody","slice","sort","getComparator","row","selectedIndex","indexOf","concat","handleClick","column","handleRowClick","TablePagination","rowsPerPageOptions","count","onPageChange","newPage","onRowsPerPageChange","CustomInputTable","setRows","newRows","handleNewParameters","handleRowChange","createParameter","SurfaceDialog","nerdamer","require","eqData","setEqData","eqInput","setEqInput","nameInput","setNameInput","parametersInput","setParametersInput","setStorage","errorMsg","setErrorMsg","validEq","setValEq","validName","setValidName","traverseTree","parametersSymbols","includes","right","handleNewEquation","newEq","f","warn","dfdx","diff","dfdy","dfdz","norm","toString","tree","dx","dy","dz","savedData","Dialog","onClose","handleClose","DialogTitle","DialogContent","helperText","endAdornment","Node","formula","convertToLaTeX","latexInfo","newParams","DialogActions","newData","disabled","tableCols","SurfacePage","dialogOpen","setDialogOpen","tableRows","setTableRows","editedRow","setEditedRow","forEach","eq","filtered","entries","newStorage","fromEntries","boolean","deform","transform","MainContent","Grid","fluid","Row","Col","borderRight","layoutStyles","App","tabVal","setTabVal","Tabs","Tab","Content","Footer","Panel","bordered","rootElement","getElementById","ReactDOM","render","StrictMode"],"mappings":"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","file":"static/js/main.093f3fd1.chunk.js","sourcesContent":["import { useEffect, useState } from 'react';\r\n\r\n// torus: (x^2+y^2+z^2+R^2-a^2)^2 - 4R^2(x^2+y^2)\r\n\r\nconst defaultStorage = {\r\n  sphere: {\r\n    id: 'sphere',\r\n    name: 'Sphere',\r\n    implicit: 'x^2 + y^2 + z^2 - r',\r\n    sdf: '|p|-r',\r\n    parsedSdf: 'return length(p)-r',\r\n    fHeader: 'sphere(vec3 p, float r)',\r\n    parameters: [{ symbol: 'r', label: 'Radius', defaultVal: 1.0 }],\r\n  },\r\n  // cube: {\r\n  //   id: 'cube',\r\n  //   name: 'Cube',\r\n  //   implicit: 'max(|x|,|y|,|z|)-1',\r\n  //   sdf: '|max((|x|,|y|,|z|),(sx,sy,sz))| + min(max(|x| - sx, max(|y|-sy, |z|-sz)), 0)',\r\n  //   parsedSdf: `\r\n  //     vec3 b = vec3(sx,sy,sz);\r\n  //     vec3 q = abs(p) - b;\r\n  //     return length(max(q,0.0)) + min(max(q.x,max(q.y,q.z)),0.0);\r\n  //   `,\r\n  //   fHeader: 'cube(vec3 p, float sx, float sy, float sz)',\r\n  //   parameters: [\r\n  //     { symbol: 'sx', label: 'sx', defaultVal: 1.0 },\r\n  //     { symbol: 'sy', label: 'sz', defaultVal: 1.0 },\r\n  //     { symbol: 'sz', label: 'sz', defaultVal: 1.0 }\r\n  //   ],\r\n  // },\r\n\r\n}\r\n\r\nexport const useLocalStorage = (key) => {\r\n  const [storedValue, setStoredValue] = useState(() => {\r\n    // localStorage.clear();\r\n    try {\r\n      const item = localStorage.getItem(key);\r\n      return item ? JSON.parse(item) : defaultStorage;\r\n    } catch (err) {\r\n      console.error(err);\r\n      window.dispatchEvent(new Event('storage'));\r\n      return defaultStorage;\r\n    }\r\n  });\r\n\r\n  const setValue = (value) => {\r\n    try {\r\n      const valueToStore =\r\n        value instanceof Function ? value(storedValue) : value;\r\n      setStoredValue(valueToStore);\r\n      localStorage.setItem(key, JSON.stringify(valueToStore));\r\n      window.dispatchEvent(new Event('storage'));\r\n    } catch (err) {\r\n      console.error(err);\r\n    }\r\n  };\r\n\r\n  // useEffect(() => {\r\n  //   window.dispatchEvent(new Event(\"storage\"));\r\n  // }, [storedValue]);\r\n\r\n  useEffect(() => {\r\n    const listenStorageChange = () => {\r\n      setStoredValue(() => {\r\n        const value = localStorage.getItem(key);\r\n        if (value !== null) {\r\n          return JSON.parse(value);\r\n        }\r\n\r\n        localStorage.setItem(key, JSON.stringify(defaultStorage));\r\n        window.dispatchEvent(new Event('storage'));\r\n        return defaultStorage;\r\n      });\r\n    };\r\n    window.addEventListener('storage', listenStorageChange);\r\n    return () => window.removeEventListener('storage', listenStorageChange);\r\n  }, []);\r\n\r\n  return [storedValue, setValue];\r\n};\r\n\r\nexport default useLocalStorage;\r\n","import { useEffect, useState } from 'react';\r\nimport useLocalStorage from './storageHook.js';\r\n\r\nexport const usePrimitivesHook = () => {\r\n  const [primitives, setPrimitives] = useState('');\r\n  const [storage] = useLocalStorage('user_implicits', {});\r\n\r\n  useEffect(() => {\r\n    let res = '';\r\n\r\n    console.log(\"RECALCULANDO PRIMITIVAS GLSL\");\r\n    for (let key in storage) {\r\n      console.log(key);\r\n      let p = storage[key];\r\n      res +=\r\n        `float ${p.fHeader}{\r\n            float x = p.r;\r\n            float y = p.g;\r\n            float z = p.b;\r\n\r\n            ${p.parsedSdf};\r\n        }\\n`\r\n    }\r\n\r\n    setPrimitives(res);\r\n  }, [storage]);\r\n\r\n  return [primitives, setPrimitives];\r\n};\r\n\r\nexport default usePrimitivesHook;","import React, { useState } from 'react';\r\n\r\nimport { useEffect } from 'react';\r\nimport Ratio from 'react-ratio';\r\nimport ShadertoyReact from 'shadertoy-react';\r\nimport { defaultShader } from '../ShaderStuff/defaultShader';\r\nimport ReactScrollWheelHandler from 'react-scroll-wheel-handler';\r\nimport { fs } from '../ShaderStuff/sdfShader';\r\nimport usePrimitivesHook from '../primitivesHook';\r\nimport { ErrorBoundary } from 'react-error-boundary';\r\n\r\nfunction ErrorFallback({ error, resetErrorBoundary }) {\r\n  return (\r\n    <div role=\"alert\">\r\n      <p>Something went wrong:</p>\r\n      <pre>{error.message}</pre>\r\n      <button onClick={resetErrorBoundary}>Try again</button>\r\n    </div>\r\n  );\r\n}\r\n\r\nconst myErrorHandler = (error, info) => {\r\n  // Do something with the error\r\n  // E.g. log to an error logging client here\r\n  console.log(\"ERROR\");\r\n}\r\n\r\nexport default function Shader(props) {\r\n  const [primitivesCode] = usePrimitivesHook();\r\n\r\n  useEffect(() => {}, [props.shader, props.uniforms]);\r\n\r\n  const [zoom, setZoom] = useState(1.5);\r\n  const zoomIncrement = 0.5;\r\n  return (\r\n    <div style={props.style}>\r\n      <ReactScrollWheelHandler\r\n        timeout=\"0\"\r\n        wheelConfig={[100, 1000, 0.05]}\r\n        preventScroll=\"true \"\r\n        upHandler={(e) => setZoom(zoom + zoomIncrement)}\r\n        downHandler={(e) => setZoom(zoom - zoomIncrement)}\r\n      >\r\n        <Ratio ratio={1}>\r\n          <ErrorBoundary\r\n            FallbackComponent={ErrorFallback}\r\n            onError={myErrorHandler}\r\n            onReset={() => {\r\n              // reset the state of your app so the error doesn't happen again\r\n            }}\r\n          >\r\n            <ShadertoyReact\r\n              fs={props.sdf ? fs(props.sdf, primitivesCode) : defaultShader()}\r\n              key={props.sdf}\r\n              uniforms={{\r\n                ...props.uniforms,\r\n                u_zoom: { type: '1f', value: zoom },\r\n                u_specular: { type: '3fv', value: [1.0, 0.0, 1.0] },\r\n                u_diffuse: { type: '3fv', value: [1.0, 0.0, 0.0] },\r\n                u_ambient: { type: '3fv', value: [0.2, 0.2, 0.2] },\r\n                u_smoothness: { type: '1f', value: 10.0 },\r\n              }}\r\n            />\r\n          </ErrorBoundary>\r\n        </Ratio>\r\n      </ReactScrollWheelHandler>\r\n    </div>\r\n  );\r\n}\r\n","import { operators } from './operators';\r\n\r\nexport const fs = (sdf, primitives) => {\r\n    return `\r\n    #ifdef GL_ES\r\n    precision mediump float;\r\n    #endif\r\n\r\n    // Constants\r\n    const int MAX_MARCHING_STEPS=255;\r\n    const float MIN_DIST=0.;\r\n    const float MAX_DIST=100.;\r\n    const float PRECISION=.0001;\r\n    const float EPSILON=.0005;\r\n    const float PI=3.14159265359;\r\n\r\n    struct Material\r\n    {\r\n    vec3 specular;\r\n    vec3 diffuse;\r\n    vec3 ambient;\r\n    float smoothness;\r\n    };\r\n\r\n    struct Surface{\r\n        float sd;   // signed distance value\r\n        Material mat;\r\n    };\r\n\r\n    // Rotate around a circular path\r\n    mat2 rotate2d(float theta){\r\n        float s = sin(theta),c=cos(theta);\r\n        return mat2(c,-s,s,c);\r\n    }\r\n\r\n    // Rotation matrix around the X axis.\r\n    mat3 rotateX(float theta){\r\n        float c=cos(theta);\r\n        float s=sin(theta);\r\n        return mat3(\r\n            vec3(1.,0.,0.),\r\n            vec3(0.,c,-s),\r\n            vec3(0.,s,c)\r\n        );\r\n    }\r\n\r\n    // Rotation matrix around the Y axis.\r\n    mat3 rotateY(float theta){\r\n        float c=cos(theta);\r\n        float s=sin(theta);\r\n        return mat3(\r\n            vec3(c,0.,s),\r\n            vec3(0.,1.,0.),\r\n            vec3(-s,0.,c)\r\n        );\r\n    }\r\n\r\n    // Rotation matrix around the Z axis.\r\n    mat3 rotateZ(float theta){\r\n        float c=cos(theta);\r\n        float s=sin(theta);\r\n        return mat3(\r\n            vec3(c,-s,0.),\r\n            vec3(s,c,0.),\r\n            vec3(0.,0.,1.)\r\n        );\r\n    }\r\n\r\n    // Identity matrix.\r\n    mat3 identity(){\r\n        return mat3(\r\n            vec3(1,0,0),\r\n            vec3(0,1,0),\r\n            vec3(0,0,1)\r\n        );\r\n    }\r\n\r\n    ${operators()}\r\n    ${primitives}\r\n\r\n    Surface minWithColor(Surface obj1,Surface obj2){\r\n        if(obj2.sd<obj1.sd) return obj2;\r\n        return obj1;\r\n    }\r\n\r\n\r\n    float sdf(vec3 p){\r\n        return ${sdf};\r\n    }\r\n\r\n    Surface map(vec3 p){\r\n        Material mat = Material(u_specular, u_diffuse, u_ambient, u_smoothness);\r\n        float d = sdf(p);\r\n        \r\n        Surface co = Surface(d, mat);\r\n        \r\n        return co;\r\n    }\r\n\r\n    vec3 grad( in vec3 p )\r\n    {\r\n    return vec3(\r\n        map(vec3(p.x+EPSILON,p.y,p.z)).sd - map(vec3(p.x-EPSILON,p.y,p.z)).sd,\r\n        map(vec3(p.x,p.y+EPSILON,p.z)).sd - map(vec3(p.x,p.y-EPSILON,p.z)).sd,\r\n        map(vec3(p.x,p.y,p.z+EPSILON)).sd - map(vec3(p.x,p.y,p.z-EPSILON)).sd\r\n    );\r\n    }\r\n\r\n    mat3 camera(vec3 cameraPos,vec3 lookAtPoint){\r\n    vec3 cd = normalize(lookAtPoint-cameraPos);      // camera direction\r\n    vec3 cr = normalize(cross(vec3(0.,1.,0.),cd)); // camera right\r\n    vec3 cu = normalize(cross(cd,cr));               // camera up\r\n    \r\n    return mat3(-cr,cu,-cd);\r\n    }\r\n\r\n    Surface rayMarch(vec3 ro,vec3 rd,float start,float end){\r\n    float depth = start;\r\n    Surface co; // closest object\r\n    \r\n    for(int i=0; i<MAX_MARCHING_STEPS; i++){\r\n        vec3 p = ro + depth*rd;\r\n        co = map(p);\r\n        depth += co.sd;\r\n        if(co.sd<PRECISION||depth>end)  break;\r\n    }\r\n    \r\n    co.sd = depth;\r\n    \r\n    return co;\r\n    }\r\n\r\n    vec3 lighting(vec3 p,vec3 n,vec3 eye,Material mat){\r\n    vec3 ambient = vec3(.5);\r\n    \r\n    vec3 lights_pos[2];\r\n    lights_pos[0] = vec3(4.,2.,2.);\r\n    lights_pos[1] = vec3(-4.,-2.,-2.);\r\n    \r\n    vec3 lights_color[2];\r\n    lights_color[0] = vec3(1.,1.,1.);\r\n    lights_color[1] = vec3(1.,1.,1.);\r\n    \r\n    vec3 Ip = mat.ambient*ambient;\r\n    \r\n    for(int i=0;i<2;i++){\r\n        vec3 Lm = normalize(lights_pos[i] - p);\r\n        vec3 Rm = normalize(2.0*(dot(Lm,n))*n - Lm); // reflect(-Lm, n)\r\n        vec3 V  = normalize(eye - p);\r\n        \r\n        float LN = dot(Lm,n);\r\n        float RV = dot(Rm,V);\r\n        \r\n        if(LN<0.) // Light not visible\r\n        Ip+=vec3(0.,0.,0.);\r\n        else if(RV<0.)// opposite direction as viewer, apply only diffuse\r\n        Ip+=lights_color[i]*(mat.diffuse*LN);\r\n        else\r\n        Ip+=lights_color[i]*(mat.diffuse*LN+mat.specular*pow(RV,mat.smoothness));\r\n    }\r\n    \r\n    return Ip;\r\n    }\r\n\r\n    vec3 calcNormal(in vec3 p){\r\n    return normalize(vec3(\r\n        map(vec3(p.x+EPSILON,p.y,p.z)).sd - map(vec3(p.x-EPSILON,p.y,p.z)).sd,\r\n        map(vec3(p.x,p.y+EPSILON,p.z)).sd - map(vec3(p.x,p.y-EPSILON,p.z)).sd,\r\n        map(vec3(p.x,p.y,p.z+EPSILON)).sd - map(vec3(p.x,p.y,p.z-EPSILON)).sd\r\n    ));\r\n    }\r\n    \r\n    void main()\r\n    {\r\n        vec2 uv = (gl_FragCoord.xy - 0.5*iResolution.xy) / iResolution.y;\r\n        \r\n        vec2 mouseUV = iMouse.x>=0.0 ? iMouse.xy/iResolution.xy : vec2(0.5);  // [0,1]\r\n\r\n        vec3 backgroundColor = vec3(.835, 1.0, 1.0);\r\n        vec3 col    = vec3(0.0);\r\n        \r\n        vec3 lookAt = vec3(0.0);\r\n        vec3 eye    = vec3(0,5,0);\r\n\r\n        float cameraRadius = u_zoom;\r\n        \r\n        eye.yz = eye.yz * cameraRadius * rotate2d( mix(PI, 0.0, mouseUV.y) );\r\n        eye.xz = eye.xz * rotate2d( mix(-PI, PI, mouseUV.x) ) \r\n                    + vec2(lookAt.x, lookAt.z);\r\n        \r\n        vec3 rayDir = camera(eye, lookAt) * normalize(vec3(uv,-1));// ray direction\r\n        \r\n        Surface co = rayMarch(eye, rayDir, MIN_DIST, MAX_DIST);// closest object\r\n        \r\n        if(co.sd > MAX_DIST){\r\n            col = backgroundColor;  // ray didn't hit anything\r\n        }\r\n        else{\r\n            vec3 p = eye + rayDir*co.sd;  // point from ray marching\r\n            vec3 normal = calcNormal(p);\r\n            \r\n            col = lighting(p, normal, eye, co.mat);\r\n        }\r\n        \r\n        gl_FragColor = vec4(col, 1.0);\r\n        return;\r\n    }\r\n  `;\r\n};\r\n","export const operators = () => `\r\n    vec3 sdfTwist( in vec3 p, in float k )\r\n    {\r\n        float c = cos(k*p.y);\r\n        float s = sin(k*p.y);\r\n        mat2  m = mat2(c,-s,s,c);\r\n        vec3  q = vec3(m*p.xz,p.y);\r\n        return q;\r\n    }\r\n\r\n    vec3 sdfBend(in vec3 p, in float k )\r\n    {\r\n        float c = cos(k*p.x);\r\n        float s = sin(k*p.x);\r\n        mat2  m = mat2(c,-s,s,c);\r\n        vec3  q = vec3(m*p.xy,p.z);\r\n        return q;\r\n    }\r\n    vec3 sdfRepeat( in vec3 p, in float s, in vec3 lim )\r\n    {\r\n        return p-s*clamp(floor(p/s+0.5),-lim,lim);\r\n    }\r\n\r\n    float sdfUnion( float d1, float d2 ) {\r\n        \r\n        return min(d1,d2);\r\n    }\r\n\r\n    float sdfSmoothUnion( float d1, float d2, float k ) {\r\n        float h = clamp( 0.5 + 0.5*(d2-d1)/k, 0.0, 1.0 );\r\n        return mix( d2, d1, h ) - k*h*(1.0-h); \r\n    }\r\n\r\n    float sdfDifference( float d1, float d2 ) {\r\n        \r\n        return max(-d1,d2);\r\n    }\r\n\r\n    float sdfSmoothDifference( float d1, float d2, float k ) {\r\n        float h = clamp( 0.5 - 0.5*(d2+d1)/k, 0.0, 1.0 );\r\n        return mix( d2, -d1, h ) + k*h*(1.0-h); \r\n    }\r\n\r\n    float sdfIntersection( float d1, float d2 ) {\r\n        \r\n        return max(d1,d2);\r\n    }\r\n\r\n    float sdfSmoothIntersection( float d1, float d2, float k ) {\r\n        float h = clamp( 0.5 - 0.5*(d2-d1)/k, 0.0, 1.0 );\r\n        return mix( d2, d1, h ) + k*h*(1.0-h); \r\n    }\r\n\r\n    // https://stackoverflow.com/questions/34050929/3d-point-rotation-algorithm\r\n    vec3 sdfRotate(vec3 p, vec3 ang) {\r\n        float pitch = ang.x;\r\n        float roll = ang.y;\r\n        float yaw = ang.z;\r\n\r\n        float cosa = cos(yaw);\r\n        float sina = sin(yaw);\r\n\r\n        float cosb = cos(pitch);\r\n        float sinb = sin(pitch);\r\n\r\n        float cosc = cos(roll);\r\n        float sinc = sin(roll);\r\n\r\n        float Axx = cosa*cosb;\r\n        float Axy = cosa*sinb*sinc - sina*cosc;\r\n        float Axz = cosa*sinb*cosc + sina*sinc;\r\n\r\n        float Ayx = sina*cosb;\r\n        float Ayy = sina*sinb*sinc + cosa*cosc;\r\n        float Ayz = sina*sinb*cosc - cosa*sinc;\r\n\r\n        float Azx = -sinb;\r\n        float Azy = cosb*sinc;\r\n        float Azz = cosb*cosc;\r\n\r\n        float px = p.x;\r\n        float py = p.y;\r\n        float pz = p.z;\r\n\r\n        p.x = Axx*px + Axy*py + Axz*pz;\r\n        p.y = Ayx*px + Ayy*py + Ayz*pz;\r\n        p.z = Azx*px + Azy*py + Azz*pz;\r\n        \r\n        return p;\r\n    }\r\n\r\n    vec3 sdfTranslate(vec3 p, vec3 t) {\r\n        return p-t;\r\n    }\r\n\r\n    vec3 sdfScale( vec3 p, vec3 s )\r\n    {\r\n        return (p/s)*s;\r\n    }\r\n\r\n`","export const defaultShader = () => `\r\n#define T_MAX 30.0\r\n\r\nstruct point_light\r\n{\r\n    vec3 p;\r\n    vec3 i;\r\n};\r\n\r\nfloat sdBox( vec3 p, vec3 b )\r\n{\r\n  vec3 d = abs(p) - b;\r\n  return min(max(d.x,max(d.y,d.z)),0.0) + length(max(d,0.0));\r\n}\r\n\r\nvec3 opRep( in vec3 p, in vec3 c)\r\n{\r\n    vec3 q = mod(p,c)-0.5*c;\r\n    return q;\r\n}\r\n\r\nfloat sdf(in vec3 p, out int matid)\r\n{\r\n    float sphere_sdf = length(p - vec3(0, 1, 0)) - 1.0;\r\n    float box_sdf = sdBox(p - vec3(0, 1, 0), vec3(0.8));\r\n    float obj_sdf = max(-sphere_sdf, box_sdf);\r\n    float floor_sdf = abs(p.y);\r\n    \r\n    float sdf = min(obj_sdf, floor_sdf);\r\n    if (sdf == obj_sdf)\r\n    {\r\n        matid = 1;\r\n    }\r\n    else\r\n    {\r\n        matid = 0;\r\n    }\r\n    \r\n    return sdf;\r\n}\r\n\r\nvec3 sdf_n(in vec3 p)\r\n{\r\n    vec3 res = vec3(0);\r\n    \r\n    int ignored;\r\n    res.x = sdf(p + vec3(0.001, 0, 0), ignored) - sdf(p, ignored);\r\n    res.y = sdf(p + vec3(0, 0.001, 0), ignored) - sdf(p, ignored);\r\n    res.z = sdf(p + vec3(0, 0, 0.001), ignored) - sdf(p, ignored);\r\n    \r\n    return normalize(res);\r\n}\r\n\r\nfloat intersect(in vec3 ro, in vec3 rd, out int matid)\r\n{\r\n\tfloat t = 0.0;\r\n    matid = -1;\r\n    for (int i = 0; i < 256; ++i)\r\n    {\r\n        if (t > T_MAX)\r\n        {\r\n            break;\r\n        }\r\n        \r\n        int curr_matid = -1;\r\n\t\tfloat d = sdf(ro + t*rd, curr_matid);\r\n        if (d < 0.0001)\r\n        {\r\n            matid = curr_matid;\r\n            break;\r\n        }\r\n        t += d;\r\n    }\r\n    return t;\r\n}\r\n\r\nfloat dir_shadow(in vec3 p, in vec3 l)\r\n{\r\n    float t = 0.15;\r\n    float t_max = 20.0;\r\n    \r\n    float res = 1.0;\r\n    for (int i = 0; i < 256; ++i)\r\n    {\r\n        if (t > t_max) break;\r\n        \r\n        int ignored;\r\n        float d = sdf(p + t*l, ignored);\r\n        if (d < 0.01)\r\n        {\r\n            return 0.0;\r\n        }\r\n        t += d;\r\n        res = min(res, 8.0 * d / t);\r\n    }\r\n    \r\n    return res;\r\n}\r\n\r\nfloat point_shadow(in vec3 p, in vec3 light_p)\r\n{\r\n    vec3 l = normalize(light_p - p);\r\n        \r\n    float t = 0.15;\r\n    float t_max = distance(light_p, p);\r\n    \r\n    float res = 1.0;\r\n    for (int i = 0; i < 256; ++i)\r\n    {\r\n        if (t > t_max) break;\r\n        \r\n        int ignored;\r\n        float d = sdf(p + t*l, ignored);\r\n        if (d < 0.01)\r\n        {\r\n            return 0.0;\r\n        }\r\n        t += d;\r\n        res = min(res, 64.0 * d / t);\r\n    }\r\n    \r\n    return res;\r\n}\r\n\r\nfloat ao(in vec3 p, in vec3 n)\r\n{\r\n    float e = 0.1;\r\n    float res = 0.0;\r\n    \r\n#define AO_ITER 5\r\n    \r\n    int ignored;\r\n    float weight = 0.5;\r\n    for (int i = 1; i <= AO_ITER; ++i)\r\n    {\r\n        float d = e * float(i);\r\n        res += weight * (1.0 - (d - sdf(p + d * n, ignored)));\r\n        weight *= 0.5;\r\n    }\r\n    \r\n    return res;\r\n}\r\n\r\nvec3 render(in vec2 fragCoord)\r\n{\r\n   \tvec2 uv = 2.0 * fragCoord / iResolution.xy - 1.0;\r\n    uv.x *= iResolution.x / iResolution.y;\r\n     \r\n    float cam_d = 3.0;\r\n    float time = 0.6;\r\n    vec3 ro = vec3(cam_d*sin(time), 2.5, cam_d*cos(time));\r\n    vec3 at = vec3(0, 1, 0);\r\n    vec3 cam_z = normalize(at - ro);\r\n    vec3 cam_x = normalize(cross(vec3(0,1,0), cam_z));\r\n    vec3 cam_y = cross(cam_z, cam_x);\r\n    vec3 rd = normalize(uv.x * cam_x + uv.y * cam_y + 1.73 * cam_z);\r\n\t\r\n    vec3 sky = vec3(0.02);\r\n    vec3 col = vec3(0);\r\n    \r\n    int matid = -1;\r\n    float t = intersect(ro, rd, matid);\r\n    if (matid != -1)\r\n    { \r\n        vec3 p = ro + t*rd;\r\n        vec3 n = sdf_n(p);\r\n        \r\n#define PLIGHT_COUNT 1 \r\n        point_light plights[PLIGHT_COUNT];\r\n        plights[0] = point_light(vec3(2, 1, 1), vec3(20));\r\n\r\n        vec3 direct_light = vec3(0);\r\n        for (int plight_index = 0; plight_index < PLIGHT_COUNT; ++plight_index)\r\n        {\r\n            vec3 light_i = plights[plight_index].i;\r\n            vec3 light_p = plights[plight_index].p;\r\n        \tfloat light_r = dot(light_p - p, light_p - p);\r\n        \tvec3 l = normalize(light_p - p);\r\n        \r\n        \tdirect_light += point_shadow(p, light_p) * max(0.0, dot(n, l)) * light_i / (light_r * light_r);\r\n        }\r\n\r\n        vec3 indirect_light = ao(p, n) * sky;\r\n        \r\n        vec3 albedo = vec3(0.9);      \r\n\t\tcol = albedo * (0.7 * direct_light + indirect_light);\r\n        \r\n        col = mix(col, vec3(0), clamp(pow(t / T_MAX, 2.0), 0.0, 1.0));\r\n    }\r\n    \r\n    return col;\r\n}\r\n\r\nvec3 tonemap(in vec3 col)\r\n{\r\n    return col / (1.0 + col);\r\n}\r\n\r\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\r\n{\r\n#if 0\r\n    vec3 col = tonemap(render(fragCoord));\r\n#else\r\n    vec3 col = vec3(0);\r\n    col += tonemap(render(fragCoord + vec2(0.25, 0.25)));\r\n    col += tonemap(render(fragCoord + vec2(0.25, -0.25)));\r\n    col += tonemap(render(fragCoord + vec2(-0.25, -0.25)));\r\n    col += tonemap(render(fragCoord + vec2(-0.25, 0.25)));\r\n    col /= 4.0;\r\n#endif\r\n    \r\n    col = sqrt(col);\r\n    fragColor = vec4(col, 1.0);\r\n}\r\n`;\r\n","import React from \"react\";\r\n\r\nimport MenuItem from \"@mui/material/MenuItem\";\r\nimport FormControl from \"@mui/material/FormControl\";\r\nimport Select from \"@mui/material/Select\";\r\nimport InputLabel from \"@mui/material/InputLabel\";\r\n\r\nexport default function Dropdown(props) {\r\n  const [open, setOpen] = React.useState(false);\r\n\r\n  return (\r\n    <FormControl onClick={() => setOpen(!open)} sx={{ m: 1, minWidth: 80 }}>\r\n      <InputLabel>{props.label}</InputLabel>\r\n      <Select\r\n        defaultValue={props.defaultValue}\r\n        value={props.value}\r\n        onChange={(ev) => props.onChange(ev.target.value)}\r\n        autoWidth\r\n        size=\"small\"\r\n        open={open}\r\n      >\r\n        {props.items.map((item) => (\r\n          <MenuItem key={item} value={item}>\r\n            {item}\r\n          </MenuItem>\r\n        ))}\r\n      </Select>\r\n    </FormControl>\r\n  );\r\n}\r\n","let lastId = 0;\r\n\r\nexport default function(prefix='id') {\r\n    lastId++;\r\n    return `${prefix}${lastId}`;\r\n}","import React from \"react\";\r\nimport { Handle } from \"react-flow-renderer\";\r\nimport { useTheme } from '@mui/material/styles';\r\nimport newId from \"../uniqueIdHook\";\r\n\r\nexport default function CustomHandle(props) {\r\n  const theme = useTheme();\r\n  const radius = \"10px\";\r\n  const margin = \"-2px\"\r\n\r\n  const style = {\r\n    ...props.style, width: `${radius}`, height: `${radius}`,\r\n    background: `${theme.palette.primary.light}`,\r\n    border: `1px solid ${theme.palette.primary.main}`\r\n  }\r\n\r\n  const id = newId('handle');\r\n\r\n\r\n  return (\r\n    <>\r\n      {props.type === \"source\" ?\r\n        <Handle\r\n          type=\"source\"\r\n          key={id}\r\n          style={{\r\n            ...style, marginRight: `${margin}`\r\n          }}\r\n          position=\"right\"\r\n        />\r\n        :\r\n        <Handle\r\n          type=\"target\"\r\n          key={id}\r\n          style={{\r\n            ...style, marginLeft: `${margin}`\r\n          }}\r\n          position=\"left\"\r\n        />\r\n      }\r\n    </>\r\n  );\r\n}\r\n","import React from 'react';\r\nconst GraphContext = React.createContext({});\r\nexport const GraphProvider = GraphContext.Provider;\r\nexport default GraphContext;","import React from \"react\";\r\nimport { styled } from '@mui/material/styles';\r\nimport Button from '@mui/material/Button';\r\nimport KeyboardArrowDownIcon from \"@mui/icons-material/KeyboardArrowDown\";\r\nimport KeyboardArrowUpIcon from \"@mui/icons-material/KeyboardArrowUp\";\r\n\r\nconst CustomButton = styled(Button)(({ theme }) => ({\r\n    color: theme.palette.contrastText,\r\n    backgroundColor: theme.palette.primary,\r\n    '&:hover': {\r\n      backgroundColor: theme.palette.accent,\r\n    },\r\n  }));\r\n\r\nexport default function ToggleButton(props) {\r\n    return (\r\n        <CustomButton\r\n        onClick={props.onClick}\r\n        variant=\"contained\"\r\n        size=\"small\"\r\n        style={{ width: \"100%\", borderRadius: \"0 0 5px 5px\", height: \"15px\"}}\r\n        endIcon={\r\n          props.value ? <KeyboardArrowUpIcon /> : <KeyboardArrowDownIcon />\r\n        }\r\n      >\r\n      </CustomButton>\r\n    );\r\n}","import React, { useEffect, useContext } from 'react';\r\nimport Shader from '../CustomComponents/Shader';\r\nimport { useTheme } from '@mui/material/styles';\r\nimport Dropdown from '../CustomComponents/Dropdown';\r\nimport CustomHandle from './CustomHandle';\r\nimport GraphContext from '../GraphPage/GraphContext.js';\r\nimport ToggleButton from '../CustomComponents/ToggleButton';\r\nimport newId from '../uniqueIdHook';\r\n\r\nexport default function CustomNode(props) {\r\n  const [showMore, setShowMore] = React.useState(true);\r\n  const [isHover, setIsHover] = React.useState(false);\r\n\r\n  const sharedFunctions = useContext(GraphContext);\r\n  const theme = useTheme();\r\n  const width = 200;\r\n\r\n  const nodeStyle = {\r\n    position: 'relative',\r\n    width: `${width}px`,\r\n    display: 'flex',\r\n    flexDirection: 'column',\r\n    transition: 'border 300ms ease',\r\n    borderRadius: '0px 0px 0px 0px',\r\n    backgroundColor: '#fff',\r\n\r\n    boxShadow: isHover\r\n      ? '0 6px 12px rgba(0, 0, 0, 0.25), 0 6px 12px rgba(0, 0, 0, 0.25)'\r\n      : '0 3px 6px rgba(0, 0, 0, 0.16), 0 3px 6px rgba(0, 0, 0, 0.23)',\r\n\r\n    border: isHover\r\n      ? `1px solid ${theme.palette.primary.dark}`\r\n      : `1px solid ${theme.palette.primary.main}`,\r\n\r\n    '&:hover': {\r\n      transition: 'box-shadow 200ms ease',\r\n      boxShadow:\r\n        '0 6px 12px rgba(0, 0, 0, 0.25), 0 6px 12px rgba(0, 0, 0, 0.25)',\r\n      border: `1px solid ${theme.palette.primary.dark}`,\r\n    },\r\n  };\r\n\r\n  const headerStyle = {\r\n    height: showMore ? '20px' : '40px',\r\n    width: `${width}px`,\r\n    color: '#EFF7FF',\r\n    borderRadius: '5px 5px 0px 0px',\r\n    textAlign: 'center',\r\n    fontWeight: '600',\r\n    fontSize: showMore ? '14px' : '24px',\r\n    letterSpacing: '0.1px',\r\n    justifyContent: 'flex-start',\r\n    backgroundColor: `${theme.palette.primary.main}`,\r\n  };\r\n\r\n  const footerStyle = {\r\n    height: '20px',\r\n    width: `${width}px`,\r\n    color: '#EFF7FF',\r\n    borderRadius: '0px 0px 5px 5px',\r\n    backgroundColor: `${theme.palette.primary.main}`,\r\n  };\r\n\r\n  const handleMouseEnter = () => {\r\n    setIsHover(true);\r\n  };\r\n\r\n  const handleMouseLeave = () => {\r\n    setIsHover(false);\r\n  };\r\n\r\n  useEffect(() => {\r\n    console.log(`SDF DE ${props.id} MODIFICADO`);\r\n    sharedFunctions.updateNodeSdf(props.id, props.sdf);\r\n  }, [props.sdf]);\r\n\r\n  useEffect(() => {\r\n    const handleKeyDown = (e) => {\r\n      if (e.key.toLowerCase() === 's') setShowMore(!showMore);\r\n    };\r\n\r\n    document.addEventListener('keydown', handleKeyDown);\r\n    return () => document.removeEventListener('keydown', handleKeyDown);\r\n  }, [showMore]);\r\n\r\n  return (\r\n    <div tabIndex=\"0\">\r\n      <div className=\"nodeHeader\" style={headerStyle}>\r\n        {showMore ? props.title : props.currOption}\r\n      </div>\r\n\r\n      {showMore ? (\r\n        <div\r\n          className=\"nodeBody\"\r\n          onMouseEnter={handleMouseEnter}\r\n          onMouseLeave={handleMouseLeave}\r\n          style={nodeStyle}\r\n        >\r\n          {props.dropdownOptions ? (\r\n            <Dropdown\r\n              defaultValue={props.dropdownOptions[0]}\r\n              onChange={props.onChangeOption}\r\n              items={props.dropdownOptions}\r\n              label={props.title}\r\n            />\r\n          ) : null}\r\n\r\n          {showMore ? (\r\n            <>\r\n              {/* <p >{`ID: ${props.id}`}</p>\r\n              <p>\r\n                CHILDREN:{\" \"}\r\n                {Object.keys(props.data.children)\r\n                  .map((key) => `${props.data.children[key]}`)\r\n                  .join(\", \")}\r\n              </p>\r\n              <p>{`SDF: ${props.sdf}`}</p> */}\r\n\r\n              {props.body}\r\n              <Shader\r\n                sdf={props.sdf}\r\n                style={{ margin: '10px', height: '100%' }}\r\n              />\r\n            </>\r\n          ) : null}\r\n        </div>\r\n      ) : null}\r\n\r\n      <div style={footerStyle}>\r\n        <ToggleButton value={showMore} onClick={() => setShowMore(!showMore)} />\r\n      </div>\r\n\r\n      {/* {[...Array(props.nInputs)].map((e, i) =>\r\n        <CustomHandle\r\n          type=\"target\"\r\n          style={{ top: `${50 - ((props.nInputs - 1) / 2) * 5 + i * 5}%` }}\r\n        />\r\n      )\r\n      } */}\r\n\r\n      {[...Array(props.nInputs)].map(function (e, i) {\r\n        return (\r\n          <div key={newId('targetHandleContainer_')}>\r\n            <CustomHandle\r\n              type=\"target\"\r\n              style={{ top: `${50 - ((props.nInputs - 1) / 2) * 5 + i * 5}%` }}\r\n            />\r\n          </div>\r\n        );\r\n      })}\r\n\r\n      <CustomHandle\r\n        type=\"source\"\r\n        onConnect={(params) => console.log('handle onsConnect', params)}\r\n        style={{ top: '50%' }}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport TextField from '@mui/material/TextField';\r\nimport InputAdornment from '@mui/material/InputAdornment';\r\nimport newId from '../uniqueIdHook';\r\n\r\nexport default function FloatInput(props) {\r\n  return (\r\n\r\n    <TextField\r\n      id={newId(`${props.label}_floatInput`)}\r\n      value={props.val}\r\n      type=\"number\"\r\n      onChange={(ev) => props.handleChange(parseFloat(ev.target.value))}\r\n      placeholder={props.label}\r\n      \r\n      sx={{\r\n        '& .MuiOutlinedInput-root': {\r\n          paddingLeft: 0,\r\n          m: 1,\r\n          height: \"30px\"\r\n        },\r\n      }}\r\n      InputProps={{\r\n        startAdornment: (\r\n          <InputAdornment\r\n            sx={{\r\n              backgroundColor: props.labelColor ? props.labelColor : \"gray\",\r\n              padding: '15px 14px',\r\n              borderTopLeftRadius: (theme) => theme.shape.borderRadius + 'px',\r\n              borderBottomLeftRadius: (theme) => theme.shape.borderRadius + 'px',\r\n            }}\r\n            position=\"start\"\r\n          >\r\n            {props.label}\r\n          </InputAdornment>\r\n        ),\r\n      }}\r\n    />\r\n  );\r\n}\r\n","import React, { useEffect } from 'react';\r\nimport CustomNode from '../CustomNodes/CustomNode';\r\nimport FloatInput from '../CustomComponents/FloatInput.js';\r\nimport { createTheme, ThemeProvider } from '@mui/material/styles';\r\nimport useLocalStorage from '../storageHook';\r\nimport newId from '../uniqueIdHook';\r\n\r\nconst theme = createTheme({\r\n  palette: {\r\n    primary: {\r\n      light: '#92bcff',\r\n      main: '#609dff',\r\n      dark: '#166cf5',\r\n      contrastText: 'white',\r\n    },\r\n  },\r\n});\r\n\r\nexport default function PrimitiveNode({ data, id }) {\r\n  const [primitive, setPrimitive] = React.useState('sphere');\r\n  const [sdf, setSdf] = React.useState('');\r\n  const [inputs, setInputs] = React.useState([1.0, 1.0, 1.0]);\r\n  const [inputLabels, setInputLabels] = React.useState(['Radius', '', '']);\r\n  const [storage] = useLocalStorage('user_implicits', {});\r\n\r\n  const handleInputChange = (newVal, idx) => {\r\n    const newInputs = [...inputs];\r\n    newInputs[idx] = newVal;\r\n\r\n    setInputs(newInputs);\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (!storage[primitive])\r\n      return;\r\n\r\n    const parameters = storage[primitive].parameters;\r\n\r\n    console.log('TYPE: ' + typeof parameters[0].defaultVal);\r\n    setInputs(\r\n      Object.keys(parameters).map(function (k) {\r\n        return parameters[k].defaultVal;\r\n      })\r\n    );\r\n    setInputLabels(\r\n      Object.keys(parameters).map(function (k) {\r\n        return parameters[k].label;\r\n      })\r\n    );\r\n\r\n    // setInputs(Array(parameters.length).fill().map((_, idx) => parameters[idx].defaultVal));\r\n    console.log(parameters);\r\n    console.log(primitive);\r\n\r\n  }, [primitive]);\r\n\r\n  useEffect(() => {\r\n    if (!storage[primitive])\r\n      return;\r\n\r\n    const parameters = storage[primitive].parameters;\r\n    console.log(inputs);\r\n    setSdf(\r\n      `${primitive}(p ${parameters.length > 0 ? ',' : ''}${parameters\r\n        .map((p, idx) => `${inputs[idx].toFixed(4)}`)\r\n        .join(',')})`\r\n    );\r\n  }, [inputs]);\r\n\r\n  return (\r\n    <ThemeProvider theme={theme}>\r\n      <CustomNode\r\n        title={'Primitive'}\r\n        id={id}\r\n        data={data}\r\n        dropdownOptions={Object.keys(storage)}\r\n        body={\r\n          <>\r\n            {inputs.map(function (input, idx) {\r\n              return (\r\n                <div key={newId('floatInputContainer_')}>\r\n                  <FloatInput\r\n                    val={inputs[idx]}\r\n                    handleChange={(newVal) => handleInputChange(newVal, idx)}\r\n                    label={inputLabels[0]}\r\n                  />\r\n                </div>\r\n              );\r\n            })}\r\n          </>\r\n        }\r\n        onChangeOption={setPrimitive}\r\n        sdf={sdf}\r\n        currOption={primitive}\r\n        nInputs={0}\r\n      />\r\n    </ThemeProvider>\r\n  );\r\n}\r\n","import React from \"react\";\r\nimport Slider from '@mui/material/Slider';\r\nimport { styled } from '@mui/material/styles';\r\n\r\nconst CustomSlider = styled(Slider)(({ theme }) => ({\r\n    color: theme.palette.primary,\r\n    \"& .MuiSlider-thumb\": {\r\n        backgroundColor: theme.palette.primary,\r\n        '&:focus, &:hover, &.Mui-active': {\r\n            boxShadow:\r\n              '0 3px 1px rgba(0,0,0,0.1),0 4px 8px rgba(0,0,0,0.3),0 0 0 1px rgba(0,0,0,0.02)',\r\n            // Reset on touch devices, it doesn't add specificity\r\n            '@media (hover: none)': {\r\n              boxShadow: '0 3px 1px rgba(0,0,0,0.1),0 4px 8px rgba(0,0,0,0.13),0 0 0 1px rgba(0,0,0,0.02)',\r\n            },\r\n          },\r\n    },\r\n    \"& .MuiSlider-rail\": {\r\n        opacity: 0.5,\r\n        backgroundColor: theme.palette.primary\r\n    }\r\n}));\r\n\r\nexport default function FloatSlider(props) {\r\n    return (\r\n        <CustomSlider\r\n            size=\"small\"\r\n            valueLabelDisplay=\"auto\"\r\n            onChange={props.handleChange}\r\n            min={props.range[0]}\r\n            max={props.range[1]}\r\n            step={0.1}\r\n            style={{width:\"90%\", margin:\"10px\"}}\r\n        />\r\n    );\r\n}","import React, { useEffect } from \"react\";\r\nimport CustomNode from \"../CustomNodes/CustomNode\";\r\nimport FloatSlider from \"../CustomComponents/FloatSlider\";\r\nimport { createTheme, ThemeProvider } from '@mui/material/styles';\r\n\r\nconst theme = createTheme({\r\n  palette: {\r\n    primary: {\r\n      light: '#ff8787',\r\n      main: '#ff5858',\r\n      dark: '#ff2323',\r\n      contrastText: 'white',\r\n    },\r\n  },\r\n});\r\n\r\nconst BooleanOperations = {\r\n  Union: \"Union\",\r\n  Difference: \"Difference\",\r\n  Intersection: \"Intersection\",\r\n};\r\n\r\nexport default function BooleanNode({ data, id }) {\r\n  const [operation, setOperation] = React.useState(BooleanOperations.Union);\r\n  const [smooth] = React.useState(true);\r\n  const [k, setK] = React.useState(0.0);\r\n  const [sdf, setSdf] = React.useState(\"\");\r\n\r\n  useEffect(() => {\r\n    console.log(\r\n      `SE HAN MODIFICADO LOS SDF EN NODO BOOLEANO ${id}. AHORA HAY ${Object.keys(data.inputs).length\r\n      }`\r\n    );\r\n\r\n    \r\n\r\n    // minimum of 2 inputs\r\n    const keys = Object.keys(data.inputs);\r\n    if(keys.length < 2)\r\n      return;\r\n\r\n    let newSdf = `sdfSmooth${operation}(${data.inputs[keys[0]]}, ${data.inputs[keys[1]]}, ${k})`;\r\n\r\n    // Add the rest of inputs\r\n    for (let i = 0; i < keys.length - 2; i++) {\r\n      console.log(data.inputs[keys[i + 2]]);\r\n      newSdf = `sdfSmooth${operation}(${data.inputs[keys[i + 2]]}, ${newSdf}, ${k})`;\r\n    };\r\n\r\n    setSdf(newSdf);\r\n  }, [data, operation, smooth, k]);\r\n\r\n\r\n\r\n  const handleChange = (ev, val) => {\r\n    setK(parseFloat(val));\r\n  }\r\n\r\n  return (\r\n    <ThemeProvider theme={theme}>\r\n      <CustomNode\r\n        title={\"Boolean\"}\r\n        id={id}\r\n        data={data}\r\n        dropdownOptions={Object.values(BooleanOperations)}\r\n        onChangeOption={setOperation}\r\n        sdf={sdf}\r\n        currOption={operation}\r\n        nInputs={Math.max(2, Object.keys(data.inputs).length + 1)}\r\n        body={\r\n          <div style={{ margin: 10 }}>\r\n            Smoothness\r\n\r\n            <FloatSlider\r\n              handleChange={handleChange}\r\n              range={[0, 10]}\r\n            />\r\n\r\n          </div>\r\n        }\r\n      />\r\n    </ThemeProvider>\r\n  );\r\n}","import React, { useEffect } from \"react\";\r\nimport CustomNode from \"../CustomNodes/CustomNode\";\r\nimport Slider from '@mui/material/Slider';\r\nimport { createTheme, ThemeProvider } from '@mui/material/styles';\r\n\r\nconst theme = createTheme({\r\n  palette: {\r\n    primary: {\r\n      light: '#a8f798',\r\n      main: '#3ec224',\r\n      dark: '#1c9404',\r\n      contrastText: 'white',\r\n    },\r\n  },\r\n});\r\n\r\nconst DeformOperations = {\r\n  Bend: \"Bend\",\r\n  Twist: \"Twist\",\r\n};\r\n\r\nexport default function DeformNode({ data, id }) {\r\n  const [operation, setOperation] = React.useState(DeformOperations.Bend);\r\n  const [k, setK] = React.useState(0.0);\r\n\r\n  const [sdf, setSdf] = React.useState(\"\");\r\n\r\n  useEffect(() => {\r\n    console.log(\r\n      `SE HAN MODIFICADO LOS SDF EN NODO DEFORM ${id}. AHORA HAY ${Object.keys(data.inputs).length\r\n      }`\r\n    );\r\n    \r\n    let input = data.inputs[Object.keys(data.inputs)[0]];\r\n\r\n    if(input){\r\n      console.log(\"OLD: \" + input);\r\n      console.log(typeof(input));\r\n      setSdf(input.replace(\"p,\", `sdf${operation}(p, ${k}),`));\r\n\r\n    }\r\n  }, [data, operation, k]);\r\n\r\n  return (\r\n    <ThemeProvider theme={theme}>\r\n    <CustomNode\r\n      title={\"Deform\"}\r\n      id={id}\r\n      data={data}\r\n      dropdownOptions={Object.values(DeformOperations)}\r\n      onChangeOption={setOperation}\r\n      sdf={sdf}\r\n      currOption={operation}\r\n      body={\r\n        <div style={{ margin: 10 }}>\r\n            Amount\r\n         \r\n            <Slider\r\n              size=\"small\"\r\n              value={k}\r\n              label=\"k\"\r\n              valueLabelDisplay=\"on\"\r\n              onChange={(e, v) => setK(parseFloat(v))}\r\n              min={0}\r\n              max={5}\r\n              step={0.1}\r\n          />          \r\n        </div>\r\n      }\r\n    />\r\n    </ThemeProvider>\r\n  );\r\n}","import React, {useEffect, useState} from 'react';\r\nimport Box from '@mui/material/Box';\r\nimport Paper from '@mui/material/Paper';\r\nimport Grid from '@mui/material/Grid';\r\nimport { styled } from '@mui/material/styles';\r\nimport TextField from '@mui/material/TextField';\r\n\r\n\r\nconst Header = styled(Paper)(({ theme, color }) => ({\r\n    backgroundColor: color,\r\n    ...theme.typography.body2,\r\n    textAlign: 'center',\r\n    color: theme.palette.primary.contrastText,\r\n    borderRadius: \"3px 3px 0 0\"\r\n}));\r\n\r\nexport const TextFieldWrapper = styled(TextField)`\r\n  fieldset {\r\n    border-radius: 0 0 2px 2px;\r\n  }\r\n`;\r\n\r\nfunction Field(props) {\r\n    return (\r\n        <TextFieldWrapper\r\n            value={props.val}\r\n            type=\"number\"\r\n            onChange={(ev) => props.handleChange(parseFloat(ev.target.value))}\r\n            size=\"small\"\r\n            style={{borderRadius: \"0\"}}\r\n        />\r\n    )\r\n}\r\nexport default function Vector3Input(props) {\r\n    const [x, setX] = useState(0);\r\n    const [y, setY] = useState(0);\r\n    const [z, setZ] = useState(0);\r\n\r\n    useEffect(() => {\r\n        props.handleChange([x,y,z]);\r\n    }, [x,y,z]);\r\n\r\n    return (\r\n        <>\r\n            <Box sx={{ flexGrow: 1 }}>\r\n                <Grid container spacing={0} columns={{ xs: 4, sm: 8, md: 12 }}>\r\n                    <Grid item xs={2} sm={4} md={4} key={1}><Header color='red'>x</Header></Grid>\r\n                    <Grid item xs={2} sm={4} md={4} key={2}><Header color=\"green\">y</Header></Grid>\r\n                    <Grid item xs={2} sm={4} md={4} key={3}><Header color=\"blue\">z</Header></Grid>\r\n\r\n                    <Grid item xs={2} sm={4} md={4} key={4}>\r\n                        <Field val={x} handleChange={setX}/>\r\n                    </Grid>\r\n                    <Grid item xs={2} sm={4} md={4} key={5}>\r\n                        <Field val={y} handleChange={setY}/>\r\n                    </Grid>\r\n                    <Grid item xs={2} sm={4} md={4} key={6}>\r\n                        <Field val={z} handleChange={setZ}/>\r\n                    </Grid>\r\n\r\n                </Grid>\r\n            </Box>\r\n        </>\r\n    );\r\n}\r\n","import React, { useEffect } from \"react\";\r\nimport CustomNode from \"../CustomNodes/CustomNode\";\r\nimport { createTheme, ThemeProvider } from '@mui/material/styles';\r\nimport Vector3Input from \"../CustomComponents/Vector3Input\";\r\n\r\nconst theme = createTheme({\r\n  palette: {\r\n    primary: {\r\n      light: '#ffd7a2',\r\n      main: '#ffbb62',\r\n      dark: '#fa9c21',\r\n      contrastText: 'white',\r\n    },\r\n  },\r\n});\r\n\r\nconst TransformOperations = {\r\n  Translate: \"Translate\",\r\n  Scale: \"Scale\",\r\n  Rotate: \"Rotate\"\r\n};\r\n\r\nexport default function TransformNode({ data, id }) {\r\n  const [operation, setOperation] = React.useState(TransformOperations.Translate);\r\n  const [sdf, setSdf] = React.useState(\"\");\r\n  const [transformVal, setTransformVal] = React.useState([0,0,0]);\r\n\r\n  useEffect(() => {\r\n    console.log(\r\n      `SE HAN MODIFICADO LOS SDF EN NODO TRANSFORM ${id}. AHORA HAY ${Object.keys(data.inputs).length\r\n      }`\r\n    );\r\n\r\n    let input = data.inputs[Object.keys(data.inputs)[0]];\r\n\r\n    if (input) {\r\n      if(operation !== TransformOperations.Scale)\r\n        setSdf(input.replace(\"p,\", `sdf${operation}(p, vec3(${transformVal[0]},${transformVal[1]},${transformVal[2]}) ),`));\r\n      else{\r\n        const s = `vec3(${transformVal[0]},${transformVal[1]},${transformVal[2]})`;\r\n        setSdf(input.replace(\"p,\", `(p/${s}) * ${s},`));\r\n      }\r\n\r\n    }\r\n\r\n  }, [data, operation, transformVal]);\r\n\r\n  return (\r\n    <ThemeProvider theme={theme}>\r\n      <CustomNode\r\n        title={\"Transform\"}\r\n        id={id}\r\n        data={data}\r\n        dropdownOptions={Object.values(TransformOperations)}\r\n        onChangeOption={setOperation}\r\n        sdf={sdf}\r\n        currOption={operation}\r\n        body={\r\n          <div style={{ margin: 10 }}>\r\n            Amount\r\n            <Vector3Input handleChange={setTransformVal}/>\r\n          </div>\r\n        }\r\n      />\r\n    </ThemeProvider>\r\n  );\r\n}","import React from 'react';\r\nimport { Controls, ControlButton } from 'react-flow-renderer';\r\nimport SaveIcon from '@mui/icons-material/Save';\r\nimport FileOpenIcon from '@mui/icons-material/FileOpen';\r\n\r\nexport default function CustomControls(props) {\r\n  return (\r\n    <Controls>\r\n      <ControlButton onClick={() => props.save()}>\r\n        <SaveIcon />\r\n      </ControlButton>\r\n      <ControlButton onClick={() => props.load()}>\r\n        <FileOpenIcon />\r\n      </ControlButton>\r\n    </Controls>\r\n  );\r\n}","export const NodeTypes = {\r\n    Primitive: \"primitiveNode\",\r\n    Boolean: \"booleanNode\",\r\n    Transform: \"transformNode\",\r\n    Deform: \"deformNode\",\r\n  };","import * as React from 'react';\r\nimport { ContextMenu, MenuItem } from \"react-contextmenu\";\r\n\r\nimport { NodeTypes } from '../GraphPage/nodeTypes';\r\nimport Typography from '@mui/material/Typography';\r\n\r\nimport PrimitiveIcon from '@mui/icons-material/ViewInAr';\r\nimport TransformIcon from '@mui/icons-material/Transform';\r\nimport BooleanIcon from '@mui/icons-material/JoinRight';\r\nimport DeformIcon from '@mui/icons-material/Storm';\r\n\r\n// const customStyles = {\r\n//   width: \"250px\",\r\n//   height: \"250px\",\r\n//   backgroundColor: \"purple\",\r\n//   color: \"white\",\r\n//   display: \"flex\",\r\n//   alignItems: \"center\",\r\n//   justifyContent: \"center\",\r\n//   margin: \"auto\"\r\n// };\r\n\r\n// https://codesandbox.io/s/tq8r3?file=/src/components/coupon.css:969-2051\r\nexport default function CustomContextMenu(props) {\r\n  const icons = [<PrimitiveIcon />, <BooleanIcon />, <TransformIcon />, <DeformIcon />];\r\n\r\n  return (\r\n\r\n    <ContextMenu id=\"contextmenu\">\r\n      {Object.keys(NodeTypes).map((type, index) =>\r\n        <MenuItem key={index} onClick={()=>props.newNode(Object.values(NodeTypes)[index],0,0)}>\r\n          {icons[index]}\r\n          <Typography align=\"left\" style={{marginLeft: \"10px\"}} variant=\"body1\" color=\"text.primary\">\r\n            {type}\r\n          </Typography>\r\n          <Typography  align=\"right\" style={{marginLeft: \"10px\"}} variant=\"body2\" color=\"text.secondary\">\r\n            {type[0].toUpperCase()}\r\n          </Typography>\r\n        </MenuItem>\r\n      )}\r\n    </ContextMenu>\r\n\r\n  );\r\n\r\n  // const handleContextMenu = useCallback(\r\n  //     (event) => {\r\n  //         event.preventDefault();\r\n  //         setAnchorPoint({ x: event.pageX, y: event.pageY });\r\n  //         setShow(true);\r\n  //         console.log(\"ANCHOR: \" + event.pageX);\r\n  //     },\r\n  //     [setAnchorPoint]\r\n  // );\r\n\r\n  // const handleClick = useCallback(() => (show ? setShow(false) : null), [show]);\r\n\r\n  // useEffect(() => {\r\n  //     document.addEventListener(\"click\", handleClick);\r\n  //     document.addEventListener(\"contextmenu\", handleContextMenu);\r\n  //     return () => {\r\n  //         document.removeEventListener(\"click\", handleClick);\r\n  //         document.removeEventListener(\"contextmenu\", handleContextMenu);\r\n  //     };\r\n  // }, [show]);\r\n\r\n\r\n  // return (\r\n  //     <div style={{\r\n  //         top: `${anchorPoint.y}px`,\r\n  //         left: `${anchorPoint.x}px`\r\n  //       }}>\r\n  //         {show ? <Paper sx = {{ width: 200, maxWidth: '100%' }} >\r\n  //         <MenuList>\r\n  //         {Object.values(NodeTypes).map((type, index) =>\r\n  //             <MenuItem onClick={() => console.log(\"asasas\")}>\r\n  //                 <ListItemIcon>{icons[index]}</ListItemIcon>\r\n  //                 <ListItemText>{type} </ListItemText>\r\n  //                 <Typography variant=\"body2\" color=\"text.secondary\">\r\n  //                     {type[0].toUpperCase()}\r\n  //                 </Typography>\r\n  //             </MenuItem>)\r\n  //         }\r\n  //     </MenuList>\r\n  //     </Paper > \r\n  //     : null}\r\n  //     </div>\r\n\r\n  // );\r\n}\r\n","import React, { useState, memo } from 'react';\r\nimport { useEffect, useRef } from 'react';\r\nimport ReactFlow, {\r\n  addEdge,\r\n  Background,\r\n  useNodesState,\r\n  useEdgesState,\r\n  MarkerType,\r\n} from 'react-flow-renderer';\r\nimport PrimitiveNode from '../CustomNodes/PrimitiveNode.js';\r\nimport BooleanNode from '../CustomNodes/BooleanNode.js';\r\nimport DeformNode from '../CustomNodes/DeformNode.js';\r\nimport TransformNode from '../CustomNodes/TransformNode.js';\r\n\r\nimport ButtonEdge from '../CustomNodes/ButtonEdge';\r\nimport CustomControls from '../CustomComponents/CustomControls.js';\r\nimport '../styles.css';\r\nimport { GraphProvider } from './GraphContext.js';\r\nimport CustomContextMenu from '../CustomComponents/CustomContextMenu.js';\r\nimport useLocalStorage from '../storageHook.js';\r\n\r\nimport { ContextMenuTrigger } from 'react-contextmenu';\r\n\r\n\r\nconst flowKey = 'savedGraph';\r\nconst graphNodeTypes = { primitiveNode: PrimitiveNode, booleanNode: BooleanNode, deformNode: DeformNode, transformNode: TransformNode };\r\nconst edgeTypes = { buttonEdge: ButtonEdge };\r\n\r\nconst initialNodes = [\r\n  {\r\n    id: 'prim-0',\r\n    type: 'primitiveNode',\r\n    position: { x: -50, y: -350 },\r\n    dragHandle: ' .nodeHeader',\r\n    data: { default: 'Cube', inputs: {}, sdf: '', children: [] },\r\n  },\r\n  {\r\n    id: 'prim-1',\r\n    type: 'primitiveNode',\r\n    dragHandle: '.nodeHeader',\r\n    position: { x: -50, y: 125 },\r\n    data: { inputs: {}, sdf: '', children: [] },\r\n  },\r\n  {\r\n    id: 'prim-2',\r\n    type: 'primitiveNode',\r\n    position: { x: -50, y: 600 },\r\n    dragHandle: '.nodeHeader',\r\n    data: { inputs: {}, sdf: '', children: [] },\r\n  },\r\n  {\r\n    id: 'deform-0',\r\n    type: 'deformNode',\r\n    dragHandle: '.nodeHeader',\r\n    position: { x: 200, y: -125 },\r\n    data: { inputs: {}, sdf: '', children: [] },\r\n  },\r\n  {\r\n    id: 'transform-0',\r\n    type: 'transformNode',\r\n    dragHandle: '.nodeHeader',\r\n    position: { x: 450, y: 150 },\r\n    data: { inputs: {}, sdf: '', children: [] },\r\n  },\r\n  {\r\n    id: 'bool-2',\r\n    type: 'booleanNode',\r\n    dragHandle: '.nodeHeader',\r\n    position: { x: 200, y: 375 },\r\n    data: { inputs: {}, sdf: '', children: [] },\r\n  },\r\n];\r\n\r\nfunction Graph() {\r\n  const [nodes, setNodes, onNodesChange] = useNodesState(initialNodes);\r\n  const [edges, setEdges, onEdgesChange] = useEdgesState([]);\r\n  const [rfInstance, setRfInstance] = useState(null);\r\n  const [id, setId] = React.useState(3);\r\n  const [mouseCoor, setMouseCoor] = useState([0, 0]);\r\n  const [storage] = useLocalStorage(\"user_implicits\", {});\r\n  const reactFlowRef = useRef(null);\r\n\r\n  const updateNodeSdf = (id, newSdf) => {\r\n    console.log('ACTUALIZADONDO SDF DE ' + id);\r\n\r\n    var nodesCopy = [...nodes];\r\n    var parent = nodesCopy.find((node) => node.id === id);\r\n    parent.data = {\r\n      ...parent.data,\r\n      sdf: newSdf,\r\n    };\r\n\r\n    for (var child of parent.data.children) {\r\n      for (var node of nodesCopy) {\r\n        if (node.id === child) {\r\n          var newInputs = node.data.inputs;\r\n          newInputs[`${id}`] = newSdf;\r\n\r\n          node.data = {\r\n            ...node.data,\r\n            inputs: newInputs,\r\n          };\r\n        }\r\n      }\r\n    }\r\n\r\n    setNodes(nodesCopy);\r\n  };\r\n\r\n  const removeChild = (parent, child) => {\r\n    setNodes((nds) =>\r\n      nds.map((node) => {\r\n        if (node.id === parent) {\r\n          console.log(`ELIMINANDO HIJO ${child} DE ${parent}`);\r\n\r\n          var newChildren = node.data.children;\r\n          newChildren = newChildren.filter(function (c) {\r\n            return c.id !== child;\r\n          });\r\n\r\n          node.data = {\r\n            ...node.data,\r\n            children: newChildren,\r\n          };\r\n        }\r\n        if (node.id === child) {\r\n          console.log(`ACTUALIZANDO ${child}`);\r\n          var newInputs = node.data.inputs;\r\n          newInputs[`${parent}`] = '';\r\n          node.data = {\r\n            ...node.data,\r\n            inputs: newInputs,\r\n          };\r\n        }\r\n\r\n        onNodesChange([node]);\r\n        return node;\r\n      })\r\n    );\r\n  };\r\n\r\n  const removeEdge = (edgeId) => {\r\n    console.log('WDGES: ');\r\n    console.log(edges);\r\n    const edge = edges.find((e) => e.id === edgeId);\r\n\r\n    var newEdges = edges.filter((edge) => {\r\n      console.log(edge.source);\r\n      return edge.id !== edgeId;\r\n    });\r\n\r\n    setEdges(newEdges);\r\n    removeChild(edge.source, edge.target);\r\n  };\r\n\r\n  const sharedFunctions = {\r\n    updateNodeSdf,\r\n    removeEdge,\r\n  };\r\n\r\n  const onConnect = (params) => {\r\n    const sourceNode = nodes.find((n) => n.id === params.source);\r\n\r\n    // CREAMOS EDGE\r\n    setEdges((eds) =>\r\n      addEdge(\r\n        {\r\n          ...params,\r\n          type: 'buttonEdge',\r\n          animated: true,\r\n          markerEnd: { type: MarkerType.Arrow, color: '#000' },\r\n        },\r\n        eds\r\n      )\r\n    );\r\n\r\n    // AÑADIMOS HIJO AL PADRE\r\n    var newChildren = sourceNode.data.children;\r\n    newChildren.push(params.target);\r\n\r\n    setNodes((nds) =>\r\n      nds.map((node) => {\r\n        if (node.id === params.source) {\r\n          console.log(`AÑADIENDO HIJO ${params.target} A ${params.source}`);\r\n\r\n          // var newChildren = node.data.children;\r\n          // console.log(typeof newChildren);\r\n          // console.log(newChildren);\r\n          // newChildren.push(params.target);\r\n          console.log(newChildren);\r\n          node.data = {\r\n            ...node.data,\r\n            children: newChildren,\r\n          };\r\n        }\r\n        if (node.id === params.target) {\r\n          console.log(`INICIALIZANDO ${params.source}`);\r\n          var newInputs = node.data.inputs;\r\n          newInputs[`${params.source}`] = sourceNode.data.sdf;\r\n          node.data = {\r\n            ...node.data,\r\n            inputs: newInputs,\r\n          };\r\n        }\r\n\r\n        onNodesChange([node]);\r\n        return node;\r\n      })\r\n    );\r\n\r\n    // INICIAMOS HIJO\r\n  };\r\n\r\n  // useEffect(() => {\r\n  //   console.log('NODOS ACTUALIZADOS');\r\n  //   console.log(nodes);\r\n  // }, [nodes]);\r\n\r\n  useEffect(() => {\r\n    console.log('NUEVO EDGE:');\r\n    console.log(edges);\r\n  }, [edges]);\r\n\r\n  const onSave = () => {\r\n    if (rfInstance) {\r\n      const flow = rfInstance.toObject();\r\n      console.log('FLOW SAVED:');\r\n      console.log(flow);\r\n      localStorage.setItem(flowKey, JSON.stringify(flow));\r\n    }\r\n  };\r\n\r\n  const onLoad = async () => {\r\n    const flow = JSON.parse(localStorage.getItem(flowKey));\r\n\r\n    if (flow) {\r\n      console.log('FLOW LOADED:');\r\n      console.log(flow);\r\n\r\n      setNodes(flow.nodes || []);\r\n      setEdges(flow.edges || []);\r\n    }\r\n  };\r\n\r\n  const newNode = (nodeType, xPos = 0, yPos = 0) => {\r\n    console.log('CREANDO ' + nodeType);\r\n    setId(id + 1);\r\n    const nodeId = `node-${id}`;\r\n    return {\r\n      id: nodeId,\r\n      type: nodeType,\r\n      dragHandle: '.nodeHeader',\r\n      position: { x: xPos, y: yPos },\r\n      data: {\r\n        inputs: {},\r\n        sdf: '',\r\n        children: [],\r\n      },\r\n    };\r\n  };\r\n\r\n  const createAddNodeMousePos = (nodeType) => {\r\n    const { x, y } = rfInstance.project({ x: mouseCoor[0], y: mouseCoor[1] });\r\n    let node = newNode(nodeType, x, y);\r\n    nodes.push(node);\r\n    onNodesChange([node]);\r\n  };\r\n\r\n  const handleKey = (e) => {\r\n    let node = null;\r\n\r\n    const { x, y } = rfInstance.project({ x: mouseCoor[0], y: mouseCoor[1] });\r\n\r\n\r\n    if (e.key.toLowerCase() === 'p') node = newNode('primitiveNode', x, y);\r\n    else if (e.key.toLowerCase() === 'b') node = newNode('booleanNode', x, y);\r\n    else if (e.key.toLowerCase() === 'd') node = newNode('deformNode', x, y);\r\n    else if (e.key.toLowerCase() === 't') node = newNode('transformNode', x, y);\r\n\r\n    if (node) {\r\n      nodes.push(node);\r\n      onNodesChange([node]); // Para actualizar\r\n    }\r\n\r\n  };\r\n\r\n  const handleMouse = (e) => {\r\n    const bounds = reactFlowRef.current.getBoundingClientRect();\r\n    setMouseCoor([e.clientX - bounds.left, e.clientY - bounds.top]);\r\n  };\r\n\r\n  return (\r\n    <>\r\n      {JSON.stringify(storage)}\r\n      <ContextMenuTrigger id='contextmenu'>\r\n        <div style={{ height: '100vh' }} tabIndex='0' onKeyDown={handleKey} onMouseMove={handleMouse}>\r\n          <GraphProvider value={sharedFunctions}>\r\n            <ReactFlow\r\n              ref={reactFlowRef}\r\n              nodes={nodes}\r\n              edges={edges}\r\n              onNodesChange={onNodesChange}\r\n              onEdgesChange={onEdgesChange}\r\n              onConnect={onConnect}\r\n              // onDisconnect={onDisconnect}\r\n\r\n              nodeTypes={graphNodeTypes}\r\n              edgeTypes={edgeTypes}\r\n              onInit={setRfInstance}\r\n              // onEdgeClick={(ev, edge) =>\r\n              //   setEdges(edges.filter((e) => e.id != edge.id))\r\n              // }\r\n              snapToGrid={false}\r\n              fitView\r\n            >\r\n              <Background variant='lines' color='#aaa' gap={10} />\r\n              <CustomControls save={onSave} load={onLoad} />\r\n            </ReactFlow>\r\n          </GraphProvider>\r\n        </div>\r\n      </ContextMenuTrigger>\r\n      <CustomContextMenu newNode={createAddNodeMousePos} />\r\n    </>\r\n  );\r\n}\r\n\r\nexport default memo(Graph);\r\n","import React, {useContext} from 'react';\r\nimport { getBezierPath, getEdgeCenter } from 'react-flow-renderer';\r\nimport GraphContext from \"../GraphPage/GraphContext\";\r\n\r\nimport '../styles.css';\r\n\r\nconst foreignObjectSize = 40;\r\n\r\nexport default function CustomEdge({\r\n  id,\r\n  sourceX,\r\n  sourceY,\r\n  targetX,\r\n  targetY,\r\n  sourcePosition,\r\n  targetPosition,\r\n  style = {},\r\n  data,\r\n}) {\r\n  const edgePath = getBezierPath({\r\n    sourceX,\r\n    sourceY,\r\n    sourcePosition,\r\n    targetX,\r\n    targetY,\r\n    targetPosition,\r\n  });\r\n  const [edgeCenterX, edgeCenterY] = getEdgeCenter({\r\n    sourceX,\r\n    sourceY,\r\n    targetX,\r\n    targetY,\r\n  });\r\n\r\n  const sharedFunctions = useContext(GraphContext);\r\n\r\n  return (\r\n    <>\r\n      <path\r\n        id={id}\r\n        style={style}\r\n        className=\"react-flow__edge-path\"\r\n        d={edgePath}\r\n        \r\n      />\r\n      <foreignObject\r\n        width={foreignObjectSize}\r\n        height={foreignObjectSize}\r\n        x={edgeCenterX - foreignObjectSize / 2}\r\n        y={edgeCenterY - foreignObjectSize / 2}\r\n        \r\n        className=\"edgebutton-foreignobject\"\r\n        requiredExtensions=\"http://www.w3.org/1999/xhtml\"\r\n      >\r\n        {true ?\r\n          <body>\r\n            <button className=\"edgebutton\" onClick={() => {console.log(\"SI: \" + id); sharedFunctions.removeEdge(id)}}>\r\n              ×\r\n            </button>\r\n          </body> \r\n          : \r\n          null\r\n        }\r\n      </foreignObject>\r\n    </>\r\n  );\r\n}\r\n","import * as React from 'react';\r\nimport Box from '@mui/material/Box';\r\nimport Card from '@mui/material/Card';\r\nimport CardActions from '@mui/material/CardActions';\r\nimport CardContent from '@mui/material/CardContent';\r\nimport Button from '@mui/material/Button';\r\nimport Typography from '@mui/material/Typography';\r\n\r\n\r\nexport default function MaterialCard(props) {\r\n  return (\r\n    <Box sx={{ minWidth: 100 }}>\r\n      <Card elevation={10} >\r\n      <CardContent>\r\n      <Typography variant=\"h5\" component=\"div\">\r\n        {props.name} ? {props.name} ; Unknown\r\n      </Typography>\r\n      <Typography sx={{ mb: 1.5 }} color=\"text.secondary\">\r\n        adjective\r\n      </Typography>\r\n      <Typography variant=\"body2\">\r\n        well meaning and kindly.\r\n        <br />\r\n        {'\"a benevolent smile\"'}\r\n      </Typography>\r\n    </CardContent>\r\n    <CardActions>\r\n      <Button size=\"small\">Learn More</Button>\r\n    </CardActions>\r\n      </Card>\r\n    </Box>\r\n  );\r\n}\r\n","import React from \"react\";\r\nimport MaterialCard from \"./MaterialCard\";\r\nimport Grid from '@mui/material/Grid';\r\n\r\nexport default function MaterialsPage() {\r\n  return <Grid\r\n    container\r\n    direction=\"row\"\r\n    justifyContent=\"flex-start\"\r\n    alignItems=\"flex-start\"\r\n    spacing={2}\r\n    >\r\n\r\n    <Grid item><MaterialCard/></Grid>\r\n    <Grid item><MaterialCard/></Grid>\r\n    <Grid item><MaterialCard/></Grid>\r\n    <Grid item><MaterialCard/></Grid>\r\n    <Grid item><MaterialCard/></Grid>\r\n    <Grid item><MaterialCard/></Grid>\r\n    <Grid item><MaterialCard/></Grid>\r\n</Grid>;\r\n}\r\n","import * as React from 'react';\r\nimport Table from '@mui/material/Table';\r\nimport TableBody from '@mui/material/TableBody';\r\nimport TableCell, { tableCellClasses } from '@mui/material/TableCell';\r\nimport TableContainer from '@mui/material/TableContainer';\r\nimport TableHead from '@mui/material/TableHead';\r\nimport TablePagination from '@mui/material/TablePagination';\r\nimport TableRow from '@mui/material/TableRow';\r\nimport Toolbar from '@mui/material/Toolbar';\r\nimport Typography from '@mui/material/Typography';\r\nimport Paper from '@mui/material/Paper';\r\nimport Checkbox from '@mui/material/Checkbox';\r\nimport IconButton from '@mui/material/IconButton';\r\nimport Tooltip from '@mui/material/Tooltip';\r\nimport DeleteIcon from '@mui/icons-material/Delete';\r\nimport AddIcon from '@mui/icons-material/Add';\r\nimport { alpha } from '@mui/material/styles';\r\nimport TableSortLabel from '@mui/material/TableSortLabel';\r\nimport { styled } from '@mui/material/styles';\r\n\r\nconst StyledTableCell = styled(TableCell)(({ theme }) => ({\r\n  [`&.${tableCellClasses.head}`]: {\r\n    backgroundColor: \"#222222\",\r\n    color: theme.palette.common.white,\r\n  },\r\n  [`&.${tableCellClasses.body}`]: {\r\n    fontSize: 14,\r\n  },\r\n}));\r\n\r\nconst StyledTableRow = styled(TableRow)(({ theme }) => ({\r\n  '&:nth-of-type(odd)': {\r\n    backgroundColor: theme.palette.action.hover,\r\n  },\r\n  // hide last border\r\n  '&:last-child td, &:last-child th': {\r\n    border: 0,\r\n  },\r\n}));\r\n\r\nfunction descendingComparator(a, b, orderBy) {\r\n  if (b[orderBy] < a[orderBy]) {\r\n    return -1;\r\n  }\r\n  if (b[orderBy] > a[orderBy]) {\r\n    return 1;\r\n  }\r\n  return 0;\r\n}\r\n\r\nfunction getComparator(order, orderBy) {\r\n  return order === 'desc'\r\n    ? (a, b) => descendingComparator(a, b, orderBy)\r\n    : (a, b) => -descendingComparator(a, b, orderBy);\r\n}\r\n\r\nfunction EnhancedTableHead(props) {\r\n  const {\r\n    onSelectAllClick,\r\n    order,\r\n    orderBy,\r\n    numSelected,\r\n    rowCount,\r\n    onRequestSort,\r\n  } = props;\r\n  const createSortHandler = (property) => (event) => {\r\n    onRequestSort(event, property);\r\n  };\r\n\r\n  return (\r\n    <TableHead>\r\n      <StyledTableRow>\r\n        <StyledTableCell padding=\"checkbox\">\r\n          <Checkbox\r\n            color=\"primary\"\r\n            indeterminate={numSelected > 0 && numSelected < rowCount}\r\n            checked={rowCount > 0 && numSelected === rowCount}\r\n            onChange={onSelectAllClick}\r\n            inputProps={{\r\n              'aria-label': 'select all desserts',\r\n            }}\r\n          />\r\n        </StyledTableCell>\r\n        {props.columns.map((headCell) => (\r\n          <StyledTableCell\r\n            sx={{ minWidth: headCell.minWidth }}\r\n            key={headCell.id}\r\n            align={headCell.numeric ? 'right' : 'left'}\r\n            padding={headCell.disablePadding ? 'none' : 'normal'}\r\n            sortDirection={orderBy === headCell.id ? order : false}\r\n          >\r\n            <TableSortLabel\r\n              active={orderBy === headCell.id}\r\n              direction={orderBy === headCell.id ? order : 'asc'}\r\n              onClick={createSortHandler(headCell.id)}\r\n            >\r\n              <Typography variant=\"subtitle1\">{headCell.label}</Typography>\r\n\r\n            </TableSortLabel>\r\n          </StyledTableCell>\r\n        ))}\r\n      </StyledTableRow>\r\n    </TableHead>\r\n  );\r\n}\r\n\r\nconst EnhancedTableToolbar = (props) => {\r\n  const { numSelected } = props;\r\n\r\n  return (\r\n    <Toolbar\r\n      style={{ background: '#222222' }}\r\n      sx={{\r\n        pl: { sm: 2 },\r\n        pr: { xs: 1, sm: 1 },\r\n        ...(numSelected > 0 && {\r\n          bgcolor: (theme) =>\r\n            alpha(\r\n              theme.palette.primary.main,\r\n              theme.palette.action.activatedOpacity\r\n            ),\r\n        }),\r\n      }}\r\n    >\r\n      {numSelected > 0 ? (\r\n        <Typography\r\n          sx={{ flex: '1 1 100%' }}\r\n          color=\"white\"\r\n          variant=\"subtitle1\"\r\n          component=\"div\"\r\n        >\r\n          {numSelected} selected\r\n        </Typography>\r\n      ) : (\r\n        <Typography\r\n          color=\"white\"\r\n          sx={{ flex: '1 1 100%' }}\r\n          variant=\"h6\"\r\n          id=\"tableTitle\"\r\n          component=\"div\"\r\n        >\r\n          Surfaces\r\n        </Typography>\r\n      )}\r\n\r\n      {numSelected > 0 ? (\r\n        <Tooltip title=\"Delete\">\r\n          <IconButton onClick={props.handleDelete}>\r\n            <DeleteIcon sx={{ color: \"white\" }} />\r\n          </IconButton>\r\n        </Tooltip>\r\n      ) : (\r\n        <Tooltip title=\"New Surface\">\r\n          <IconButton onClick={props.handleCreateRow}>\r\n            <AddIcon sx={{ color: \"white\" }} />\r\n          </IconButton>\r\n        </Tooltip>\r\n      )}\r\n    </Toolbar>\r\n  );\r\n};\r\n\r\nexport default function CustomTable(props) {\r\n  const [page, setPage] = React.useState(0);\r\n  const [rowsPerPage, setRowsPerPage] = React.useState(10);\r\n  const [selected, setSelected] = React.useState([]);\r\n\r\n  const [order, setOrder] = React.useState('asc');\r\n  const [orderBy, setOrderBy] = React.useState('calories');\r\n\r\n  const handleRequestSort = (event, property) => {\r\n    const isAsc = orderBy === property && order === 'asc';\r\n    setOrder(isAsc ? 'desc' : 'asc');\r\n    setOrderBy(property);\r\n  };\r\n\r\n  const handleSelectAllClick = (event) => {\r\n    if (event.target.checked) {\r\n      const newSelected = props.rows.map((n) => n.id);\r\n      setSelected(newSelected);\r\n      return;\r\n    }\r\n    setSelected([]);\r\n  };\r\n\r\n  const handleClick = (event, id) => {\r\n    const selectedIndex = selected.indexOf(id);\r\n    let newSelected = [];\r\n\r\n    if (selectedIndex === -1) {\r\n      newSelected = newSelected.concat(selected, id);\r\n    } else if (selectedIndex === 0) {\r\n      newSelected = newSelected.concat(selected.slice(1));\r\n    } else if (selectedIndex === selected.length - 1) {\r\n      newSelected = newSelected.concat(selected.slice(0, -1));\r\n    } else if (selectedIndex > 0) {\r\n      newSelected = newSelected.concat(\r\n        selected.slice(0, selectedIndex),\r\n        selected.slice(selectedIndex + 1)\r\n      );\r\n    }\r\n\r\n    setSelected(newSelected);\r\n  };\r\n\r\n  const handleDelete = (selectedList) => {\r\n    props.handleDelete(selectedList);\r\n    setSelected([]);\r\n  };\r\n  const isSelected = (name) => selected.indexOf(name) !== -1;\r\n\r\n  const handleChangePage = (event, newPage) => {\r\n    setPage(newPage);\r\n  };\r\n\r\n  const handleChangeRowsPerPage = (event) => {\r\n    setRowsPerPage(+event.target.value);\r\n    setPage(0);\r\n  };\r\n\r\n  return (\r\n    <Paper sx={{ width: '100%', overflow: 'hidden' }}>\r\n      <EnhancedTableToolbar\r\n        numSelected={selected.length}\r\n        handleDelete={() => handleDelete(selected)}\r\n        handleCreateRow={props.handleCreateRow}\r\n      />\r\n      <TableContainer sx={{ maxHeight: 440 }}>\r\n        <Table stickyHeader aria-label=\"sticky table\">\r\n          <EnhancedTableHead\r\n            columns={props.columns}\r\n            numSelected={selected.length}\r\n            order={order}\r\n            orderBy={orderBy}\r\n            onSelectAllClick={handleSelectAllClick}\r\n            onRequestSort={handleRequestSort}\r\n            rowCount={props.rows.length}\r\n          />\r\n          <TableBody>\r\n            {props.rows\r\n              .slice()\r\n              .sort(getComparator(order, orderBy))\r\n              .slice(page * rowsPerPage, page * rowsPerPage + rowsPerPage)\r\n              .map((row, index) => {\r\n                return (\r\n                  <StyledTableRow\r\n                    hover\r\n\r\n                    tabIndex={-1}\r\n                    key={row.id}\r\n                  >\r\n                    <StyledTableCell padding=\"checkbox\">\r\n                      <Checkbox\r\n                        onClick={(event) => handleClick(event, row.id)}\r\n                        color=\"primary\"\r\n                        checked={isSelected(row.id)}\r\n                        inputProps={{\r\n                          'aria-labelledby': { index },\r\n                        }}\r\n                      />\r\n                    </StyledTableCell>\r\n                    {props.columns.map((column) => {\r\n                      const value = row[column.id];\r\n                      return (\r\n                        <StyledTableCell onClick={(event) => props.handleRowClick(row.id)} key={column.id} align={column.align}>\r\n                          {value}\r\n                        </StyledTableCell>\r\n                      );\r\n                    })}\r\n                  </StyledTableRow>\r\n                );\r\n              })}\r\n          </TableBody>\r\n        </Table>\r\n      </TableContainer>\r\n      <TablePagination\r\n        rowsPerPageOptions={[10, 25, 100]}\r\n        component=\"div\"\r\n        count={props.rows.length}\r\n        rowsPerPage={rowsPerPage}\r\n        page={page}\r\n        onPageChange={handleChangePage}\r\n        onRowsPerPageChange={handleChangeRowsPerPage}\r\n      />\r\n    </Paper>\r\n  );\r\n}\r\n","import React, { useState, useEffect } from 'react';\r\nimport Table from '@mui/material/Table';\r\nimport TableBody from '@mui/material/TableBody';\r\nimport TableCell, { tableCellClasses } from '@mui/material/TableCell';\r\nimport TableContainer from '@mui/material/TableContainer';\r\nimport TableHead from '@mui/material/TableHead';\r\nimport TableRow from '@mui/material/TableRow';\r\nimport Typography from '@mui/material/Typography';\r\nimport Paper from '@mui/material/Paper';\r\nimport { styled } from '@mui/material/styles';\r\nimport TextField from '@mui/material/TextField';\r\nimport Button from '@mui/material/Button';\r\nimport IconButton from '@mui/material/IconButton';\r\nimport DeleteIcon from '@mui/icons-material/Delete';\r\n\r\nconst StyledTableCell = styled(TableCell)(({ theme }) => ({\r\n  [`&.${tableCellClasses.head}`]: {\r\n    backgroundColor: '#DDDDDD',\r\n    color: 'black',\r\n  },\r\n  [`&.${tableCellClasses.body}`]: {\r\n    fontSize: 14,\r\n  },\r\n}));\r\n\r\nconst StyledTableRow = styled(TableRow)(({ theme }) => ({\r\n  '&:nth-of-type(odd)': {\r\n    backgroundColor: theme.palette.action.hover,\r\n  },\r\n  // hide last border\r\n  '&:last-child td, &:last-child th': {\r\n    border: 0,\r\n  },\r\n}));\r\n\r\nconst columns = [\r\n  { id: 'symbol', label: 'Symbol', minWidth: 70 },\r\n  { id: 'label', label: 'Label', minWidth: 70 },\r\n  { id: 'defaultVal', label: 'Default Value', minWidth: 70 },\r\n];\r\n\r\nfunction EnhancedTableHead(props) {\r\n  return (\r\n    <TableHead>\r\n      \r\n      <StyledTableRow>\r\n      <StyledTableCell/>\r\n        {props.columns.map((headCell) => (\r\n          <StyledTableCell\r\n            sx={{ minWidth: headCell.minWidth }}\r\n            key={headCell.id}\r\n            align={headCell.numeric ? 'right' : 'left'}\r\n          >\r\n            <Typography variant=\"subtitle1\">\r\n              <b>{headCell.label}</b>\r\n            </Typography>\r\n          </StyledTableCell>\r\n        ))}\r\n      </StyledTableRow>\r\n    </TableHead>\r\n  );\r\n}\r\n\r\nfunction createParameter(symbol = '', label = '', defaultVal = '') {\r\n  return {\r\n    symbol: symbol,\r\n    label: label,\r\n    defaultVal: defaultVal,\r\n  };\r\n}\r\n\r\nexport default function CustomInputTable(props) {\r\n  const [rows, setRows] = useState(props.rows);\r\n\r\n  useEffect(() => {\r\n    console.log(rows);\r\n  }, [rows]);\r\n\r\n  const handleRowChange = (row, column, value) => {\r\n    let newRows = [...rows];\r\n    console.log(\"HANDLEANDO: \" + column);\r\n    newRows[row][column] = column==='defaultVal' ? parseFloat(value,10) : value;\r\n\r\n    // TODO: check if valid\r\n\r\n    setRows(newRows);\r\n    props.handleNewParameters(rows);\r\n  };\r\n\r\n  const handleAdd = () => {\r\n    setRows(rows.concat(createParameter()));\r\n  };\r\n\r\n  const handleDelete = (index) => {\r\n    setRows([\r\n      ...rows.slice(0, index)]);\r\n  }\r\n\r\n  return (\r\n    <Paper sx={{ width: '100%', overflow: 'hidden' }}>\r\n      <TableContainer\r\n        style={{ border: '1px solid grey' }}\r\n        sx={{ maxHeight: 440 }}\r\n      >\r\n        <Table stickyHeader size=\"small\" aria-label=\"sticky table\">\r\n          <EnhancedTableHead columns={columns} />\r\n          <TableBody>\r\n            {rows.map((row, index) => {\r\n              return (\r\n                <StyledTableRow hover tabIndex={-1} key={row.id}>\r\n                  <StyledTableCell padding=\"checkbox\">\r\n                  <IconButton onClick={()=>handleDelete(index)} aria-label=\"delete\">\r\n                <DeleteIcon />\r\n              </IconButton>\r\n                  </StyledTableCell>\r\n\r\n                  {columns.map((column) => {\r\n                    const value = row[column.id];\r\n                    return (\r\n                      <StyledTableCell key={column.id} align={column.align}>\r\n                        <TextField\r\n                          defaultValue={value}\r\n                          id=\"standard-basic\"\r\n                          variant=\"standard\"\r\n                          error={value === ''}\r\n                          onChange={(e) =>\r\n                            handleRowChange(index, column.id, e.target.value)\r\n                          }\r\n                        />\r\n                      </StyledTableCell>\r\n                    );\r\n                  })}\r\n                </StyledTableRow>\r\n              );\r\n            })}\r\n          </TableBody>\r\n        </Table>\r\n        <Button onClick={handleAdd} style={{ width: '100%' }}>\r\n          +\r\n        </Button>\r\n      </TableContainer>\r\n    </Paper>\r\n  );\r\n}\r\n","import React, { useState, useEffect } from 'react';\r\nimport Grid from '@mui/material/Grid';\r\nimport InputAdornment from '@mui/material/InputAdornment';\r\n\r\nimport TextField from '@mui/material/TextField';\r\nimport Dialog from '@mui/material/Dialog';\r\nimport DialogActions from '@mui/material/DialogActions';\r\nimport DialogContent from '@mui/material/DialogContent';\r\nimport DialogTitle from '@mui/material/DialogTitle';\r\nimport Button from '@mui/material/Button';\r\nimport MathJax from 'react-mathjax';\r\nimport 'katex/dist/katex.min.css';\r\nimport useLocalStorage from '../storageHook.js';\r\nimport Shader from '../CustomComponents/Shader';\r\nimport CustomInputTable from '../CustomComponents/CustomInputTable';\r\n\r\nexport default function SurfaceDialog(props) {\r\n  var nerdamer = require('nerdamer');\r\n  require('nerdamer/Calculus');\r\n\r\n  const [eqData, setEqData] = useState(props.eqData ? props.eqData : null);\r\n  const [eqInput, setEqInput] = useState('');\r\n  const [nameInput, setNameInput] = useState('');\r\n  const [parametersInput, setParametersInput] = useState([]);\r\n  const [storage, setStorage] = useLocalStorage('user_implicits', {});\r\n  const [errorMsg, setErrorMsg] = useState('');\r\n  const [validEq, setValEq] = useState(false);\r\n  const [validName, setValidName] = useState(false);\r\n\r\n  const latexInfo = () => {\r\n    const implicit =\r\n      eqData && validEq ? nerdamer.convertToLaTeX(eqData.f.toString()) : '';\r\n    const dx =\r\n      eqData && validEq ? nerdamer.convertToLaTeX(eqData.dx.toString()) : '';\r\n    const dy =\r\n      eqData && validEq ? nerdamer.convertToLaTeX(eqData.dy.toString()) : '';\r\n    const dz =\r\n      eqData && validEq ? nerdamer.convertToLaTeX(eqData.dz.toString()) : '';\r\n    const norm =\r\n      eqData && validEq ? nerdamer.convertToLaTeX(eqData.norm.toString()) : '';\r\n    const sdf =\r\n      eqData && validEq ? nerdamer.convertToLaTeX(eqData.sdf.toString()) : '';\r\n\r\n    return `\\\\begin{align*} \r\n          f(x,y,z) &=  ${implicit} \\\\\\\\[10pt]\r\n          \\\\nabla f(x,y,z) &= \\\\left( \r\n            ${dx}, \r\n            ${dy}, \r\n            ${dz}\r\n          \\\\right) \\\\\\\\[10pt]\r\n          \\\\Vert \\\\nabla f(x,y,z) \\\\Vert &= ${norm} \\\\\\\\[10pt]\r\n          \\\\text{sdf}(x,y,z) &= ${sdf}\r\n        \\\\end{align*}`;\r\n  };\r\n\r\n  const traverseTree = (node) => {\r\n    const parametersSymbols = Object.keys(parametersInput).map((val, key) => parametersInput[key].symbol);\r\n\r\n    if (node) {\r\n      if (node.type === 'VARIABLE_OR_LITERAL') {\r\n        const isVariable = [...parametersSymbols, 'x', 'y', 'z'].includes(node.value);\r\n\r\n        return isVariable ? node.value : parseFloat(node.value).toFixed(4);\r\n      }\r\n      if (node.type === 'OPERATOR') {\r\n        let left = traverseTree(node.left);\r\n        let right = traverseTree(node.right);\r\n\r\n        if (node.value === '^') {\r\n          return `pow(${left}, ${right})`;\r\n        } else {\r\n          if (right && left) return `(${left})${node.value}(${right})`;\r\n          else if (left) return `${node.value}(${left})`;\r\n          else return '????';\r\n        }\r\n\r\n        // return node.toString();\r\n      }\r\n      if (node.type === 'FUNCTION') {\r\n        let left = traverseTree(node.left);\r\n        let right = traverseTree(node.right);\r\n\r\n        if (node.value === '^') {\r\n          return `pow(${left}, ${right})`;\r\n        } else {\r\n          if (right) return `${node.value}(${right})`;\r\n          else return '????';\r\n        }\r\n      }\r\n    }\r\n  };\r\n\r\n  const handleNewEquation = (newEq) => {\r\n    let f = null;\r\n    setEqInput(newEq);\r\n\r\n    try {\r\n      f = nerdamer(newEq);\r\n    } catch (error) {\r\n      setErrorMsg(error.message);\r\n      setValEq(false);\r\n\r\n      console.warn('ERROR PARSING EQUATION');\r\n      console.log(error);\r\n\r\n      return;\r\n    }\r\n\r\n    setErrorMsg('');\r\n    setValEq(true);\r\n\r\n    let dfdx = nerdamer.diff(f, 'x', 1);\r\n    let dfdy = nerdamer.diff(f, 'y', 1);\r\n    let dfdz = nerdamer.diff(f, 'z', 1);\r\n    let norm = nerdamer(`sqrt((${dfdx})^2 + (${dfdy})^2 + (${dfdz})^2)`);\r\n\r\n    if (norm.toString() === '0') {\r\n      setValEq(false);\r\n      setErrorMsg(\"Norm can't be 0\");\r\n      return;\r\n    }\r\n\r\n    let sdf = nerdamer(`(${f})/(${norm})`);\r\n    var x = nerdamer.tree(sdf.toString());\r\n\r\n    setEqData({\r\n      f: f,\r\n      dx: dfdx,\r\n      dy: dfdy,\r\n      dz: dfdz,\r\n      norm: norm,\r\n      sdf: sdf,\r\n      parsedSdf: `return ${traverseTree(x)}`,\r\n    });\r\n\r\n  };\r\n\r\n  const handleSave = () => {\r\n    if (nameInput in storage) {\r\n      return;\r\n    } else {\r\n      let newData = { ...storage };\r\n      newData[nameInput.toLowerCase()] = {\r\n        id: nameInput.toLowerCase(),\r\n        name: nameInput,\r\n        implicit: eqData.f.toString(),\r\n        sdf: eqData.sdf.toString(),\r\n        parsedSdf: eqData.parsedSdf,\r\n        fHeader: `${nameInput.toLowerCase()}(vec3 p ${parametersInput.length > 0 ? ',' : ''}${(parametersInput.map(p => `float ${p.symbol}`)).join(',')})`,\r\n        parameters: parametersInput,\r\n      };\r\n\r\n\r\n      setStorage(newData);\r\n      props.handleClose();\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n\r\n    if (props.savedData) {\r\n      setNameInput(props.savedData.name);\r\n      setEqInput(props.savedData.implicit);\r\n      setParametersInput(props.savedData.parameters);\r\n      handleNewEquation(props.savedData.implicit);\r\n    } else {\r\n      setNameInput('');\r\n      setEqInput('');\r\n      setParametersInput([]);\r\n      setEqData(null);\r\n    }\r\n  }, [props.savedData]);\r\n\r\n  useEffect(() => {\r\n    setValidName(!(nameInput in storage));\r\n  }, [nameInput]);\r\n\r\n  return (\r\n    <Dialog open={props.open} onClose={props.handleClose}>\r\n      <DialogTitle>New Surface</DialogTitle>\r\n\r\n      <DialogContent>\r\n        <Grid container spacing={2}>\r\n          <Grid item xs={12}>\r\n            <TextField\r\n              value={nameInput}\r\n              error={!validName || nameInput === ''}\r\n              helperText={\r\n                nameInput === '' ? '' : validName ? '' : 'Name already in use'\r\n              }\r\n              onChange={(e) => setNameInput(e.target.value)}\r\n              id=\"name\"\r\n              label=\"Name\"\r\n            />\r\n          </Grid>\r\n\r\n          <Grid item xs={12}>\r\n            <TextField\r\n              sx={{ width: '100%' }}\r\n              value={eqInput}\r\n              defaultValue=\"\"\r\n              label=\"Implicit\"\r\n              onChange={(e) => handleNewEquation(e.target.value)}\r\n              id=\"Implicit\"\r\n              error={!validEq || eqInput === ''}\r\n              helperText={errorMsg}\r\n              InputProps={{\r\n                endAdornment: (\r\n                  <InputAdornment position=\"end\"> = 0</InputAdornment>\r\n                ),\r\n              }}\r\n            />\r\n          </Grid>\r\n          <Grid item xs={6}>\r\n            <MathJax.Provider>\r\n              <MathJax.Node formula={latexInfo()} />\r\n            </MathJax.Provider>\r\n          </Grid>\r\n          <Grid item xs={6}>\r\n            <Shader\r\n              sdf={'sphere(p, 1.0)'}\r\n              uniforms={{ color: { type: '3fv', value: [1.0, 1.0, 0.0] } }}\r\n              style={{ margin: '10px' }}\r\n            />\r\n          </Grid>\r\n          <Grid item xs={12}>\r\n            <CustomInputTable\r\n              rows={parametersInput}\r\n              handleNewParameters={(newParams) => setParametersInput(newParams)}\r\n            />\r\n          </Grid>\r\n\r\n        </Grid>\r\n      </DialogContent>\r\n      <DialogActions>\r\n        <Button onClick={props.handleClose}>Cancel</Button>\r\n        <Button\r\n          onClick={handleSave}\r\n          disabled={\r\n            !validName || !validEq || nameInput === '' || eqInput === ''\r\n          }\r\n        >\r\n          Save\r\n        </Button>\r\n      </DialogActions>\r\n    </Dialog>\r\n  );\r\n}\r\n","import React, { useState, useEffect } from 'react';\r\nimport Box from '@mui/material/Box';\r\nimport CustomTable from '../CustomComponents/CustomTable';\r\nimport nerdamer from 'nerdamer';\r\nimport 'katex/dist/katex.min.css';\r\nimport Latex from 'react-latex-next';\r\nimport useLocalStorage from '../storageHook.js';\r\nimport SurfaceDialog from './SurfaceDialog';\r\n\r\nconst latexEq = (eq) => {\r\n  return <Latex>{`$ ${eq} $`}</Latex>;\r\n};\r\nconst tableCols = [\r\n  { id: 'name', label: 'Name', minWidth: 170 },\r\n  { id: 'implicit', label: 'Implicit', minWidth: 350 },\r\n  { id: 'sdf', label: 'SDF', minWidth: 10 },\r\n];\r\n\r\nexport default function SurfacePage() {\r\n  const [storage, setStorage] = useLocalStorage('user_implicits', {});\r\n  const [dialogOpen, setDialogOpen] = useState(false);\r\n  const [tableRows, setTableRows] = useState([]);\r\n  const [editedRow, setEditedRow] = useState('');\r\n\r\n  useEffect(() => {\r\n    let newRows = [];\r\n\r\n    Object.keys(storage).forEach(function (key, index) {\r\n      const item = storage[key];\r\n\r\n      newRows.push({\r\n        id: item.id,\r\n        name: item.name,\r\n        implicit: latexEq(nerdamer.convertToLaTeX(item.implicit)),\r\n        sdf: item.sdf,\r\n      });\r\n    });\r\n\r\n    setTableRows(newRows);\r\n  }, [storage]);\r\n\r\n  const handleDelete = (selectedList) => {\r\n    console.log(selectedList);\r\n    const asArray = Object.entries(storage);\r\n    const filtered = asArray.filter(\r\n      ([key, value]) => !selectedList.includes(key)\r\n    );\r\n\r\n    // Convert the key/value array back to an object:\r\n    // `{ name: 'Luke Skywalker', title: 'Jedi Knight' }`\r\n    const newStorage = Object.fromEntries(filtered);\r\n    setStorage(newStorage);\r\n  };\r\n\r\n  return (\r\n    <Box>\r\n\r\n      <CustomTable\r\n        rows={tableRows}\r\n        columns={tableCols}\r\n        handleDelete={handleDelete}\r\n        handleCreateRow={() => { setEditedRow(\"\"); setDialogOpen(true) }}\r\n        handleRowClick={(name) => { setEditedRow(name); setDialogOpen(true) }}\r\n      />\r\n\r\n      <SurfaceDialog\r\n        savedData={editedRow ? storage[editedRow] : null}\r\n        open={dialogOpen}\r\n        handleClose={() => setDialogOpen(false)}\r\n      />\r\n\r\n    </Box>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport { createTheme, ThemeProvider } from '@mui/material/styles';\r\n\r\nimport {\r\n  Content,\r\n  Footer,\r\n  Panel,\r\n  Grid,\r\n  Row,\r\n  Col,\r\n} from 'rsuite';\r\nimport Graph from './GraphPage/Graph';\r\nimport MaterialsPage from './MaterialPage/MaterialsPage';\r\nimport SurfacePage from './SurfacePage/SurfacePage';\r\nimport 'rsuite/dist/styles/rsuite-default.css';\r\nimport { Box, Tab, Tabs } from '@mui/material';\r\nimport './styles.css';\r\nimport Shader from './CustomComponents/Shader';\r\nimport { fs } from './ShaderStuff/fragmentShaderMovable';\r\n\r\nconst theme = createTheme({\r\n  palette: {\r\n    main: '#0076DF',\r\n    primitive: '#609dff',\r\n    boolean: '#ff5858',\r\n    deform: '#3ec224',\r\n    transform: '#ffbb62',\r\n  },\r\n});\r\n\r\nfunction MainContent() {\r\n  return (\r\n    <>\r\n      <Grid fluid>\r\n        <Row>\r\n          <Col xs={6}>\r\n            <Shader\r\n              style={{ height: '100vh' }}\r\n              shader={fs('box(p, vec3(1.0))')}\r\n              uniforms={{ color: { type: '3fv', value: [1.0, 1.0, 0.0] } }}\r\n            />\r\n          </Col>\r\n          <Col xs={1}>\r\n            <div style={{ borderRight: '2px solid grey', height: '100vh' }} />\r\n          </Col>\r\n          <Col xs={17}>\r\n            {/* <ContextMenu/> */}\r\n\r\n            <Graph />\r\n          </Col>\r\n        </Row>\r\n      </Grid>\r\n    </>\r\n  );\r\n}\r\n\r\nconst layoutStyles = {\r\n  display: 'flex',\r\n  flexDirection: 'column',\r\n  height: '100vh',\r\n};\r\n\r\nexport default function App() {\r\n  const [tabVal, setTabVal] = React.useState(0);\r\n\r\n  return (\r\n    <div style={layoutStyles}>\r\n      <ThemeProvider theme={theme}>\r\n        <Box>\r\n          <Box>\r\n            <Tabs value={tabVal} onChange={(e, v) => setTabVal(v)}>\r\n              <Tab label=\"Graph\" />\r\n              <Tab label=\"Materials\" />\r\n              <Tab label=\"Surfaces\" />\r\n            </Tabs>\r\n          </Box>\r\n          <Box sx={{ padding: 2 }}>\r\n            {tabVal === 0 && <MainContent />}\r\n            {tabVal === 1 && <MaterialsPage />}\r\n            {tabVal === 2 && <SurfacePage />}\r\n          </Box>\r\n        </Box>\r\n\r\n        <Content style={{ flexGrow: 1 }}></Content>\r\n        <Footer>\r\n          <Panel bordered>\r\n            <p>Daniel Zufrí Quesada</p>\r\n          </Panel>\r\n        </Footer>\r\n      </ThemeProvider>\r\n    </div>\r\n  );\r\n}\r\n","import { operators } from './operators';\r\n\r\nexport const fs = (sdf, primitives) => {\r\n\r\n  return `\r\n    \r\n    // https://thebookofshaders.com/03/?lan=es\r\n  // https://thebookofshaders.com/03/\r\n  // http://jamie-wong.com/2016/07/15/ray-marching-signed-distance-functions/#putting-it-all-together\r\n  // https://www.shadertoy.com/view/llt3R4\r\n  \r\n  // camera\r\n  // https://www.scratchapixel.com/lessons/3d-basic-rendering/introduction-to-ray-tracing/how-does-it-work\r\n  // http://www.codinglabs.net/article_world_view_projection_matrix.aspx\r\n  // https://iopscience.iop.org/article/10.1088/0031-9155/52/12/006/meta\r\n  // https://www.ingebook.com/ib/NPcd/IB_BooksVis?cod_primaria=1000187&codigo_libro=6575\r\n  \r\n  #ifdef GL_ES\r\n  precision mediump float;\r\n  #endif\r\n  \r\n  const int AA = 3;\r\n  const int MAX_MARCHING_STEPS = 255;\r\n  const float EPSILON = 0.0001;\r\n  const float MIN_DIST = 0.0;\r\n  const float MAX_DIST = 100.0;\r\n\r\n  vec3 cameraPos                    = vec3(10.0, 1.0, 10.0);\r\n  \r\n\r\n  float sphere(vec3 p){\r\n    float x = p.r;\r\n    float y = p.g;\r\n    float z = p.b;\r\n\r\n    return ((((-(1.0000))+(pow(x, 2.0000)))+(pow(y, 2.0000)))+(pow(z, 2.0000)))*(pow(sqrt((((4.0000)*(pow(x, 2.0000)))+((4.0000)*(pow(y, 2.0000))))+((4.0000)*(pow(z, 2.0000)))), -(1.0000)));\r\n}\r\n  ${operators()}\r\n\r\n  struct Material\r\n  {\r\n      vec3 specular;\r\n      vec3 diffuse;\r\n      vec3 ambient;\r\n      float smoothness;\r\n  };\r\n  \r\n  float map( in vec3 p )\r\n  {\r\n    return ${sdf};\r\n  }\r\n  \r\n  \r\n  vec3 rayDirection(vec2 size, vec2 fragCoord) {\r\n      const float fov = 45.0;\r\n  \r\n      vec2 xy = fragCoord - size / 2.0;\r\n      float z = size.y / tan(radians(fov) / 2.0);\r\n  \r\n      return normalize(vec3(xy, -z));\r\n  }\r\n  \r\n  vec3 normal(vec3 p) {\r\n      return normalize(vec3(\r\n          map(vec3(p.x + EPSILON, p.y, p.z)) - map(vec3(p.x - EPSILON, p.y, p.z)),\r\n          map(vec3(p.x, p.y + EPSILON, p.z)) - map(vec3(p.x, p.y - EPSILON, p.z)),\r\n          map(vec3(p.x, p.y, p.z  + EPSILON)) - map(vec3(p.x, p.y, p.z - EPSILON))\r\n      ));\r\n  }\r\n  \r\n  vec3 lighting(vec3 p, vec3 n, vec3 eye, Material mat){\r\n      vec3 ambient = vec3(0.5);\r\n  \r\n      vec3 lights_pos[2];\r\n      lights_pos[0] = vec3(4.0, 2.0, 2.0);\r\n      lights_pos[1] = vec3(-4.0, -2.0, -2.0);\r\n  \r\n      vec3 lights_color[2];\r\n      lights_color[0] = vec3(1.0, 1.0, 1.0);\r\n      lights_color[1] = vec3(1.0, 1.0, 1.0);\r\n  \r\n      vec3 Ip = mat.ambient * ambient;\r\n  \r\n      for(int i=0; i<2; i++){\r\n          vec3 Lm = normalize(lights_pos[i] - p);\r\n          vec3 Rm = normalize(2.0*(dot(Lm,n))*n - Lm);    // reflect(-Lm, n)\r\n          vec3 V  = normalize(eye - p);\r\n  \r\n          float LN = dot(Lm, n);\r\n          float RV = dot(Rm, V);\r\n  \r\n          if (LN < 0.0)   // Light not visible\r\n              Ip += vec3(0.0, 0.0, 0.0);\r\n          else if (RV < 0.0)  // opposite direction as viewer, apply only diffuse\r\n              Ip += lights_color[i] * (mat.diffuse * LN);\r\n          else\r\n              Ip += lights_color[i] * (mat.diffuse*LN + mat.specular*pow(RV, mat.smoothness));\r\n      }\r\n  \r\n      return Ip;\r\n  }\r\n  \r\n  mat4 viewMatrix(vec3 eye, vec3 center, vec3 up) {\r\n      // Based on gluLookAt man page\r\n      vec3 f = normalize(center - eye);\r\n      vec3 s = normalize(cross(f, up));\r\n      vec3 u = cross(s, f);\r\n      return mat4(\r\n          vec4(s, 0.0),\r\n          vec4(u, 0.0),\r\n          vec4(-f, 0.0),\r\n          vec4(0.0, 0.0, 0.0, 1)\r\n      );\r\n  }\r\n  \r\n  float clamp(float val){\r\n    if(val < 0.0)   return 0.0;\r\n    if(val >1.0)    return 1.0;\r\n\r\n    return val;\r\n}\r\n\r\n  void main() {\r\n      Material mat_yellow = Material(\r\n          vec3(1.0, 1.0, 1.0),    // specular\r\n          vec3(1.0, 1.0,0.0),        // diffuse\r\n          vec3(0.2),              // ambient\r\n          10.0                    // shiness\r\n      );\r\n      \r\n      const vec3 backGroundColor  = vec3(0.9);\r\n      vec2 mouseStartPos, mouseCurrPos;\r\n      vec2 mouse = iMouse.xy / iResolution.xy;\r\n\r\n      if(iMouse.z > 0.0){\r\n        \r\n        vec3 cameraAt \t= vec3(0.0);\r\n\r\n        float angleX = 6.28 * mouse.x;\r\n        float angleY =  mouse.y * 6.28 ;\r\n        cameraPos\t= distance * (vec3(sin(angleX)*cos(angleY), sin(angleY), cos(angleX)*cos(angleY)));\r\n      }\r\n\r\n      \r\n\r\n      for( int m=0; m<AA; m++ ){\r\n          for( int n=0; n<AA; n++ ){\r\n              float depth = MIN_DIST;\r\n  \r\n              // create view ray\r\n              vec3 ray = rayDirection(iResolution.xy, gl_FragCoord.xy);\r\n              mat4 viewToWorld = viewMatrix(cameraPos, vec3(0.0, 0.0, 0.0), vec3(0.0, 1.0, 0.0));\r\n              vec3 worldDir = (viewToWorld * vec4(ray, 0.0)).xyz;\r\n  \r\n              // raytracing\r\n              for (int i = 0; i < MAX_MARCHING_STEPS; i++) {\r\n                  float dist = map(cameraPos + depth * worldDir);\r\n                  if (dist < EPSILON) {\r\n                      vec3 p = cameraPos + depth * worldDir;\r\n                      vec3 n = normal(p);\r\n  \r\n                      gl_FragColor = vec4(lighting(p, n, cameraPos, mat_yellow), 1.0);\r\n                      return;\r\n                  }\r\n  \r\n                  depth += dist;\r\n  \r\n                  if (depth >= MAX_DIST) {\r\n                      gl_FragColor = vec4(backGroundColor.xyz, 1.0);\r\n                      return;\r\n                  }\r\n              }\r\n          }\r\n      }\r\n  }\r\n\r\n  \r\n  `;\r\n}\r\n","import React from 'react'\r\nimport ReactDOM from 'react-dom'\r\nimport App from './App'\r\n\r\nconst rootElement = document.getElementById('root')\r\nReactDOM.render(\r\n  <React.StrictMode>\r\n    <App />\r\n  </React.StrictMode>,\r\n  rootElement\r\n)\r\n"],"sourceRoot":""}